<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MotionStation 设备端原型</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --device-brightness: 1; /* 0 ~ 1 */
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background: #ffffff; /* 深色背景，突出屏幕 */
        }
        /* 屏幕容器：保持 9:16 纵向比例（16:9 竖放） */
        .device-shell {
            position: relative;
            background: #111827;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5), inset 0 0 0 8px #111;
            overflow: hidden;
            width: min(90vh*9/16, 87vw); /* 放大 50% */
            height: calc(min(90vh, 87vw*16/9));
            margin: 24px auto;
        }
        /* 亮度遮罩：依据 --device-brightness 反向调整 */
        .brightness-overlay {
            pointer-events: none;
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,calc(1 - var(--device-brightness)));
            transition: background 120ms linear;
            z-index: 5;
        }
        /* 页面切换动画 */
        .page { display: none; animation: fadeIn 200ms ease; }
        .page.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(6px);} to { opacity:1; transform: translateY(0);} }

        /* 顶部下拉手势命中区域 */
        .gesture-pull-down {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 32px;
            z-index: 40;
        }

        /* 控制中心抽屉 */
        .control-center { position: absolute; left: 0; right: 0; top: -70%; height: 70%; z-index: 50; pointer-events: none; }
        .control-center.open { top: 0; pointer-events: auto; }
        .transition-fast { transition: top 220ms cubic-bezier(.2,.8,.2,1); }

        /* 自定义隐藏输入的选中效果 */
        .hidden-input { opacity: 0; position: absolute; width: 0; height: 0; }
        .hidden-input:checked + div { border-color: #2563eb; background: #eff6ff; color: #1d4ed8; }

        /* 滚动条微样式（仅屏幕内部） */
        .screen-scroll::-webkit-scrollbar { width: 6px; }
        .screen-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- 设备屏幕（9:16 竖屏） -->
    <div id="device" class="device-shell">

        <!-- 手势命中区（从顶端下拉） -->
        <div id="gestureArea" class="gesture-pull-down"></div>

        <!-- 屏幕内容 -->
        <div class="absolute inset-0 bg-white flex flex-col">

            <!-- 顶部状态栏（设备端简化） -->
            <div class="flex-shrink-0 h-10 bg-white/90 backdrop-blur flex items-center justify-between px-4 border-b border-gray-100 relative">
                <div class="flex items-center gap-2 text-gray-600">
                    <span class="text-sm font-semibold">09:41</span>
                    <span class="text-xs">MotionStation</span>
                </div>

                <div class="absolute left-1/2 -translate-x-1/2">
                    <button id="btnOpenCC" title="控制中心" aria-label="控制中心" class="w-8 h-8 flex items-center justify-center rounded-full border text-gray-600 hover:bg-gray-50 transition">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 7h16M7 12h10M10 17h4" />
                        </svg>
                    </button>
                </div>

                <div class="flex items-center gap-3 text-gray-600">
                    <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition" title="我的日程" aria-label="我的日程" onclick="showPage('page-schedule')">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.6" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 3v3M16 3v3M4.5 9h15M6 5h12a1.5 1.5 0 011.5 1.5v12A1.5 1.5 0 0118 20h-12a1.5 1.5 0 01-1.5-1.5v-12A1.5 1.5 0 016 5z" />
                            <circle cx="8.5" cy="13.5" r="1.2" />
                            <circle cx="12" cy="13.5" r="1.2" />
                            <circle cx="15.5" cy="13.5" r="1.2" />
                        </svg>
                    </button>
                    <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition" title="设置" aria-label="设置" onclick="openSettings()">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.6" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.4 3.6l.5-1.3a1.2 1.2 0 012.2 0l.5 1.3a1.3 1.3 0 001.2.8h1.4a1.2 1.2 0 011.1.8l.4 1.2a1.2 1.2 0 00.9.8l1.3.3a1.2 1.2 0 01.9 1.5l-.4 1.3a1.2 1.2 0 000 .7l.4 1.3a1.2 1.2 0 01-.9 1.5l-1.3.3a1.2 1.2 0 00-.9.8l-.4 1.2a1.2 1.2 0 01-1.1.8h-1.4a1.3 1.3 0 00-1.2.8l-.5 1.3a1.2 1.2 0 01-2.2 0l-.5-1.3a1.3 1.3 0 00-1.2-.8H7.8a1.2 1.2 0 01-1.1-.8l-.4-1.2a1.2 1.2 0 00-.9-.8l-1.3-.3a1.2 1.2 0 01-.9-1.5l.4-1.3a1.2 1.2 0 000-.7l-.4-1.3a1.2 1.2 0 01.9-1.5l1.3-.3a1.2 1.2 0 00.9-.8l.4-1.2A1.2 1.2 0 017.8 4h1.4a1.3 1.3 0 001.2-.8z" />
                            <circle cx="12" cy="12" r="3" />
                        </svg>
                    </button>
                    <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition" title="退出登录" aria-label="退出登录" onclick="logout()">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.6" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 8l4 4m0 0l-4 4m4-4H9" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 4h6a1 1 0 011 1v2M12 17v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5a1 1 0 011-1h3" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- 屏幕主内容（页面栈） -->
            <div class="flex-1 overflow-y-auto screen-scroll relative">

                <!-- ======================= -->
                <!-- 首次激活：选择地区 -->
                <!-- ======================= -->
                <div id="page-activate-region" class="page flex-col h-full bg-white">
                    <div class="p-8 flex-1 flex flex-col items-center justify-center">
                        <div class="w-64 h-40 bg-gray-100 rounded-2xl mb-8"></div>
                        <div class="text-gray-400 mb-8">欢迎使用 MotionStation</div>
                        <button class="w-64 bg-blue-600 text-white font-bold py-3 rounded-lg" onclick="openRegionPicker()">选择地区</button>
                        <div id="activation-region-text" class="mt-3 text-sm text-gray-600">未选择</div>
                    </div>
                    <div class="p-6 border-t">
                        <button id="btn-activate-next1" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg disabled:opacity-50" onclick="goToActivationWifi()" disabled>下一步</button>
                    </div>
                </div>

                <!-- ======================= -->
                <!-- 首次激活：连接网络 -->
                <!-- ======================= -->
                <div id="page-activate-wifi" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 p-6 border-b flex items-center">
                        <button class="px-3 py-2 border rounded" onclick="showPage('page-activate-region')">返回</button>
                        <div class="ml-4 text-gray-700">地区：<span id="wifi-region-text">--</span></div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-2" id="activation-wifi-list">
                        <div class="text-lg font-bold text-gray-900 mb-2">请连接网络</div>
                    </div>
                    <div class="p-6 border-t">
                        <button id="btn-activate-next2" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg disabled:opacity-50" onclick="proceedToAuth()" disabled>下一步</button>
                    </div>
                </div>

                <!-- 欢迎页（设备端） -->
                <div id="page-welcome" class="page active flex-col items-center justify-between p-10 h-full bg-white">
                    <div class="flex-1 flex items-center justify-center">
                        <div class="w-80 h-80 bg-gray-100 rounded-2xl flex items-center justify-center">
                            <span class="text-gray-400 text-xl">欢迎使用 MotionStation</span>
                        </div>
                    </div>
                    <div class="w-full max-w-md">
                        <button onclick="showPage('page-login')" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow hover:bg-blue-700">登录 / 注册</button>
                        <button onclick="showPage('page-guest')" class="w-full text-gray-600 font-medium py-3 rounded-lg mt-3 hover:bg-gray-100">游客模式</button>
                        <div class="text-center text-xs text-gray-400 mt-4">切换地区</div>
                    </div>
                </div>

                <!-- 日常登录：欢迎页 -->
                <div id="page-auth-landing" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 flex items-center justify-between px-6 border-b">
                        <div class="text-sm font-semibold text-gray-800">MotionStation</div>
                        <button class="text-sm text-blue-600 hover:text-blue-700" onclick="openRegionPicker()">切换地区</button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-8 bg-gray-50">
                        <div class="max-w-md mx-auto space-y-8">
                            <div class="space-y-4 text-center">
                                <div class="mx-auto w-48 h-16 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-2xl shadow-lg flex items-center justify-center text-white text-lg font-semibold tracking-wide">MotionStation</div>
                                <div class="mx-auto w-64 h-64 bg-white border border-blue-100 rounded-3xl shadow-inner flex flex-col items-center justify-center text-gray-500">
                                    <span class="text-sm">欢迎回来</span>
                                    <span class="mt-2 text-2xl font-semibold text-gray-800">开启今日训练</span>
                                </div>
                                <div class="text-xs text-gray-500">智能互联训练系统 · 同步云端进度与设备体验</div>
                            </div>
                            <div class="space-y-3">
                                <button class="w-full py-3 rounded-xl bg-blue-600 text-white font-semibold shadow hover:bg-blue-700 transition" onclick="openReturningLogin()">账号登录</button>
                                <button class="w-full py-3 rounded-xl border border-gray-300 text-gray-700 font-semibold hover:border-blue-400 hover:text-blue-600 transition" onclick="showPage('page-register')">注册新账号</button>
                                <button class="w-full py-3 rounded-xl border border-transparent text-sm text-blue-600 hover:text-blue-700 transition" onclick="showPage('page-guest')">游客模式</button>
                            </div>
                            <div class="text-xs text-center text-gray-400">继续登录即表示同意 MotionStation《隐私政策》与《用户协议》</div>
                        </div>
                    </div>
                </div>

                <!-- 日常登录：账号选择 -->
                <div id="page-auth-returning" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 flex items-center justify-between px-6 border-b">
                        <button class="text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1" onclick="showAuthLanding()">
                            <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor"><path d="M12.707 15.707a1 1 0 01-1.414 0L6.586 11l4.707-4.707a1 1 0 10-1.414-1.414l-5.414 5.414a1 1 0 000 1.414l5.414 5.414a1 1 0 001.414 0z"/></svg>
                            返回
                        </button>
                        <button class="text-sm text-blue-600 hover:text-blue-700" onclick="openRegionPicker()">切换地区</button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-8 bg-gray-50">
                        <div class="max-w-sm mx-auto space-y-6">
                            <div>
                                <h1 class="text-2xl font-bold text-gray-900 text-center">欢迎回来</h1>
                                <p class="text-sm text-gray-500 text-center mt-2">选择上次登录的账号，或更换其他登录方式</p>
                            </div>
                            <div id="auth-last-login" class="hidden bg-white border border-blue-100 rounded-2xl shadow p-5 cursor-pointer hover:border-blue-300 transition"></div>
                            <div id="auth-last-login-empty" class="bg-white border border-dashed border-gray-300 rounded-2xl p-5 text-sm text-gray-500">
                                暂无历史登录记录，请选择其他登录方式。
                            </div>
                            <div class="space-y-3 pt-2">
                                <button class="w-full py-3 rounded-xl border border-gray-300 text-gray-700 font-medium hover:border-blue-400 hover:text-blue-600 transition" onclick="startEmailLogin()">邮箱登录</button>
                                <div class="flex items-center gap-2 text-xs text-gray-400">
                                    <div class="flex-1 h-px bg-gray-200"></div>
                                    <span>或</span>
                                    <div class="flex-1 h-px bg-gray-200"></div>
                                </div>
                                <button class="w-full py-3 rounded-xl bg-blue-600 text-white font-semibold shadow hover:bg-blue-700 transition" onclick="startQrLogin()">扫码登录</button>
                                <button class="w-full text-sm text-gray-500 hover:text-blue-600" onclick="showPage('page-login')">更多登录方式</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 登录页 -->
                <div id="page-login" class="page flex-col p-8 h-full bg-white">
                    <h1 class="text-3xl font-bold text-gray-900 mt-4 mb-6">欢迎</h1>
                    <div id="login-tab-bar" class="my-6 flex border border-gray-200 rounded-lg overflow-hidden max-w-xl">
                        <button id="tab-btn-phone" onclick="toggleLoginMode('phone')" class="flex-1 py-2 text-sm font-medium bg-blue-600 text-white">手机验证码</button>
                        <button id="tab-btn-password" onclick="toggleLoginMode('password')" class="flex-1 py-2 text-sm font-medium text-gray-600 bg-gray-50 hover:bg-gray-100">账号密码</button>
                        <button id="tab-btn-email" onclick="toggleLoginMode('email')" class="flex-1 py-2 text-sm font-medium text-gray-600 bg-gray-50 hover:bg-gray-100">邮箱</button>
                    </div>
                    <div id="mode-phone" class="space-y-4 max-w-xl">
                        <input id="login-phone" type="tel" placeholder="请输入手机号" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input id="login-phone-pass" type="password" placeholder="请输入密码" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div id="mode-password" class="space-y-4 max-w-xl hidden">
                        <input type="text" placeholder="请输入手机号/邮箱" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="password" placeholder="请输入密码" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div id="mode-email" class="space-y-4 max-w-xl hidden">
                        <input id="login-email" type="email" placeholder="请输入邮箱" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input id="login-email-pass" type="password" placeholder="请输入密码" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex justify-between items-center mt-4 max-w-xl">
                        <a onclick="showPage('page-forgot')" class="text-sm text-blue-600 hover:underline cursor-pointer">忘记密码?</a>
                        <a onclick="showPage('page-register')" class="text-sm text-blue-600 hover:underline cursor-pointer">立即注册</a>
                    </div>
                    <div class="grid gap-3 max-w-xl mt-2">
                        <button class="w-full border text-gray-700 font-medium py-3 rounded-lg hover:bg-gray-50" onclick="openQrModal('login')">已有 Motion Station APP，扫码登录</button>
                        <button class="w-full border text-gray-700 font-medium py-3 rounded-lg hover:bg-gray-50" onclick="openQrModal('download')">下载 Motion Station APP</button>
                    </div>
                    <button onclick="login()" class="w-full max-w-xl bg-blue-600 text-white font-bold py-3 rounded-lg shadow mt-4 hover:bg-blue-700">登录</button>
                    <button id="btn-activation-skip" onclick="enterHomeAfterActivation()" class="w-full max-w-xl border border-gray-300 text-gray-700 font-bold py-3 rounded-lg shadow mt-3 hover:bg-gray-50 hidden">稍后注册</button>
                </div>

                <!-- 注册 步骤1 -->
                <div id="page-register" class="page flex-col p-8 h-full bg-white">
                    <svg onclick="showPage('page-login')" class="w-6 h-6 text-gray-500 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    <h1 class="text-3xl font-bold text-gray-900 mt-4">创建账号</h1>
                    <div id="register-tab-bar" class="my-6 flex border border-gray-200 rounded-lg overflow-hidden max-w-xl">
                        <button id="tab-btn-reg-phone" onclick="toggleRegisterMode('phone')" class="flex-1 py-2 text-sm font-medium bg-blue-600 text-white">手机注册</button>
                        <button id="tab-btn-reg-email" onclick="toggleRegisterMode('email')" class="flex-1 py-2 text-sm font-medium text-gray-600 bg-gray-50 hover:bg-gray-100">邮箱注册</button>
                    </div>
                    <div id="reg-mode-phone" class="space-y-4 max-w-xl">
                        <div class="flex">
                            <span class="inline-flex items-center px-3 text-sm text-gray-900 bg-gray-100 border border-r-0 border-gray-300 rounded-l-md">+86</span>
                            <input type="tel" placeholder="请输入手机号" class="flex-1 p-3 border border-gray-300 rounded-r-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="flex gap-2">
                            <input type="text" placeholder="请输入验证码" class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button onclick="startCountdown(this)" class="w-40 bg-gray-200 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-300">获取验证码</button>
                        </div>
                        <input type="password" placeholder="设置密码 (6-20位)" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="password" placeholder="确认密码" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div id="reg-mode-email" class="space-y-4 max-w-xl hidden">
                        <input type="email" placeholder="请输入邮箱" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex gap-2">
                            <input type="text" placeholder="请输入验证码" class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button onclick="startCountdown(this)" class="w-40 bg-gray-200 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-300">获取验证码</button>
                        </div>
                        <input type="password" placeholder="设置密码 (6-20位)" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="password" placeholder="确认密码" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="mt-6 flex items-center max-w-xl">
                        <input type="checkbox" id="agree-register" class="hidden-input">
                        <label for="agree-register" class="flex items-center cursor-pointer">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-sm flex-shrink-0 mr-2 flex items-center justify-center">
                                <svg class="w-3 h-3 text-blue-600 hidden" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                            </div>
                            <span class="text-xs text-gray-500">我已阅读并同意 <a class="text-blue-600">用户协议</a> 和 <a class="text-blue-600">隐私政策</a></span>
                        </label>
                    </div>
                    <button onclick="registerStep1()" class="w-full max-w-xl bg-blue-600 text-white font-bold py-3 rounded-lg shadow mt-8 hover:bg-blue-700">下一步</button>
                </div>

                <!-- 注册 步骤2 -->
                <div id="page-register-step2" class="page flex-col p-8 h-full bg-white">
                    <svg onclick="showPage('page-register')" class="w-6 h-6 text-gray-500 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    <h1 class="text-3xl font-bold text-gray-900 mt-4">完善个人资料</h1>
                    <div class="space-y-4 mt-6 max-w-xl">
                        <label class="block">
                            <span class="text-gray-700 font-medium">昵称</span>
                            <input type="text" placeholder="请输入昵称" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </label>
                        <label class="block">
                            <span class="text-gray-700 font-medium">性别</span>
                            <div class="flex gap-4 mt-2">
                                <label class="flex-1"><input type="radio" name="gender" class="hidden-input" checked><div class="w-full text-center p-3 border-2 border-gray-300 rounded-lg">男</div></label>
                                <label class="flex-1"><input type="radio" name="gender" class="hidden-input"><div class="w-full text-center p-3 border-2 border-gray-300 rounded-lg">女</div></label>
                            </div>
                        </label>
                        <label class="block">
                            <span class="text-gray-700 font-medium">生日</span>
                            <input type="date" class="w-full mt-1 p-3 border border-gray-300 rounded-lg text-gray-500">
                        </label>
                        <label class="block">
                            <span class="text-gray-700 font-medium">身高 (cm)</span>
                            <input type="number" placeholder="175" class="w-full mt-1 p-3 border border-gray-300 rounded-lg">
                        </label>
                        <label class="block">
                            <span class="text-gray-700 font-medium">体重 (kg)</span>
                            <input type="number" placeholder="70" class="w-full mt-1 p-3 border border-gray-300 rounded-lg">
                        </label>
                        <label class="block">
                            <span class="text-gray-700 font-medium">训练目的 (多选)</span>
                            <div class="grid grid-cols-2 gap-3 mt-2">
                                <label><input type="checkbox" class="hidden-input"><div class="w-full text-center p-3 border-2 border-gray-300 rounded-lg">塑形减脂</div></label>
                                <label><input type="checkbox" class="hidden-input"><div class="w-full text-center p-3 border-2 border-gray-300 rounded-lg">力量增肌</div></label>
                                <label><input type="checkbox" class="hidden-input"><div class="w-full text-center p-3 border-2 border-gray-300 rounded-lg">运动康复</div></label>
                                <label><input type="checkbox" class="hidden-input"><div class="w-full text-center p-3 border-2 border-gray-300 rounded-lg">普拉提</div></label>
                            </div>
                        </label>
                    </div>
                    <button onclick="registerStep2()" class="w-full max-w-xl bg-blue-600 text-white font-bold py-3 rounded-lg shadow mt-8 hover:bg-blue-700">完成</button>
                </div>

                <!-- 注册成功 -->
                <div id="page-register-success" class="page flex-col h-full items-center justify-center bg-white">
                    <div class="w-32 h-32 bg-green-500 rounded-full flex items-center justify-center shadow-lg">
                        <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900 mt-6">注册成功!</h1>
                    <p class="text-gray-500 mt-2">即将跳转至首页...</p>
                </div>

                <!-- 首页（登录后） -->
                <div id="page-home" class="page flex-col h-full bg-white">
                    <div class="p-8 border-b bg-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-xl font-bold text-gray-900">欢迎回来，AA</h2>
                                <p class="text-sm text-gray-500" id="home-date"></p>
                            </div>
                            <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-sm font-semibold text-gray-500 cursor-pointer hover:bg-gray-300 transition" onclick="showPage('page-user-profile')">AA</div>
                        </div>
                        <div class="mt-6 bg-white border border-blue-100 text-blue-700 p-5 rounded-xl shadow">
                            <div class="text-sm opacity-80">今日目标</div>
                            <div class="mt-2 text-xl font-bold">核心力量 · 第1周 第2天</div>
                            <p class="text-xs text-blue-600/80 mt-1">保持节奏控制，关注核心稳定和呼吸。</p>
                        </div>
                        <div class="mt-6 bg-blue-600 text-white p-5 rounded-xl shadow">
                            <p class="text-sm opacity-80">今日运动数据</p>
                            <div class="flex justify-between items-end mt-2">
                                <div>
                                    <span class="text-3xl font-bold">3h 20min</span>
                                    <p class="text-sm">运动时长</p>
                                </div>
                                <div>
                                    <span class="text-2xl font-bold">1281</span>
                                    <span class="text-sm opacity-80">kcal</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-8 space-y-6">
                        <div class="bg-white border border-gray-100 rounded-xl p-5 shadow">
                            <div class="flex items-center justify-between">
                                <div class="text-sm font-semibold text-gray-900">本周运动打卡</div>
                                <div class="text-xs text-gray-400">坚持打卡，保持训练节奏</div>
                            </div>
                            <div id="weekly-checkins-home" class="mt-4 grid grid-cols-7 gap-3"></div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold text-gray-900">推荐课程</h3>
                                <button class="text-sm text-blue-600" onclick="goToCourses()">查看全部</button>
                            </div>
                            <div class="mt-3 grid grid-cols-3 gap-4">
                                <div class="h-24 bg-gray-100 rounded-xl"></div>
                                <div class="h-24 bg-gray-100 rounded-xl"></div>
                                <div class="h-24 bg-gray-100 rounded-xl"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold text-gray-900">计划库</h3>
                                <button class="text-sm text-blue-600" onclick="goToCourses()">查看更多</button>
                            </div>
                            <div class="mt-3 grid grid-cols-3 gap-4">
                                <button class="bg-white rounded-xl shadow border border-gray-100 p-4 text-left hover:border-blue-300 transition" onclick="openPlanDetail('p1')">
                                    <div class="text-xs text-blue-500 font-semibold">核心进阶</div>
                                    <div class="mt-2 text-base font-bold text-gray-900">三周核心进阶</div>
                                    <div class="mt-1 text-xs text-gray-500">每周 3 次 · 中级</div>
                                </button>
                                <button class="bg-white rounded-xl shadow border border-gray-100 p-4 text-left hover:border-blue-300 transition" onclick="openPlanDetail('p2')">
                                    <div class="text-xs text-green-500 font-semibold">灵活恢复</div>
                                    <div class="mt-2 text-base font-bold text-gray-900">五周拉伸恢复</div>
                                    <div class="mt-1 text-xs text-gray-500">每周 2 次 · 初级</div>
                                </button>
                                <button class="bg-white rounded-xl shadow border border-gray-100 p-4 text-left hover:border-blue-300 transition" onclick="openPlanDetail('p3')">
                                    <div class="text-xs text-purple-500 font-semibold">力量提升</div>
                                    <div class="mt-2 text-base font-bold text-gray-900">力量增肌挑战</div>
                                    <div class="mt-1 text-xs text-gray-500">4 周 · 高级</div>
                                </button>
                            </div>
                        </div>
                        <!-- 新增：首页快捷按钮 -->
                        <div class="grid grid-cols-3 gap-4">
                            <button class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow hover:bg-blue-700" onclick="openFreeSelectOverlay()">自由训练</button>
                            <button class="w-full border border-blue-600 text-blue-600 font-bold py-3 rounded-lg shadow hover:bg-blue-50" onclick="goToCourses()">全部训练</button>
                            <button class="w-full border border-gray-200 text-gray-700 font-bold py-3 rounded-lg shadow hover:bg-gray-50" onclick="showPage('page-my')">我的</button>
                        </div>
                    </div>
                </div>

                <div id="page-schedule" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-home')">返回</button>
                        <div class="ml-4 font-bold text-gray-900 flex-1">我的日程</div>
                        <div class="text-xs text-gray-400">同步于设备云端</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50">
                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6">
                            <div class="flex items-center justify-between">
                                <button class="px-3 py-2 rounded-lg border text-sm text-gray-600 hover:bg-gray-50" onclick="schedulePrevMonth()">上个月</button>
                                <div class="text-lg font-bold text-gray-900" id="schedule-month">--</div>
                                <button class="px-3 py-2 rounded-lg border text-sm text-gray-600 hover:bg-gray-50" onclick="scheduleNextMonth()">下个月</button>
                            </div>
                            <div class="mt-4 grid grid-cols-7 text-center text-xs text-gray-500">
                                <div>周一</div><div>周二</div><div>周三</div><div>周四</div><div>周五</div><div>周六</div><div>周日</div>
                            </div>
                            <div id="schedule-calendar-grid" class="mt-2 grid grid-cols-7 gap-2 text-sm"></div>
                            <div class="mt-3 flex items-center gap-3 text-xs text-gray-400">
                                <span class="inline-flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span>计划</span>
                                <span class="inline-flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-emerald-500"></span>课程</span>
                                <span class="inline-flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-amber-500"></span>课程+计划</span>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-xs text-gray-500">已选择日期</div>
                                    <div class="text-xl font-bold text-gray-900" id="schedule-selected-date">--</div>
                                </div>
                                <div class="text-xs text-blue-600 cursor-pointer" onclick="showToast('数据自动同步（示意）')">查看同步记录</div>
                            </div>
                            <div class="mt-4" id="schedule-detail-list"></div>
                        </div>

                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6">
                            <div class="flex items-center justify-between">
                                <div class="text-lg font-bold text-gray-900">近期安排</div>
                                <div class="text-xs text-gray-400">7天内</div>
                            </div>
                            <div class="mt-4 space-y-3" id="schedule-upcoming-list"></div>
                        </div>
                    </div>
                </div>

                <!-- 课程库（含 课程/动作/计划/收藏） -->
                <div id="page-my" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-home')">返回</button>
                        <div class="ml-4 font-bold text-gray-900 flex-1">我的</div>
                        <button class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-sm font-semibold text-gray-500 cursor-pointer hover:bg-gray-300 transition" onclick="showPage('page-user-profile')">AA</button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50">
                        <div class="bg-gradient-to-r from-blue-600 to-indigo-500 text-white rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm opacity-80">昵称</div>
                                    <div class="text-2xl font-bold mt-1">AA</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm opacity-80">累计训练天数</div>
                                    <div id="my-total-days" class="text-3xl font-bold mt-1">--</div>
                                </div>
                            </div>
                            <div class="mt-6 grid grid-cols-3 gap-4 text-sm">
                                <div class="bg-white/10 rounded-xl p-4">
                                    <div class="opacity-70">近7日次数</div>
                                    <div id="my-last7-sessions" class="text-xl font-semibold mt-1">--</div>
                                </div>
                                <div class="bg-white/10 rounded-xl p-4">
                                    <div class="opacity-70">近7日时长/消耗</div>
                                    <div id="my-last7-duration" class="text-base font-semibold mt-1">--</div>
                                    <div id="my-last7-calories" class="text-xs opacity-80">--</div>
                                </div>
                                <div class="bg-white/10 rounded-xl p-4">
                                    <div class="opacity-70">近7日训练容量</div>
                                    <div id="my-last7-volume" class="text-xl font-semibold mt-1">--</div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6">
                            <div class="flex items-center justify-between">
                                <div class="text-lg font-bold text-gray-900">基本信息</div>
                                <button class="text-sm text-blue-600" onclick="showPage('page-user-profile')">编辑</button>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mt-4 text-sm text-gray-600">
                                <div>昵称：<span class="font-semibold text-gray-900">AA</span></div>
                                <div>性别：<span class="font-semibold text-gray-900">女</span></div>
                                <div>身高：<span class="font-semibold text-gray-900">168 cm</span></div>
                                <div>体重：<span class="font-semibold text-gray-900">55 kg</span></div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6 space-y-4">
                            <div>
                                <div class="text-lg font-bold text-gray-900">训练偏好</div>
                                <div class="mt-3 flex flex-wrap gap-2 text-xs">
                                    <span class="px-3 py-1 rounded-full bg-blue-50 text-blue-600">等级 · 进阶</span>
                                    <span class="px-3 py-1 rounded-full bg-emerald-50 text-emerald-600">目标 · 核心塑形</span>
                                    <span class="px-3 py-1 rounded-full bg-indigo-50 text-indigo-600">目标 · 有氧减脂</span>
                                    <span class="px-3 py-1 rounded-full bg-purple-50 text-purple-600">部位 · 肩背</span>
                                    <span class="px-3 py-1 rounded-full bg-orange-50 text-orange-500">部位 · 腰腹</span>
                                </div>
                            </div>
                            <div>
                                <div class="text-lg font-bold text-gray-900">伤病记录</div>
                                <div class="mt-3 text-sm text-gray-600">曾有腰部拉伤，当前已在康复阶段，训练时需关注核心保护。</div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-lg font-bold text-gray-900">我的训练</div>
                                    <div class="text-xs text-gray-500 mt-1">快速查看训练记录、收藏与计划</div>
                                </div>
                                <button class="text-xs text-blue-600 hover:underline" onclick="showPage('page-my-training')">查看全部</button>
                            </div>
                            <div class="mt-5 grid grid-cols-2 gap-3">
                                <button class="group flex items-center justify-between px-4 py-4 rounded-xl border border-gray-200 text-left hover:border-blue-500 hover:shadow transition" onclick="showPage('page-my-training')">
                                    <div>
                                        <div class="text-sm font-semibold text-gray-900">我的训练</div>
                                        <div class="text-xs text-gray-500 mt-1">近7日 · 12 次训练</div>
                                    </div>
                                    <span class="text-gray-300 group-hover:text-blue-500">›</span>
                                </button>
                                <button class="group flex items-center justify-between px-4 py-4 rounded-xl border border-gray-200 text-left hover:border-blue-500 hover:shadow transition" onclick="showPage('page-my-favorites')">
                                    <div>
                                        <div class="text-sm font-semibold text-gray-900">我的收藏</div>
                                        <div class="text-xs text-gray-500 mt-1">课程 / 动作 / 计划</div>
                                    </div>
                                    <span class="text-gray-300 group-hover:text-blue-500">›</span>
                                </button>
                                <button class="group flex items-center justify-between px-4 py-4 rounded-xl border border-gray-200 text-left hover:border-blue-500 hover:shadow transition" onclick="showPage('page-my-plan')">
                                    <div>
                                        <div class="text-sm font-semibold text-gray-900">我的计划</div>
                                        <div class="text-xs text-gray-500 mt-1">2 个进行中 · 1 个已完成</div>
                                    </div>
                                    <span class="text-gray-300 group-hover:text-blue-500">›</span>
                                </button>
                                <button class="group flex items-center justify-between px-4 py-4 rounded-xl border border-gray-200 text-left hover:border-blue-500 hover:shadow transition" onclick="showPage('page-training-data')">
                                    <div>
                                        <div class="text-sm font-semibold text-gray-900">训练数据</div>
                                        <div class="text-xs text-gray-500 mt-1">本月累计 14h · 8600 kcal</div>
                                    </div>
                                    <span class="text-gray-300 group-hover:text-blue-500">›</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="page-user-profile" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-my')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">个人资料</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50">
                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6 space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <label class="block">
                                    <span class="text-sm text-gray-600">昵称</span>
                                    <input type="text" value="AA" class="mt-2 w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </label>
                                <label class="block">
                                    <span class="text-sm text-gray-600">性别</span>
                                    <select class="mt-2 w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option>女</option>
                                        <option>男</option>
                                        <option>保密</option>
                                    </select>
                                </label>
                                <label class="block">
                                    <span class="text-sm text-gray-600">身高 (cm)</span>
                                    <input type="number" value="168" class="mt-2 w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </label>
                                <label class="block">
                                    <span class="text-sm text-gray-600">体重 (kg)</span>
                                    <input type="number" value="55" class="mt-2 w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </label>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6 space-y-4">
                            <div>
                                <div class="text-sm font-semibold text-gray-700">训练等级</div>
                                <div class="mt-3 flex gap-2">
                                    <button data-profile-group="level" data-value="入门" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="setProfileOption('level','入门')">入门</button>
                                    <button data-profile-group="level" data-value="进阶" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="setProfileOption('level','进阶')">进阶</button>
                                    <button data-profile-group="level" data-value="专业" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="setProfileOption('level','专业')">专业</button>
                                </div>
                            </div>
                            <div>
                                <div class="text-sm font-semibold text-gray-700">训练目的（可多选）</div>
                                <div class="mt-3 flex flex-wrap gap-2">
                                    <button data-profile-group="goals" data-value="增肌塑形" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="toggleProfileMulti('goals','增肌塑形')">增肌塑形</button>
                                    <button data-profile-group="goals" data-value="有氧减脂" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="toggleProfileMulti('goals','有氧减脂')">有氧减脂</button>
                                    <button data-profile-group="goals" data-value="普拉提" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="toggleProfileMulti('goals','普拉提')">普拉提</button>
                                    <button data-profile-group="goals" data-value="康复训练" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="toggleProfileMulti('goals','康复训练')">康复训练</button>
                                </div>
                            </div>
                            <div>
                                <div class="text-sm font-semibold text-gray-700">锻炼部位（可多选）</div>
                                <div class="mt-3 grid grid-cols-3 gap-2">
                                    <button data-profile-group="focus" data-value="全身" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="toggleProfileMulti('focus','全身')">全身</button>
                                    <button data-profile-group="focus" data-value="肩背" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="toggleProfileMulti('focus','肩背')">肩背</button>
                                    <button data-profile-group="focus" data-value="上肢" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="toggleProfileMulti('focus','上肢')">上肢</button>
                                    <button data-profile-group="focus" data-value="腰腹" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="toggleProfileMulti('focus','腰腹')">腰腹</button>
                                    <button data-profile-group="focus" data-value="臀腿" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="toggleProfileMulti('focus','臀腿')">臀腿</button>
                                    <button data-profile-group="focus" data-value="胸部" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="toggleProfileMulti('focus','胸部')">胸部</button>
                                </div>
                            </div>
                            <div>
                                <div class="text-sm font-semibold text-gray-700">伤病情况</div>
                                <div class="mt-3 flex gap-2">
                                    <button data-profile-group="injury" data-value="腰部" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="setProfileOption('injury','腰部')">腰部</button>
                                    <button data-profile-group="injury" data-value="膝盖" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="setProfileOption('injury','膝盖')">膝盖</button>
                                    <button data-profile-group="injury" data-value="无" class="px-4 py-2 border border-gray-300 rounded-lg text-sm" onclick="setProfileOption('injury','无')">无</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex-shrink-0 p-6 bg-white border-t">
                        <button class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow hover:bg-blue-700" onclick="saveUserProfile()">保存</button>
                    </div>
                </div>

                <div id="page-settings" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-home')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">设置</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50">
                        <div class="bg-white rounded-2xl shadow border border-gray-100 divide-y">
                            <button class="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-gray-50" onclick="showPage('page-settings-account')">
                                <div>
                                    <div class="text-sm font-semibold text-gray-900">账号管理</div>
                                    <div class="text-xs text-gray-500">手机号、安全验证、账号注销</div>
                                </div>
                                <span class="text-gray-400">›</span>
                            </button>
                            <button class="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-gray-50" onclick="showPage('page-settings-preference')">
                                <div>
                                    <div class="text-sm font-semibold text-gray-900">偏好设置</div>
                                    <div class="text-xs text-gray-500">蓝牙震指、卸力方式、无限组</div>
                                </div>
                                <span class="text-gray-400">›</span>
                            </button>
                            <button class="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-gray-50" onclick="showPage('page-settings-standby')">
                                <div>
                                    <div class="text-sm font-semibold text-gray-900">待机设置</div>
                                    <div class="text-xs text-gray-500">调节屏幕待机时长</div>
                                </div>
                                <span class="text-gray-400">›</span>
                            </button>
                            <button class="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-gray-50" onclick="showPage('page-settings-accessory')">
                                <div>
                                    <div class="text-sm font-semibold text-gray-900">配件设置</div>
                                    <div class="text-xs text-gray-500">维护设备已连接的配件列表</div>
                                </div>
                                <span class="text-gray-400">›</span>
                            </button>
                            <button class="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-gray-50" onclick="showPage('page-settings-language')">
                                <div>
                                    <div class="text-sm font-semibold text-gray-900">切换语言</div>
                                    <div class="text-xs text-gray-500">简体中文 / English（演示）</div>
                                </div>
                                <span class="text-gray-400">›</span>
                            </button>
                        </div>

                        <div class="bg-white rounded-2xl shadow border border-gray-100 divide-y">
                            <button class="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-gray-50" onclick="clearCacheData()">
                                <div class="text-sm font-semibold text-gray-900">清除缓存数据</div>
                                <span data-cache-badge class="text-xs text-gray-400">512MB</span>
                            </button>
                            <button class="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-gray-50" onclick="showToast('已跳转至协议与政策（示意）')">
                                <div class="text-sm font-semibold text-gray-900">协议与政策</div>
                                <span class="text-gray-400">›</span>
                            </button>
                            <button class="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-gray-50" onclick="requestFactoryReset()">
                                <div class="text-sm font-semibold text-gray-900">恢复出厂设置</div>
                                <span class="text-gray-400">›</span>
                            </button>
                            <div class="flex items-center justify-between px-4 py-4 text-sm text-gray-600">
                                <div>
                                    <div class="font-semibold text-gray-900">版本更新</div>
                                    <div class="text-xs text-gray-400">最新版本：V1.0.0</div>
                                </div>
                                <button class="px-3 py-1 rounded-lg border text-xs text-blue-600 hover:bg-blue-50" onclick="showToast('已是最新版本')">检查更新</button>
                            </div>
                            <div class="flex items-center justify-between px-4 py-4 text-sm text-gray-600">
                                <div>
                                    <div class="font-semibold text-gray-900">固件升级</div>
                                    <div class="text-xs text-gray-400">当前固件：5.0.0</div>
                                </div>
                                <button class="px-3 py-1 rounded-lg border text-xs text-blue-600 hover:bg-blue-50" onclick="showToast('固件升级已预约（示意）')">立即升级</button>
                            </div>
                        </div>

                        <button class="w-full bg-white rounded-2xl shadow border border-gray-100 px-4 py-4 text-sm font-semibold text-red-500 hover:bg-red-50" onclick="logout()">退出登录</button>
                    </div>
                </div>

                <div id="page-settings-account" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-settings')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">账号管理</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 bg-gray-50">
                        <div class="bg-white rounded-2xl shadow border border-gray-100 divide-y">
                            <button class="w-full flex items-center justify-between px-4 py-5 text-left hover:bg-gray-50" onclick="showToast('更换手机号（示意）')">
                                <div class="text-sm font-semibold text-gray-900">更换手机号</div>
                                <span class="text-gray-400">›</span>
                            </button>
                            <button class="w-full flex items-center justify-between px-4 py-5 text-left hover:bg-gray-50" onclick="showToast('修改密码（示意）')">
                                <div class="text-sm font-semibold text-gray-900">修改登录密码</div>
                                <span class="text-gray-400">›</span>
                            </button>
                            <button class="w-full flex items-center justify-between px-4 py-5 text-left hover:bg-gray-50" onclick="showToast('账号注销流程（示意）')">
                                <div class="text-sm font-semibold text-red-500">账号注销</div>
                                <span class="text-gray-400">›</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div id="page-settings-preference" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-settings')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">偏好设置</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-5 bg-gray-50">
                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6 space-y-4">
                            <div>
                                <div class="text-sm font-semibold text-gray-700">蓝牙震指</div>
                                <div class="mt-3 grid grid-cols-2 gap-3">
                                    <button data-pref-group="indicator" data-value="单击" class="px-4 py-3 border border-gray-300 rounded-lg text-sm" onclick="setPreferenceOption('indicator','单击')">单击</button>
                                    <button data-pref-group="indicator" data-value="双击" class="px-4 py-3 border border-gray-300 rounded-lg text-sm" onclick="setPreferenceOption('indicator','双击')">双击</button>
                                </div>
                            </div>
                            <div>
                                <div class="text-sm font-semibold text-gray-700">卸力方式</div>
                                <div class="mt-3 grid grid-cols-2 gap-3">
                                    <button data-pref-group="release" data-value="手动卸力" class="px-4 py-3 border border-gray-300 rounded-lg text-sm" onclick="setPreferenceOption('release','手动卸力')">手动卸力</button>
                                    <button data-pref-group="release" data-value="智能卸力" class="px-4 py-3 border border-gray-300 rounded-lg text-sm" onclick="setPreferenceOption('release','智能卸力')">智能卸力</button>
                                </div>
                            </div>
                            <div>
                                <div class="text-sm font-semibold text-gray-700">无限组</div>
                                <div class="mt-3 grid grid-cols-2 gap-3">
                                    <button data-pref-group="infinite" data-value="开启" class="px-4 py-3 border border-gray-300 rounded-lg text-sm" onclick="setPreferenceOption('infinite','开启')">开启</button>
                                    <button data-pref-group="infinite" data-value="关闭" class="px-4 py-3 border border-gray-300 rounded-lg text-sm" onclick="setPreferenceOption('infinite','关闭')">关闭</button>
                                </div>
                            </div>
                            <div>
                                <div class="text-sm font-semibold text-gray-700">1RM 记录方式</div>
                                <div class="mt-3 grid grid-cols-2 gap-3">
                                    <button data-pref-group="oneRM" data-value="左右分别记录1RM" class="px-4 py-3 border border-gray-300 rounded-lg text-sm" onclick="setPreferenceOption('oneRM','左右分别记录1RM')">左右分别记录1RM</button>
                                    <button data-pref-group="oneRM" data-value="统一记录1RM" class="px-4 py-3 border border-gray-300 rounded-lg text-sm" onclick="setPreferenceOption('oneRM','统一记录1RM')">统一记录1RM</button>
                                </div>
                            </div>
                        </div>
                        <button class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow hover:bg-blue-700" onclick="savePreferenceSettings()">保存</button>
                    </div>
                </div>

                <div id="page-settings-standby" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-settings')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">待机设置</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 bg-gray-50 space-y-4">
                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6">
                            <div class="text-sm font-semibold text-gray-700">待机时长</div>
                            <div class="mt-3 space-y-2" id="standby-options"></div>
                        </div>
                        <button class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow hover:bg-blue-700" onclick="saveStandbySettings()">保存</button>
                    </div>
                </div>

                <div id="page-settings-accessory" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-settings')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">配件设置</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50">
                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6 space-y-3">
                            <div class="text-sm text-gray-600">请选择拥有的配件</div>
                            <div class="grid grid-cols-2 gap-3" id="accessory-options"></div>
                        </div>
                        <button class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow hover:bg-blue-700" onclick="saveAccessorySettings()">保存</button>
                    </div>
                </div>

                <div id="page-settings-language" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-settings')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">切换语言</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50">
                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6 space-y-3">
                            <label class="flex items-center justify-between px-3 py-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <div>
                                    <div class="text-sm font-semibold text-gray-900">简体中文</div>
                                    <div class="text-xs text-gray-500">推荐 · 完整体验</div>
                                </div>
                                <input type="radio" name="language" value="zh-CN" checked class="accent-blue-600">
                            </label>
                            <label class="flex items-center justify-between px-3 py-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <div>
                                    <div class="text-sm font-semibold text-gray-900">English</div>
                                    <div class="text-xs text-gray-500">Coming Soon</div>
                                </div>
                                <input type="radio" name="language" value="en-US" class="accent-blue-600">
                            </label>
                        </div>
                        <button class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow hover:bg-blue-700" onclick="saveLanguageSettings()">保存</button>
                    </div>
                </div>

                <div id="page-my-training" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-my')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">我的训练</div>
                        <button class="ml-auto px-3 py-2 text-sm rounded-lg border border-gray-200 text-gray-600 hover:border-blue-400" onclick="showToast('筛选功能开发中（示意）')">筛选</button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50">
                        <div class="bg-gradient-to-r from-blue-600 to-indigo-500 text-white rounded-2xl shadow-lg p-6">
                            <div class="text-xs uppercase tracking-wider text-white/70">本月训练累计</div>
                            <div class="mt-3 grid grid-cols-4 gap-4 text-center">
                                <div><div class="text-sm text-white/70">总时长</div><div class="text-2xl font-bold">14h</div></div>
                                <div><div class="text-sm text-white/70">消耗</div><div class="text-2xl font-bold">8.6k kcal</div></div>
                                <div><div class="text-sm text-white/70">训练量</div><div class="text-2xl font-bold">42 t</div></div>
                                <div><div class="text-sm text-white/70">平均功率</div><div class="text-2xl font-bold">218 W</div></div>
                            </div>
                        </div>
                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6">
                            <div class="flex items-center justify-between">
                                <div class="text-lg font-bold text-gray-900">近 7 日训练记录</div>
                                <div class="text-xs text-gray-400">最新同步：今日 08:15</div>
                            </div>
                            <div id="my-training-list" class="mt-4 space-y-4"></div>
                        </div>
                    </div>
                </div>

                <div id="page-training-detail" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-my-training')">返回</button>
                        <div class="ml-4 font-bold text-gray-900" id="training-detail-title">训练详情</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50">
                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6 space-y-4">
                            <div class="flex items-center justify-between text-sm text-gray-500">
                                <div id="training-detail-date">--</div>
                                <div id="training-detail-device">设备：Motion Station</div>
                            </div>
                            <div class="grid grid-cols-4 gap-4 text-center">
                                <div><div class="text-xs text-gray-500">训练时长</div><div class="text-lg font-bold text-gray-900" id="training-detail-duration">--</div></div>
                                <div><div class="text-xs text-gray-500">训练量</div><div class="text-lg font-bold text-gray-900" id="training-detail-volume">--</div></div>
                                <div><div class="text-xs text-gray-500">卡路里</div><div class="text-lg font-bold text-gray-900" id="training-detail-calories">--</div></div>
                                <div><div class="text-xs text-gray-500">平均功率</div><div class="text-lg font-bold text-gray-900" id="training-detail-power">--</div></div>
                            </div>
                            <div id="training-detail-highlights" class="bg-blue-50 border border-blue-100 rounded-xl p-4 text-sm text-blue-700"></div>
                        </div>

                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6 space-y-4">
                            <div class="text-sm font-semibold text-gray-900">训练拆解</div>
                            <div id="training-detail-segments" class="space-y-3 text-sm text-gray-600"></div>
                        </div>
                    </div>
                    <div class="flex-shrink-0 p-6 bg-white border-t flex gap-3 justify-end">
                        <button class="px-4 py-2 border rounded-lg" onclick="showPage('page-my-training')">返回列表</button>
                        <button class="px-4 py-2 border rounded-lg text-blue-600 border-blue-400" onclick="openTrainingShare()">分享海报</button>
                    </div>
                </div>

                <div id="page-training-share" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-training-detail')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">分享海报预览</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 bg-gray-50 flex flex-col items-center gap-6">
                        <div class="bg-white rounded-3xl shadow-2xl border border-gray-100 w-full max-w-sm p-6 space-y-4 text-center">
                            <div class="text-xs uppercase text-gray-400 tracking-widest">Motion Station</div>
                            <div class="text-xl font-bold text-gray-900" id="share-title">—</div>
                            <div class="text-xs text-gray-500" id="share-subtitle">—</div>
                            <div class="grid grid-cols-3 gap-3 text-center text-xs">
                                <div><div class="text-gray-400">时长</div><div class="text-base font-bold text-gray-900" id="share-duration">--</div></div>
                                <div><div class="text-gray-400">卡路里</div><div class="text-base font-bold text-gray-900" id="share-calories">--</div></div>
                                <div><div class="text-gray-400">训练量</div><div class="text-base font-bold text-gray-900" id="share-volume">--</div></div>
                            </div>
                            <div class="h-40 rounded-2xl bg-gradient-to-br from-blue-100 to-indigo-200 flex items-center justify-center text-gray-500 text-sm">训练轨迹占位</div>
                            <div class="text-xs text-gray-500" id="share-highlight">—</div>
                        </div>
                        <button class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700" onclick="showToast('已保存至相册（示意）')">保存到相册</button>
                    </div>
                </div>

                <div id="page-my-favorites" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-my')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">我的收藏</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50">
                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-4">
                            <div class="grid grid-cols-3 text-center text-sm font-medium">
                                <button id="fav-tab-course" class="py-2 rounded-lg bg-blue-600 text-white" onclick="switchFavoriteTab('course')">课程</button>
                                <button id="fav-tab-action" class="py-2 rounded-lg text-gray-600 hover:bg-gray-50" onclick="switchFavoriteTab('action')">动作</button>
                                <button id="fav-tab-plan" class="py-2 rounded-lg text-gray-600 hover:bg-gray-50" onclick="switchFavoriteTab('plan')">计划</button>
                            </div>
                        </div>
                        <div id="favorite-list" class="space-y-4"></div>
                    </div>
                </div>

                <div id="page-my-plan" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-my')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">我的计划</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50">
                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-4">
                            <div class="grid grid-cols-2 text-center text-sm font-medium">
                                <button id="plan-tab-active" class="py-2 rounded-lg bg-blue-600 text-white" onclick="switchPlanTab('active')">进行中</button>
                                <button id="plan-tab-finished" class="py-2 rounded-lg text-gray-600 hover:bg-gray-50" onclick="switchPlanTab('finished')">已完成</button>
                            </div>
                        </div>
                        <div id="plan-list" class="space-y-4"></div>
                    </div>
                </div>

                <div id="page-training-data" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-my')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">训练数据总览</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white rounded-2xl shadow border border-gray-100 p-5">
                                <div class="text-xs text-gray-500">本月累计时长</div>
                                <div class="text-3xl font-bold text-gray-900 mt-2" id="overview-duration">14 小时 06 分</div>
                                <div class="text-xs text-emerald-500 mt-1">比上月 +12%</div>
                            </div>
                            <div class="bg-white rounded-2xl shadow border border-gray-100 p-5">
                                <div class="text-xs text-gray-500">总消耗</div>
                                <div class="text-3xl font-bold text-gray-900 mt-2" id="overview-calories">8,620 kcal</div>
                                <div class="text-xs text-emerald-500 mt-1">比上月 +9%</div>
                            </div>
                            <div class="bg-white rounded-2xl shadow border border-gray-100 p-5">
                                <div class="text-xs text-gray-500">平均心率</div>
                                <div class="text-3xl font-bold text-gray-900 mt-2" id="overview-heart">132 bpm</div>
                                <div class="text-xs text-gray-400 mt-1">峰值 168 bpm</div>
                            </div>
                            <div class="bg-white rounded-2xl shadow border border-gray-100 p-5">
                                <div class="text-xs text-gray-500">消耗趋势</div>
                                <div class="h-24 bg-gradient-to-r from-blue-100 to-blue-200 rounded-xl flex items-end gap-1 p-2" id="overview-chart"></div>
                            </div>
                        </div>
                        <div class="bg-white rounded-2xl shadow border border-gray-100 p-6">
                            <div class="text-sm font-semibold text-gray-900">热门训练类型占比</div>
                            <div class="mt-4 grid grid-cols-4 gap-4 text-center text-xs">
                                <div><div class="w-12 h-12 rounded-full mx-auto bg-blue-100 flex items-center justify-center text-blue-700 font-semibold">45%</div><div class="mt-2 text-gray-500">力量训练</div></div>
                                <div><div class="w-12 h-12 rounded-full mx-auto bg-emerald-100 flex items-center justify-center text-emerald-700 font-semibold">28%</div><div class="mt-2 text-gray-500">有氧</div></div>
                                <div><div class="w-12 h-12 rounded-full mx-auto bg-purple-100 flex items-center justify-center text-purple-700 font-semibold">17%</div><div class="mt-2 text-gray-500">普拉提</div></div>
                                <div><div class="w-12 h-12 rounded-full mx-auto bg-amber-100 flex items-center justify-center text-amber-700 font-semibold">10%</div><div class="mt-2 text-gray-500">拉伸恢复</div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="page-course" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-home')">返回</button>
                        <div class="ml-4 font-bold text-gray-900">全部训练</div>
                    </div>
                    <div class="flex-shrink-0 p-6 bg-white border-b">
                        <div class="max-w-3xl">
                            <input type="search" placeholder="搜索课程/计划/动作" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <div class="mt-4 grid grid-cols-4 text-center text-sm font-medium max-w-3xl">
                            <button id="lib-tab-course" class="py-2 bg-blue-600 text-white rounded-l-lg" onclick="switchCourseLib('course')">课程</button>
                            <button id="lib-tab-action" class="py-2 bg-gray-50 text-gray-700 border-t border-b" onclick="switchCourseLib('action')">动作</button>
                            <button id="lib-tab-plan" class="py-2 bg-gray-50 text-gray-700 border-t border-b" onclick="switchCourseLib('plan')">计划</button>
                            <button id="lib-tab-fav" class="py-2 bg-gray-50 text-gray-700 rounded-r-lg border" onclick="switchCourseLib('fav')">收藏</button>
                        </div>
                        <!-- 筛选开关按钮 -->
                        <div class="mt-2 flex justify-end max-w-3xl">
                            <button class="px-3 py-2 border rounded text-gray-700 hover:bg-gray-50" onclick="toggleLibFilter(true)">筛选</button>
                        </div>
                        <!-- 类型相关筛选器：放在 Tab 下方（默认收起） -->
                        <div id="lib-filter" class="hidden mt-3 max-w-3xl bg-white border rounded-xl p-4 shadow-sm"></div>
                        <div id="plan-banner" class="hidden mt-4 max-w-3xl">
                            <div class="relative overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 via-indigo-500 to-purple-500 text-white shadow-xl">
                                <div class="absolute -right-12 -bottom-12 w-56 h-56 bg-white/10 rounded-full blur-xl"></div>
                                <div class="absolute -left-10 -top-10 w-32 h-32 border border-white/20 rounded-full"></div>
                                <div class="p-6 md:p-8 relative z-10 flex flex-col gap-6 md:flex-row md:items-center md:justify-between">
                                    <div class="space-y-3 max-w-xl">
                                        <div class="text-sm uppercase tracking-[0.2em] text-white/80">定制计划</div>
                                        <div class="text-2xl md:text-3xl font-semibold leading-tight">MotionStation 智能个性化训练方案</div>
                                        <div class="text-sm text-white/90 leading-relaxed">
                                            填写基础体能信息，系统将依据训练目标、可用时间与设备数据生成周期化训练安排，并动态提醒伤病风险。
                                        </div>
                                        <div class="flex flex-wrap gap-2 text-[12px] text-white/80">
                                            <span class="px-3 py-1 rounded-full border border-white/40 backdrop-blur-sm">AI 匹配动作组合</span>
                                            <span class="px-3 py-1 rounded-full border border-white/40 backdrop-blur-sm">周频率灵活调整</span>
                                            <span class="px-3 py-1 rounded-full border border-white/40 backdrop-blur-sm">恢复提醒 & 风险评估</span>
                                        </div>
                                    </div>
                                    <button class="shrink-0 px-5 py-3 bg-white text-blue-600 text-sm md:text-base font-semibold rounded-xl shadow hover:bg-blue-50 transition" onclick="openCustomPlanIntro()">立即定制</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-3" id="lib-list-course">
                        <div class="bg-white rounded-xl shadow border border-gray-100 overflow-hidden flex" onclick="openCourseDetail('c1')">
                            <div class="w-28 h-24 bg-gray-100"></div>
                            <div class="flex-1 p-3">
                                <div class="flex items-center justify-between">
                                    <h3 class="font-semibold text-gray-900">燃脂普拉提</h3>
                                    <div class="flex items-center gap-2 text-xs"><span class="px-1.5 py-0.5 bg-yellow-100 text-yellow-700 rounded">中级</span><span class="px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded">普拉提</span></div>
                                </div>
                                <div class="mt-1 text-xs text-gray-500">33min · 217kcal</div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow border border-gray-100 overflow-hidden flex" onclick="openCourseDetail('c2')">
                            <div class="w-28 h-24 bg-gray-100"></div>
                            <div class="flex-1 p-3">
                                <div class="flex items-center justify-between">
                                    <h3 class="font-semibold text-gray-900">力量训练·核心</h3>
                                    <div class="flex items-center gap-2 text-xs"><span class="px-1.5 py-0.5 bg-red-100 text-red-700 rounded">高级</span><span class="px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded">力量训练</span></div>
                                </div>
                                <div class="mt-1 text-xs text-gray-500">45min · 320kcal</div>
                            </div>
                        </div>
                    </div>
                    <!-- 动作列表 -->
                    <div class="flex-1 overflow-y-auto p-6 hidden space-y-3" id="lib-list-action">
                        <div class="bg-white rounded-xl shadow border border-gray-100 overflow-hidden flex" onclick="openActionDetail('a1')">
                            <div class="w-28 h-24 bg-gray-100"></div>
                            <div class="flex-1 p-3">
                                <div class="flex items-center justify-between">
                                    <h3 class="font-semibold text-gray-900">俯身划船</h3>
                                    <div class="flex items-center gap-2 text-xs"><span class="px-1.5 py-0.5 bg-green-100 text-green-700 rounded">初级</span><span class="px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded">背部</span></div>
                                </div>
                                <div class="mt-1 text-xs text-gray-500">器械：手柄 · 目标：背阔肌</div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow border border-gray-100 overflow-hidden flex" onclick="openActionDetail('a2')">
                            <div class="w-28 h-24 bg-gray-100"></div>
                            <div class="flex-1 p-3">
                                <div class="flex items-center justify-between">
                                    <h3 class="font-semibold text-gray-900">推肩</h3>
                                    <div class="flex items-center gap-2 text-xs"><span class="px-1.5 py-0.5 bg-yellow-100 text-yellow-700 rounded">中级</span><span class="px-1.5 py-0.5 bg-sky-100 text-sky-700 rounded">肩部</span></div>
                                </div>
                                <div class="mt-1 text-xs text-gray-500">器械：红铃 · 目标：三角肌</div>
                            </div>
                        </div>
                    </div>
                    <!-- 计划列表 -->
                    <div class="flex-1 overflow-y-auto p-6 hidden" id="lib-list-plan">
                        <div id="plan-library" class="space-y-6 max-w-3xl"></div>
                    </div>
                    <!-- 收藏列表 -->
                    <div class="flex-1 overflow-y-auto p-6 hidden space-y-3" id="lib-list-fav">
                        <div class="bg-white rounded-xl shadow border border-gray-100 overflow-hidden flex" onclick="openCourseDetail('c1')">
                            <div class="w-20 h-20 bg-gray-100"></div>
                            <div class="flex-1 p-3">
                                <div class="text-sm font-semibold text-gray-900">收藏课程 · 燃脂普拉提</div>
                                <div class="text-xs text-gray-500 mt-1">33min · 普拉提</div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow border border-gray-100 overflow-hidden flex" onclick="openActionDetail('a1')">
                            <div class="w-20 h-20 bg-gray-100"></div>
                            <div class="flex-1 p-3">
                                <div class="text-sm font-semibold text-gray-900">收藏动作 · 俯身划船</div>
                                <div class="text-xs text-gray-500 mt-1">背部 · 初级</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 动作详情 -->
                <div id="page-action-detail" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 p-6 bg-white border-b flex items-center gap-3">
                        <button class="text-gray-600" onclick="showPage('page-course')">返回</button>
                        <h1 class="text-xl font-bold text-gray-900">动作详情</h1>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6">
                        <div class="h-48 bg-gray-100 rounded-xl"></div>
                        <div class="mt-4 flex items-center gap-2">
                            <h2 class="text-lg font-bold text-gray-900">俯身划船</h2>
                            <span class="text-xs px-2 py-0.5 bg-green-100 text-green-700 rounded">初级</span>
                            <span class="text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded">背部</span>
                        </div>
                        <div class="mt-3 text-sm text-gray-600">说明动作起始姿势、发力顺序与节奏控制，常见错误与纠正。</div>
                        <div class="mt-4 grid grid-cols-3 gap-4 text-sm">
                            <div class="bg-white border rounded p-3"><div class="text-gray-500 text-xs mb-1">器械</div>手柄、健身凳</div>
                            <div class="bg-white border rounded p-3"><div class="text-gray-500 text-xs mb-1">目标肌群</div>背阔肌、菱形肌</div>
                            <div class="bg-white border rounded p-3"><div class="text-gray-500 text-xs mb-1">呼吸建议</div>离心吸气，向心呼气</div>
                        </div>
                    </div>
                    <div class="flex-shrink-0 p-6 bg-white border-t flex gap-4">
                        <button class="flex-1 text-lg py-4 border rounded-lg" onclick="openScheduleOverlay()">加入日程</button>
                        <button class="flex-1 text-lg py-4 bg-blue-600 text-white rounded-lg" onclick="startTraining()">开始训练</button>
                    </div>
                </div>

                <!-- 计划详情 -->
                <div id="page-plan-detail" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 p-6 bg-white border-b flex items-center gap-3">
                        <button class="text-gray-600" onclick="showPage('page-course')">返回</button>
                        <h1 class="text-xl font-bold text-gray-900" id="plan-detail-header">计划详情</h1>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 bg-gray-50">
                        <div id="plan-detail-hero" class="relative overflow-hidden rounded-2xl h-48 bg-gradient-to-r from-blue-300 via-indigo-400 to-blue-600 text-white shadow">
                            <div class="absolute inset-0 opacity-20 bg-[radial-gradient(circle_at_top,_#ffffff33,_transparent_60%)]"></div>
                            <div class="absolute -right-12 -bottom-12 w-60 h-60 bg-white/10 rounded-full blur-3xl"></div>
                            <div class="absolute -left-14 -top-14 w-36 h-36 border border-white/20 rounded-full"></div>
                            <div class="relative z-10 h-full p-6 flex flex-col justify-end gap-2">
                                <div class="text-xs uppercase tracking-[0.3em] text-white/75" id="plan-detail-category">PERSONAL PLAN</div>
                                <div class="text-2xl font-semibold" id="plan-detail-title">计划名称</div>
                                <div class="flex flex-wrap gap-2 text-[12px]" id="plan-detail-tags"></div>
                            </div>
                        </div>

                        <div class="mt-6 grid grid-cols-1 md:grid-cols-4 gap-4" id="plan-detail-metrics">
                            <div class="bg-white rounded-2xl border border-gray-100 p-4 shadow-sm">
                                <div class="text-xs text-gray-500">周期长度</div>
                                <div class="text-xl font-semibold text-gray-900" id="plan-detail-weeks">-- 周</div>
                            </div>
                            <div class="bg-white rounded-2xl border border-gray-100 p-4 shadow-sm">
                                <div class="text-xs text-gray-500">每周频次</div>
                                <div class="text-xl font-semibold text-gray-900" id="plan-detail-frequency">每周 -- 次</div>
                            </div>
                            <div class="bg-white rounded-2xl border border-gray-100 p-4 shadow-sm">
                                <div class="text-xs text-gray-500">训练级别</div>
                                <div class="text-xl font-semibold text-gray-900" id="plan-detail-level">--</div>
                            </div>
                            <div class="bg-white rounded-2xl border border-gray-100 p-4 shadow-sm">
                                <div class="text-xs text-gray-500">重点部位</div>
                                <div class="text-xl font-semibold text-gray-900" id="plan-detail-focus">--</div>
                            </div>
                        </div>

                        <div class="mt-6 bg-white rounded-2xl border border-gray-100 p-5 shadow-sm">
                            <div class="text-sm font-semibold text-gray-900">计划简介</div>
                            <p class="mt-2 text-sm text-gray-600 leading-relaxed" id="plan-detail-desc">--</p>
                            <div class="mt-3 flex flex-wrap gap-2 text-xs text-gray-500" id="plan-detail-highlights"></div>
                        </div>

                        <div class="mt-6 bg-white rounded-2xl border border-gray-100 p-5 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div class="text-sm font-semibold text-gray-900">周安排预览</div>
                                <div class="text-xs text-gray-400" id="plan-detail-duration-tip"></div>
                            </div>
                            <div class="mt-4 grid grid-cols-7 gap-2 text-center text-xs" id="planDays"></div>
                            <div class="mt-4 space-y-2" id="planDayCourses"></div>
                        </div>

                        <div class="mt-6 bg-white rounded-2xl border border-gray-100 p-5 shadow-sm hidden" id="plan-detail-notes-wrap">
                            <div class="text-sm font-semibold text-gray-900 mb-2">教练建议</div>
                            <ul class="list-disc text-sm text-gray-600 pl-5 space-y-1" id="plan-detail-notes"></ul>
                        </div>
                    </div>
                    <div class="flex-shrink-0 p-6 bg-white border-t flex gap-4">
                        <button class="flex-1 text-lg py-4 border rounded-lg whitespace-nowrap" onclick="openPlanSetupOverlay()" id="plan-detail-join-btn">加入日程</button>
                        <button class="flex-1 text-lg py-4 bg-blue-600 text-white rounded-lg whitespace-nowrap" onclick="startTraining()" id="plan-detail-start-btn">开始训练</button>
                    </div>
                </div>

                <!-- 定制计划：介绍 -->
                <div id="page-custom-plan-intro" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 p-6 bg-white border-b flex items-center gap-3">
                        <button class="text-gray-600" onclick="switchCourseLib('plan'); showPage('page-course')">返回</button>
                        <h1 class="text-xl font-bold text-gray-900">智能定制计划</h1>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 bg-gray-50">
                        <div class="max-w-3xl mx-auto space-y-6">
                            <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden">
                                <div class="h-48 bg-gradient-to-br from-blue-100 via-blue-200 to-indigo-200 flex items-center justify-center text-blue-600 text-lg font-semibold">专属计划示意</div>
                                <div class="p-6 md:p-8 space-y-6">
                                    <div>
                                        <div class="text-sm text-blue-600 font-semibold uppercase tracking-[0.3em]">Personalized</div>
                                        <h2 class="mt-2 text-2xl md:text-3xl font-bold text-gray-900">基于个人体能画像的周期化训练方案</h2>
                                        <p class="mt-3 text-sm text-gray-600 leading-relaxed">
                                            结合身高体重、训练等级、目标以及设备使用数据，MotionStation 智能引擎自动匹配训练动作组合，
                                            提供包含热身、主训练和恢复的全周期计划，适配每周训练频次与时间段。
                                        </p>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                        <div class="bg-blue-50 rounded-2xl p-4">
                                            <div class="text-xs text-blue-600 font-medium">周期规划</div>
                                            <div class="mt-2 text-lg font-semibold text-blue-900">3~6 周梯度进阶</div>
                                            <p class="mt-1 text-xs text-blue-700/80 leading-relaxed">根据训练等级调整负荷节奏，提供每周进阶提示。</p>
                                        </div>
                                        <div class="bg-emerald-50 rounded-2xl p-4">
                                            <div class="text-xs text-emerald-600 font-medium">风险控制</div>
                                            <div class="mt-2 text-lg font-semibold text-emerald-900">动作替换推荐</div>
                                            <p class="mt-1 text-xs text-emerald-700/80 leading-relaxed">识别肩颈、腰背、膝踝等常见不适，自动规避高冲击动作。</p>
                                        </div>
                                        <div class="bg-purple-50 rounded-2xl p-4">
                                            <div class="text-xs text-purple-600 font-medium">智能跟进</div>
                                            <div class="mt-2 text-lg font-semibold text-purple-900">训练反馈追踪</div>
                                            <p class="mt-1 text-xs text-purple-700/80 leading-relaxed">完成打卡后自动调整下一周负荷，提醒恢复与拉伸。</p>
                                        </div>
                                    </div>
                                    <div class="bg-gray-50 rounded-2xl p-5 space-y-4">
                                        <div class="text-sm font-semibold text-gray-900">定制流程</div>
                                        <ol class="space-y-3 text-sm text-gray-600">
                                            <li class="flex gap-3">
                                                <span class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold">1</span>
                                                <div>
                                                    <div class="font-medium text-gray-900">填写个人基础信息</div>
                                                    <div class="text-xs text-gray-500 mt-1">包含训练目标、可用时间、关注部位及伤病情况。</div>
                                                </div>
                                            </li>
                                            <li class="flex gap-3">
                                                <span class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold">2</span>
                                                <div>
                                                    <div class="font-medium text-gray-900">AI 匹配与生成</div>
                                                    <div class="text-xs text-gray-500 mt-1">系统参考行业教练库与历史训练数据，输出周/日粒度计划。</div>
                                                </div>
                                            </li>
                                            <li class="flex gap-3">
                                                <span class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold">3</span>
                                                <div>
                                                    <div class="font-medium text-gray-900">查看并加入日程</div>
                                                    <div class="text-xs text-gray-500 mt-1">可一键同步至设备日程，设置提醒与强度提示。</div>
                                                </div>
                                            </li>
                                        </ol>
                                    </div>
                                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                        <div class="text-sm text-gray-500">建议准备最近一次体测数据，确保匹配结果更精准。</div>
                                        <button class="px-8 md:px-10 py-3 rounded-xl bg-blue-600 text-white font-semibold shadow hover:bg-blue-700 transition whitespace-nowrap" onclick="startCustomPlanForm()">开始填写</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 定制计划：基础资料表单 -->
                <div id="page-custom-plan-form" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 p-6 bg-white border-b flex items-center gap-3">
                        <button class="text-gray-600" onclick="showPage('page-custom-plan-intro')">返回</button>
                        <h1 class="text-xl font-bold text-gray-900">填写基础信息</h1>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 bg-gray-50">
                        <div class="max-w-3xl mx-auto space-y-6">
                            <div class="bg-white rounded-3xl border border-gray-100 shadow-sm p-6 md:p-8">
                                <div class="flex items-center justify-between flex-wrap gap-3">
                                    <div>
                                        <h2 class="text-xl font-semibold text-gray-900">个人基本信息</h2>
                                        <p class="text-sm text-gray-500 mt-1">用于匹配训练强度及动作库，不会对外显示。</p>
                                    </div>
                                    <div class="text-xs text-blue-600 bg-blue-50 px-3 py-1 rounded-full">预计耗时 1 分钟</div>
                                </div>
                                <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-5">
                                    <label class="space-y-2 text-sm text-gray-600">
                                        <span class="font-medium text-gray-900">昵称</span>
                                        <input id="custom-name" type="text" placeholder="例如：AA" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                                    </label>
                                    <label class="space-y-2 text-sm text-gray-600">
                                        <span class="font-medium text-gray-900">性别</span>
                                        <select id="custom-gender" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="女">女</option>
                                            <option value="男">男</option>
                                            <option value="其他">其他</option>
                                        </select>
                                    </label>
                                    <label class="space-y-2 text-sm text-gray-600">
                                        <span class="font-medium text-gray-900">身高 (cm)</span>
                                        <input id="custom-height" type="number" min="120" max="220" step="1" placeholder="例如：165" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                                    </label>
                                    <label class="space-y-2 text-sm text-gray-600">
                                        <span class="font-medium text-gray-900">体重 (kg)</span>
                                        <input id="custom-weight" type="number" min="30" max="160" step="0.5" placeholder="例如：50" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                                    </label>
                                    <label class="space-y-2 text-sm text-gray-600">
                                        <span class="font-medium text-gray-900">训练等级</span>
                                        <select id="custom-level" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="初学">初学</option>
                                            <option value="进阶">进阶</option>
                                            <option value="专业">专业</option>
                                        </select>
                                    </label>
                                    <label class="space-y-2 text-sm text-gray-600">
                                        <span class="font-medium text-gray-900">训练目标</span>
                                        <select id="custom-goal" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="增肌塑形">增肌塑形</option>
                                            <option value="减脂塑形">减脂塑形</option>
                                            <option value="力量提升">力量提升</option>
                                            <option value="体态改善">体态改善</option>
                                            <option value="康复恢复">康复恢复</option>
                                        </select>
                                    </label>
                                    <label class="space-y-2 text-sm text-gray-600">
                                        <span class="font-medium text-gray-900">每周可训练天数</span>
                                        <select id="custom-frequency" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="2">每周 2 天</option>
                                            <option value="3">每周 3 天</option>
                                            <option value="4">每周 4 天</option>
                                            <option value="5">每周 5 天</option>
                                        </select>
                                    </label>
                                    <label class="space-y-2 text-sm text-gray-600">
                                        <span class="font-medium text-gray-900">习惯训练时段</span>
                                        <select id="custom-time-slot" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="工作日早晨">工作日早晨</option>
                                            <option value="工作日晚间">工作日晚间</option>
                                            <option value="周末上午">周末上午</option>
                                            <option value="周末下午">周末下午</option>
                                        </select>
                                    </label>
                                </div>
                                <div class="mt-6">
                                    <div class="text-sm font-medium text-gray-900 mb-2">重点关注部位 (可多选)</div>
                                    <div class="flex flex-wrap gap-3" id="custom-focus-group">
                                        <button type="button" class="px-4 py-2 rounded-full border border-gray-200 text-sm text-gray-700 hover:border-blue-400 focus:outline-none" data-value="肩背" onclick="toggleFocusChip(this)">肩背</button>
                                        <button type="button" class="px-4 py-2 rounded-full border border-gray-200 text-sm text-gray-700 hover:border-blue-400 focus:outline-none" data-value="腰腹" onclick="toggleFocusChip(this)">腰腹</button>
                                        <button type="button" class="px-4 py-2 rounded-full border border-gray-200 text-sm text-gray-700 hover:border-blue-400 focus:outline-none" data-value="臀腿" onclick="toggleFocusChip(this)">臀腿</button>
                                        <button type="button" class="px-4 py-2 rounded-full border border-gray-200 text-sm text-gray-700 hover:border-blue-400 focus:outline-none" data-value="全身心肺" onclick="toggleFocusChip(this)">全身心肺</button>
                                        <button type="button" class="px-4 py-2 rounded-full border border-gray-200 text-sm text-gray-700 hover:border-blue-400 focus:outline-none" data-value="柔韧恢复" onclick="toggleFocusChip(this)">柔韧恢复</button>
                                    </div>
                                </div>
                                <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-5">
                                    <label class="space-y-2 text-sm text-gray-600">
                                        <span class="font-medium text-gray-900">是否存在伤病情况</span>
                                        <select id="custom-injury" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="无">无</option>
                                            <option value="肩颈不适">肩颈不适</option>
                                            <option value="腰背不适">腰背不适</option>
                                            <option value="膝踝不适">膝踝不适</option>
                                        </select>
                                    </label>
                                    <label class="space-y-2 text-sm text-gray-600">
                                        <span class="font-medium text-gray-900">额外备注 (选填)</span>
                                        <textarea id="custom-note" rows="3" placeholder="例如：膝盖不宜跳跃、偏好哑铃训练" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
                                    </label>
                                </div>
                            </div>

                            <div class="bg-white rounded-3xl border border-gray-100 shadow-sm p-6 md:p-8">
                                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                    <div>
                                        <div class="text-lg font-semibold text-gray-900">准备生成计划</div>
                                        <div class="text-sm text-gray-500 mt-1">系统将结合行业教练模板及近 30 天训练数据智能匹配。</div>
                                    </div>
                                    <div class="flex gap-3">
                                        <button class="px-6 py-3 border border-gray-300 rounded-xl text-gray-700 whitespace-nowrap" onclick="showPage('page-custom-plan-intro')">稍后再说</button>
                                        <button class="px-8 py-3 bg-blue-600 text-white rounded-xl font-semibold shadow hover:bg-blue-700 transition whitespace-nowrap" onclick="submitCustomPlanForm()">保存并生成</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 课程详情 -->
                <div id="page-course-detail" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 p-6 bg-white border-b flex items-center gap-3">
                        <button class="text-gray-600" onclick="showPage('page-course')">返回</button>
                        <h1 class="text-xl font-bold text-gray-900">课程详情</h1>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6">
                        <div class="h-48 bg-gray-100 rounded-xl"></div>
                        <div class="mt-4 flex items-center gap-2">
                            <h2 class="text-lg font-bold text-gray-900">力量训练·核心</h2>
                            <span class="text-xs px-2 py-0.5 bg-yellow-100 text-yellow-700 rounded">中级</span>
                            <span class="text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded">力量训练</span>
                        </div>
                        <div class="mt-2 text-sm text-gray-600 flex gap-6"><span>33min</span><span>1090kg</span><span>217kcal</span></div>
                        <div class="mt-4">
                            <h3 class="font-semibold text-gray-900">器械</h3>
                            <div class="mt-2 flex flex-wrap gap-2"><span class="text-xs px-2 py-0.5 bg-red-100 text-red-700 rounded">红铃</span><span class="text-xs px-2 py-0.5 bg-green-100 text-green-700 rounded">健身凳</span></div>
                        </div>
                        <div class="mt-4">
                            <h3 class="font-semibold text-gray-900">训练安排</h3>
                            <div class="mt-2 space-y-2">
                                <div class="bg-white border rounded p-3 flex items-center gap-3"><div class="w-10 h-10 bg-gray-100 rounded"></div><div class="flex-1"><div class="text-sm font-medium">动作名称</div><div class="text-xs text-gray-500">1.02.00</div></div></div>
                                <div class="bg-white border rounded p-3 flex items-center gap-3"><div class="w-10 h-10 bg-gray-100 rounded"></div><div class="flex-1"><div class="text-sm font-medium">动作名称</div><div class="text-xs text-gray-500">2.02.00</div></div></div>
                            </div>
                        </div>
                    </div>
                    <!-- 底部大按钮 -->
                    <div class="flex-shrink-0 p-6 bg-white border-t flex gap-4">
                        <button class="flex-1 text-lg py-4 border rounded-lg" onclick="openScheduleOverlay()">加入日程</button>
                        <button class="flex-1 text-lg py-4 bg-blue-600 text-white rounded-lg" onclick="startTraining()">开始训练</button>
                    </div>
                </div>

                <!-- 训练中（播放器） -->
                <div id="page-training" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 p-4 bg-white border-b">
                        <div class="flex items-center justify-between">
                            <div class="font-bold text-gray-900">当前动作名称</div>
                            <div class="flex items-center gap-3 text-gray-600">
                                <button class="px-2 py-1 border rounded" onclick="trainingRewind()">« 快退</button>
                                <button id="btnPlayPause" class="px-2 py-1 border rounded" onclick="trainingPlayPause()">暂停</button>
                                <button class="px-2 py-1 border rounded" onclick="trainingForward()">快进 »</button>
                                <button class="px-2 py-1 border rounded" onclick="trainingReset()">重置</button>
                                <button class="px-2 py-1 border rounded text-red-600" onclick="trainingEnd()">结束</button>
                            </div>
                        </div>
                        <div class="mt-3 flex items-center gap-3">
                            <div class="h-2 flex-1 bg-gray-200 rounded overflow-hidden">
                                <div id="progressBar" class="h-full bg-blue-600" style="width:0%"></div>
                            </div>
                            <div id="timeText" class="text-xs text-gray-500 w-28 text-right">00:00 / 00:00</div>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6">
                        <div class="h-60 bg-gray-100 rounded-xl flex items-center justify-center text-gray-400">视频占位（自动播放）</div>
                        <!-- 传感器图表 -->
                        <div class="mt-6 grid grid-cols-12 gap-6">
                            <div class="col-span-6">
                                <div class="text-xs text-gray-500 mb-1">动作功率</div>
                                <div class="h-24 bg-white border rounded-xl p-3 flex items-end gap-1" id="powerBars"></div>
                            </div>
                            <div class="col-span-6">
                                <div class="text-xs text-gray-500 mb-1">动作幅度 L/R</div>
                                <div class="h-24 bg-white border rounded-xl p-3 grid grid-cols-2 gap-2">
                                    <div class="flex items-end gap-1" id="ampBarsL"></div>
                                    <div class="flex items-end gap-1" id="ampBarsR"></div>
                                </div>
                            </div>
                        </div>
                        <!-- 重量 / 模式 / 助力 区域 -->
                        <div class="mt-6">
                            <div class="bg-white border rounded-xl p-5">
                                <div class="flex items-center justify-center gap-6">
                                    <button class="px-5 py-3 border rounded text-lg" onclick="adjustWeight(-0.5)">-0.5kg</button>
                                    <div class="text-center">
                                        <div class="text-xs text-gray-500">重量</div>
                                        <div id="weightVal" class="text-4xl font-bold my-1">7.0kg</div>
                                    </div>
                                    <button class="px-5 py-3 border rounded text-lg" onclick="adjustWeight(0.5)">+0.5kg</button>
                                </div>
                                <div class="flex gap-3 justify-center mt-4">
                                    <button class="px-4 py-2 border rounded" onclick="openModeOverlay()">模式切换</button>
                                    <button id="assistSwitchBtn" class="px-4 py-2 border rounded" onclick="toggleAssistDirect()">助力：开</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 加入日程 弹层 -->
                <div id="overlay-schedule" class="hidden absolute inset-0 z-40">
                    <div class="absolute inset-0 bg-black/30" onclick="closeScheduleOverlay()"></div>
                    <div id="overlay-schedule-sheet" class="absolute inset-x-0 bottom-0 bg-white rounded-t-2xl shadow-2xl p-4 transform translate-y-full transition-transform duration-200 ease-out">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-bold text-gray-900">选择日期</h3>
                            <button class="text-gray-500" onclick="closeScheduleOverlay()">关闭</button>
                        </div>
                        <div class="mt-3">
                            <div id="calendar" class="grid grid-cols-7 gap-2 text-center text-sm text-gray-700"></div>
                        </div>
                        <div class="mt-4 flex items-center">
                            <div class="w-14 h-10 bg-gray-100 rounded mr-3"></div>
                            <div class="text-sm text-gray-700">课程名称 · <span id="schedule-date-text" class="font-medium">未选择</span></div>
                        </div>
                        <div class="mt-4">
                            <button onclick="confirmAddToSchedule()" id="btn-add-schedule" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg disabled:opacity-50" disabled>加入日程</button>
                        </div>
                    </div>
                </div>

                <!-- 计划设置 弹层（加入计划） -->
                <div id="overlay-plan-setup" class="hidden absolute inset-0 z-40">
                    <div class="absolute inset-0 bg-black/30" onclick="closePlanSetupOverlay()"></div>
                    <div id="overlay-plan-sheet" class="absolute inset-x-0 bottom-0 bg-white rounded-t-2xl shadow-2xl p-4 transform translate-y-full transition-transform duration-200 ease-out">
                        <div class="text-lg font-bold text-gray-900">计划设置</div>
                        <div class="mt-3">
                            <div class="text-sm text-gray-700 mb-2">希望计划开始的时间</div>
                            <div class="grid grid-cols-2 gap-2">
                                <button class="px-3 py-2 border rounded" onclick="selectPlanStart('today', this)">今天</button>
                                <button class="px-3 py-2 border rounded" onclick="selectPlanStart('tomorrow', this)">明天</button>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="text-sm text-gray-700 mb-2">请选择每周的训练日</div>
                            <div id="plan-days" class="grid grid-cols-7 gap-2">
                                <button class="px-2 py-2 border rounded" data-day="1">一</button>
                                <button class="px-2 py-2 border rounded" data-day="2">二</button>
                                <button class="px-2 py-2 border rounded" data-day="3">三</button>
                                <button class="px-2 py-2 border rounded" data-day="4">四</button>
                                <button class="px-2 py-2 border rounded" data-day="5">五</button>
                                <button class="px-2 py-2 border rounded" data-day="6">六</button>
                                <button class="px-2 py-2 border rounded" data-day="7">日</button>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button id="btn-enter-plan" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg" onclick="confirmEnterPlan()">加入计划</button>
                        </div>
                    </div>
                </div>

                <!-- 模式切换弹层 -->
                <div id="overlay-mode" class="hidden absolute inset-0 z-40">
                    <div class="absolute inset-0 bg-black/50" onclick="closeModeOverlay()"></div>
                    <div class="absolute inset-x-0 bottom-0 bg-white rounded-t-2xl shadow-2xl p-6">
                        <div class="text-lg font-bold text-gray-900 mb-4">模式切换</div>
                        <div class="grid grid-cols-3 gap-3">
                            <button class="px-3 py-2 border rounded" onclick="setTrainingMode('标准')">标准</button>
                            <button class="px-3 py-2 border rounded" onclick="setTrainingMode('等速')">等速</button>
                            <button class="px-3 py-2 border rounded" onclick="setTrainingMode('等距')">等距</button>
                        </div>
                        <div class="mt-4">
                            <button class="w-full px-3 py-2 border rounded" onclick="closeModeOverlay()">关闭</button>
                        </div>
                    </div>
                </div>

                

                <!-- 训练报告 -->
                <div id="page-report" class="page flex-col h-full bg-white">
                    <div class="flex-shrink-0 h-12 bg-white border-b flex items-center px-6">
                        <button class="text-gray-600" onclick="showPage('page-home')">完成</button>
                        <div class="ml-4 font-bold text-gray-900">训练报告</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-6">
                        <!-- 总览指标 -->
                        <div class="bg-white rounded-xl border p-4 grid grid-cols-4 gap-4">
                            <div><div class="text-xs text-gray-500">时长</div><div id="repDur" class="text-xl font-bold">--</div></div>
                            <div><div class="text-xs text-gray-500">总量(kg)</div><div id="repVol" class="text-xl font-bold">--</div></div>
                            <div><div class="text-xs text-gray-500">总消耗(kcal)</div><div id="repCal" class="text-xl font-bold">--</div></div>
                            <div><div class="text-xs text-gray-500">动作次数</div><div id="repReps" class="text-xl font-bold">--</div></div>
                            <div><div class="text-xs text-gray-500">平均功率(W)</div><div id="repPowerAvg" class="text-xl font-bold">--</div></div>
                            <div><div class="text-xs text-gray-500">峰值功率(W)</div><div id="repPowerPeak" class="text-xl font-bold">--</div></div>
                            <div><div class="text-xs text-gray-500">平均节奏(次/分)</div><div id="repCadence" class="text-xl font-bold">--</div></div>
                            <div><div class="text-xs text-gray-500">ROM 左/右(%)</div><div id="repROM" class="text-xl font-bold">--</div></div>
                        </div>

                        <!-- 强度分布 -->
                        <div class="bg-white rounded-xl border p-4">
                            <div class="text-sm text-gray-700 mb-3">强度分布（功率区间）</div>
                            <div class="w-full h-6 bg-gray-100 rounded overflow-hidden flex" id="repZones"></div>
                            <div class="mt-2 text-xs text-gray-500" id="repZoneLabel"></div>
                        </div>

                        <!-- 组别明细 -->
                        <div class="bg-white rounded-xl border p-4">
                            <div class="text-sm text-gray-700 mb-3">组别明细</div>
                            <div class="grid grid-cols-5 text-xs text-gray-500 px-2 py-1">
                                <div>组次</div><div>次数</div><div>重量(kg)</div><div>平均功率(W)</div><div>RPE</div>
                            </div>
                            <div id="repSetTable" class="divide-y"></div>
                        </div>

                        <!-- 趋势图占位 -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white rounded-xl border p-4">
                                <div class="text-sm text-gray-700 mb-2">功率曲线</div>
                                <div id="repPowerCurve" class="h-32 bg-gray-100 rounded"></div>
                            </div>
                            <div class="bg-white rounded-xl border p-4">
                                <div class="text-sm text-gray-700 mb-2">心率曲线</div>
                                <div id="repHeartCurve" class="h-32 bg-gray-100 rounded"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 自由训练选择 弹层 -->
                <div id="overlay-free-select" class="hidden absolute inset-0 z-40">
                    <div class="absolute inset-0 bg-black/40" onclick="closeFreeSelectOverlay()"></div>
                    <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-2xl w-[520px] max-w-[90vw] p-6">
                        <div class="text-lg font-bold text-gray-900 mb-4">选择自由训练类型</div>
                        <div class="grid grid-cols-2 gap-4">
                            <button class="p-4 border rounded-xl hover:bg-gray-50 text-left" onclick="startFreeTraining('strength')">
                                <div class="h-28 bg-gray-100 rounded mb-3"></div>
                                <div class="font-semibold">力量训练</div>
                                <div class="text-xs text-gray-500 mt-1">适用于力量/增肌类动作</div>
                            </button>
                            <button class="p-4 border rounded-xl hover:bg-gray-50 text-left" onclick="startFreeTraining('pilates')">
                                <div class="h-28 bg-gray-100 rounded mb-3"></div>
                                <div class="font-semibold">普拉提训练</div>
                                <div class="text-xs text-gray-500 mt-1">适用于普拉提/控制训练</div>
                            </button>
                        </div>
                        <div class="mt-4 text-right">
                            <button class="px-4 py-2 border rounded" onclick="closeFreeSelectOverlay()">取消</button>
                        </div>
                    </div>
                </div>

                <!-- 地区选择 弹层（底部抽屉） -->
                <div id="overlay-region" class="hidden absolute inset-0 z-40">
                    <div class="absolute inset-0 bg-black/30" onclick="closeRegionPicker()"></div>
                    <div id="overlay-region-sheet" class="absolute inset-x-0 bottom-0 bg-white rounded-t-2xl shadow-2xl p-4 transform translate-y-full transition-transform duration-200 ease-out">
                        <div class="text-lg font-bold text-gray-900">选择地区</div>
                        <div class="mt-3 space-y-2" id="region-list"></div>
                        <div class="mt-4 flex justify-end gap-3">
                            <button class="px-3 py-2 border rounded" onclick="closeRegionPicker()">取消</button>
                            <button id="btn-confirm-region" class="px-3 py-2 bg-blue-600 text-white rounded disabled:opacity-50" onclick="confirmRegion()" disabled>确定</button>
                        </div>
                    </div>
                </div>

                <!-- 自由训练：力量 -->
                <div id="page-free-strength" class="page flex-col h-full bg-white">
                    <!-- 顶栏：头像与结束按钮 -->
                    <div class="flex-shrink-0 p-4 bg-white border-b flex items-center">
                        <div class="flex items-center gap-3">
                            <img src="https://placehold.co/40x40/E2E8F0/94A3B8?text=U" class="w-10 h-10 rounded-full">
                            <div class="text-sm text-gray-600">当前登录用户</div>
                        </div>
                        <button class="ml-auto px-3 py-2 border rounded text-red-600" onclick="freeEnd()">结束训练</button>
                    </div>
                    <!-- 运动信息 -->
                    <div class="flex-shrink-0 p-4 bg-white border-b">
                        <div class="grid grid-cols-4 text-center text-sm text-gray-700">
                            <div>时长<br><span id="freeDur" class="font-bold text-gray-900">00:00</span></div>
                            <div>容量(kg)<br><span id="freeVol" class="font-bold text-gray-900">0</span></div>
                            <div>输出能量<br><span id="freeEnergy" class="font-bold text-gray-900">0</span></div>
                            <div>卡路里(kcal)<br><span id="freeCal" class="font-bold text-gray-900">0</span></div>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-6">
                        <!-- 模式选择 -->
                        <div>
                            <div class="text-xs text-gray-500 mb-2">重量模式</div>
                            <div class="grid grid-cols-4 gap-2">
                                <button id="wm-标准" class="px-3 py-2 border rounded bg-blue-600 text-white" onclick="setStrengthWeightMode('标准')">标准</button>
                                <button id="wm-离心" class="px-3 py-2 border rounded" onclick="setStrengthWeightMode('离心')">离心</button>
                                <button id="wm-等速" class="px-3 py-2 border rounded" onclick="setStrengthWeightMode('等速')">等速</button>
                                <button id="wm-弹簧" class="px-3 py-2 border rounded" onclick="setStrengthWeightMode('弹簧')">弹簧</button>
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-6">
                            <div>
                                <div class="text-xs text-gray-500 mb-2">配件模式</div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="acc-非杠铃" class="px-3 py-2 border rounded bg-blue-600 text-white" onclick="setStrengthAccessory('非杠铃')">非杠铃</button>
                                    <button id="acc-杠铃" class="px-3 py-2 border rounded" onclick="setStrengthAccessory('杠铃')">杠铃</button>
                                </div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500 mb-2">屏幕翻转</div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="flip-不翻转" class="px-3 py-2 border rounded bg-blue-600 text-white" onclick="toggleStrengthFlip(false)">不翻转</button>
                                    <button id="flip-翻转" class="px-3 py-2 border rounded" onclick="toggleStrengthFlip(true)">翻转</button>
                                </div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500 mb-2">助力模式</div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="assist-关" class="px-3 py-2 border rounded bg-blue-600 text-white" onclick="toggleStrengthAssist(false)">助力关</button>
                                    <button id="assist-开" class="px-3 py-2 border rounded" onclick="toggleStrengthAssist(true)">助力开</button>
                                </div>
                            </div>
                        </div>
                        <!-- 动作功率/幅度 -->
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <div class="text-xs text-gray-500 mb-1">动作功率</div>
                                <div class="h-24 bg-white border rounded-xl p-3 flex items-end gap-1" id="freePowerBars"></div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500 mb-1">动作幅度 L/R</div>
                                <div class="h-24 bg-white border rounded-xl p-3 grid grid-cols-2 gap-2">
                                    <div class="flex items-end gap-1" id="freeAmpBarsL"></div>
                                    <div class="flex items-end gap-1" id="freeAmpBarsR"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 重量仪表与加减 -->
                        <div class="bg-white border rounded-xl p-6 text-center">
                            <div class="flex items-center justify-center gap-6">
                                <button class="px-5 py-3 border rounded text-lg" onclick="freeAdjustWeight(-0.5)">-0.5kg</button>
                                <div class="w-40 h-40 rounded-full border-4 border-gray-200 flex items-center justify-center">
                                    <div id="freeWeightVal" class="text-3xl font-bold">6.5kg</div>
                                </div>
                                <button class="px-5 py-3 border rounded text-lg" onclick="freeAdjustWeight(0.5)">+0.5kg</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 自由训练：普拉提 -->
                <div id="page-free-pilates" class="page flex-col h-full bg-white">
                    <!-- 顶栏 -->
                    <div class="flex-shrink-0 p-4 bg-white border-b flex items-center">
                        <div class="flex items-center gap-3">
                            <img src="https://placehold.co/40x40/E2E8F0/94A3B8?text=U" class="w-10 h-10 rounded-full">
                            <div class="text-sm text-gray-600">当前登录用户</div>
                        </div>
                    <button class="ml-auto px-3 py-2 border rounded text-red-600" onclick="pilEnd()">结束训练</button>
                    </div>
                    <!-- 运动信息 -->
                    <div class="flex-shrink-0 p-4 bg-white border-b">
                        <div class="grid grid-cols-4 text-center text-sm text-gray-700">
                            <div>时长<br><span id="pilDur" class="font-bold text-gray-900">00:00</span></div>
                            <div>阻力(kg)<br><span id="pilRes" class="font-bold text-gray-900">0</span></div>
                            <div>输出能量<br><span id="pilEnergy" class="font-bold text-gray-900">0</span></div>
                            <div>卡路里(kcal)<br><span id="pilCal" class="font-bold text-gray-900">0</span></div>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-6">
                        <!-- 弹簧模式（可多选） -->
                        <div>
                            <div class="text-xs text-gray-500 mb-2">弹簧模式（可多选）</div>
                            <div class="flex flex-wrap gap-3" id="pilSpringChips">
                                <button class="w-16 h-16 rounded-full border flex items-center justify-center" data-w="4" onclick="toggleSpring(this)">4kg</button>
                                <button class="w-16 h-16 rounded-full border flex items-center justify-center" data-w="6.5" onclick="toggleSpring(this)">6.5kg</button>
                                <button class="w-16 h-16 rounded-full border flex items-center justify-center" data-w="6.5" onclick="toggleSpring(this)">6.5kg</button>
                                <button class="w-16 h-16 rounded-full border flex items-center justify-center" data-w="12" onclick="toggleSpring(this)">12kg</button>
                                <button class="w-16 h-16 rounded-full border flex items-center justify-center" data-w="12" onclick="toggleSpring(this)">12kg</button>
                            </div>
                        </div>
                        <!-- 助力与屏幕 -->
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <div class="text-xs text-gray-500 mb-2">助力模式</div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="pil-assist-关" class="px-3 py-2 border rounded bg-blue-600 text-white" onclick="togglePilAssist(false)">助力关</button>
                                    <button id="pil-assist-开" class="px-3 py-2 border rounded" onclick="togglePilAssist(true)">助力开</button>
                                </div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500 mb-2">屏幕翻转</div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="pil-flip-不翻转" class="px-3 py-2 border rounded bg-blue-600 text-white" onclick="togglePilFlip(false)">不翻转</button>
                                    <button id="pil-flip-翻转" class="px-3 py-2 border rounded" onclick="togglePilFlip(true)">翻转</button>
                                </div>
                            </div>
                        </div>

                        <!-- 阻力仪表与加减 -->
                        <div class="bg-white border rounded-xl p-6 text-center">
                            <div class="flex items-center justify-center gap-6">
                                <button class="px-5 py-3 border rounded text-lg" onclick="pilAdjustWeight(-0.5)">-0.5kg</button>
                                <div class="w-40 h-40 rounded-full border-4 border-gray-200 flex items-center justify-center">
                                    <div id="pilWeightVal" class="text-3xl font-bold">0.0kg</div>
                                </div>
                                <button class="px-5 py-3 border rounded text-lg" onclick="pilAdjustWeight(0.5)">+0.5kg</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 自由训练：结束报告 -->
                <div id="page-free-report" class="page flex-col h-full bg-white">
                    <div class="flex-1 overflow-y-auto p-6 space-y-6">
                        <!-- 概览 -->
                        <div class="grid grid-cols-4 gap-4 text-center">
                            <div class="bg-white border rounded p-3"><div class="text-xs text-gray-500">时长</div><div id="frDur" class="text-xl font-bold">--</div></div>
                            <div class="bg-white border rounded p-3"><div class="text-xs text-gray-500">训练量(kg)</div><div id="frVol" class="text-xl font-bold">--</div></div>
                            <div class="bg-white border rounded p-3"><div class="text-xs text-gray-500">卡路里(kcal)</div><div id="frCal" class="text-xl font-bold">--</div></div>
                            <div class="bg-white border rounded p-3"><div class="text-xs text-gray-500">平均功率/节奏</div><div id="frAvg" class="text-xl font-bold">--</div></div>
                        </div>

                        <!-- 训练设置回顾 -->
                        <div class="bg-white border rounded p-4">
                            <div class="text-sm text-gray-700 mb-2">训练设置</div>
                            <div class="grid grid-cols-4 gap-3 text-sm">
                                <div>模式：<span id="frMode">--</span></div>
                                <div>配件：<span id="frAccessory">--</span></div>
                                <div>助力：<span id="frAssist">--</span></div>
                                <div>翻转：<span id="frFlip">--</span></div>
                            </div>
                            <div class="mt-2 text-sm" id="frSpringWrap" style="display:none;">弹簧组合：<span id="frSprings">--</span></div>
                        </div>

                        <!-- 强度分布（功率/节奏区间） -->
                        <div class="bg-white border rounded p-4">
                            <div class="text-sm text-gray-700 mb-2">强度分布</div>
                            <div class="w-full h-6 bg-gray-100 rounded overflow-hidden flex" id="frZones"></div>
                            <div class="mt-2 text-xs text-gray-500" id="frZonesLabel"></div>
                        </div>

                        <!-- 组次估算 / 趋势占位 -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white border rounded p-4">
                                <div class="text-sm text-gray-700 mb-2">组次估算</div>
                                <div class="grid grid-cols-5 text-xs text-gray-500 px-2 py-1"><div>组次</div><div>次数</div><div>重量(kg)</div><div>平均功率</div><div>RPE</div></div>
                                <div id="frSetTable" class="divide-y"></div>
                            </div>
                            <div class="bg-white border rounded p-4">
                                <div class="text-sm text-gray-700 mb-2">训练曲线</div>
                                <div id="frCurve" class="h-32 bg-gray-100 rounded"></div>
                            </div>
                        </div>
                    </div>
                    <div class="flex-shrink-0 p-6 bg-white border-t flex gap-3 justify-end">
                        <button class="px-4 py-2 border rounded" onclick="showPage('page-home')">返回</button>
                        <button class="px-4 py-2 bg-blue-600 text-white rounded" onclick="showToast('已保存到数据记录')">保存到数据记录</button>
                    </div>
                </div>

                <!-- 游客模式：独立预览界面（与登录后不同） -->
                <div id="page-guest" class="page flex-col h-full bg-white relative">
                    <div class="p-8 border-b">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm text-gray-500">当前：游客用户</div>
                                <div class="text-xl font-bold text-gray-900 mt-1">欢迎体验</div>
                            </div>
                            <button class="px-3 py-2 text-sm border rounded-lg opacity-50 cursor-not-allowed" disabled>登录账号</button>
                        </div>
                        <div class="mt-4 text-sm text-gray-600">在游客模式下可以浏览示例课程和计划，但不会保存个人数据。</div>
                    </div>
                <div class="p-8 space-y-8">
                    <!-- 快速体验 -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-white rounded-xl p-4 border">
                            <div class="text-xs text-gray-500">示例课程</div>
                            <div class="h-24 bg-gray-100 rounded mt-2"></div>
                            <button class="w-full mt-3 bg-blue-600 text-white text-sm py-2 rounded opacity-50 cursor-not-allowed" disabled>开始自由训练</button>
                        </div>
                        <div class="bg-white rounded-xl p-4 border">
                            <div class="text-xs text-gray-500">训练计划预览</div>
                            <div class="h-24 bg-gray-100 rounded mt-2"></div>
                            <button class="w-full mt-3 border text-gray-700 text-sm py-2 rounded opacity-50 cursor-not-allowed" disabled>加入计划（需登录）</button>
                        </div>
                        <div class="bg-white rounded-xl p-4 border">
                            <div class="text-xs text-gray-500">动作教学</div>
                            <div class="h-24 bg-gray-100 rounded mt-2"></div>
                            <button class="w-full mt-3 border text-gray-700 text-sm py-2 rounded opacity-50 cursor-not-allowed" disabled>收藏（需登录）</button>
                        </div>
                    </div>

                    <!-- 课程精选 -->
                    <div>
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-900">课程精选</h3>
                            <button class="text-sm text-blue-600 opacity-50 cursor-not-allowed" disabled>更多</button>
                        </div>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="h-28 bg-gray-100 rounded-xl"></div>
                            <div class="h-28 bg-gray-100 rounded-xl"></div>
                            <div class="h-28 bg-gray-100 rounded-xl"></div>
                        </div>
                    </div>

                    <!-- 训练计划 -->
                    <div>
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-900">训练计划</h3>
                            <button class="text-sm text-blue-600 opacity-50 cursor-not-allowed" disabled>更多</button>
                        </div>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="h-24 bg-gray-100 rounded-xl"></div>
                            <div class="h-24 bg-gray-100 rounded-xl"></div>
                            <div class="h-24 bg-gray-100 rounded-xl"></div>
                        </div>
                    </div>

                    <!-- 动作教学 -->
                    <div>
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-900">动作教学</h3>
                            <button class="text-sm text-blue-600 opacity-50 cursor-not-allowed" disabled>更多</button>
                        </div>
                        <div class="grid grid-cols-4 gap-4">
                            <div class="h-24 bg-gray-100 rounded-xl"></div>
                            <div class="h-24 bg-gray-100 rounded-xl"></div>
                            <div class="h-24 bg-gray-100 rounded-xl"></div>
                            <div class="h-24 bg-gray-100 rounded-xl"></div>
                        </div>
                    </div>
                    <!-- 浮动：开始自由训练按钮 -->
                    <button class="absolute left-1/2 -translate-x-1/2 bottom-8 z-10 bg-blue-600 text-white text-lg font-bold px-6 py-3 rounded-full shadow-lg" onclick="openFreeSelectOverlay()">开始自由训练</button>
                </div>
                </div>

                <!-- 忘记密码（简化） -->
                <div id="page-forgot" class="page flex-col p-8 h-full bg-white">
                    <svg onclick="showPage('page-login')" class="w-6 h-6 text-gray-500 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    <h1 class="text-3xl font-bold text-gray-900 mt-4">重置密码</h1>
                    <div class="space-y-4 max-w-xl mt-6">
                        <input type="email" placeholder="邮箱/手机号" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="password" placeholder="设置新密码" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="password" placeholder="确认新密码" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button onclick="resetPassword()" class="w-full max-w-xl bg-blue-600 text-white font-bold py-3 rounded-lg shadow mt-8 hover:bg-blue-700">提交</button>
                </div>

            </div>

        </div>

        <!-- 控制中心（从顶部下拉） -->
        <div id="controlCenter" class="control-center transition-fast">
            <div class="h-full bg-white rounded-b-2xl shadow-2xl border-b border-gray-100 flex flex-col">
                <!-- 顶部标题（保持简洁） -->
                <div class="px-6 pt-4 pb-3 text-sm text-gray-500">控制中心</div>
                <!-- 内容：每行一个控制项，更宽更易点按 -->
                <div class="px-6 pb-4 flex-1 overflow-y-auto space-y-4">
                    <!-- 亮度 -->
                    <div class="p-4 rounded-xl border bg-white">
                        <div class="flex items-center justify-between">
                            <div class="font-semibold">屏幕亮度</div>
                            <div id="brightnessVal" class="text-xs text-gray-500">100%</div>
                        </div>
                        <input id="brightness" type="range" min="1" max="100" value="100" class="w-full mt-3 accent-blue-600" />
                    </div>
                    <!-- 音量 -->
                    <div class="p-4 rounded-xl border bg-white">
                        <div class="flex items-center justify-between">
                            <div class="font-semibold">系统音量</div>
                            <div id="volumeVal" class="text-xs text-gray-500">50%</div>
                        </div>
                        <input id="volume" type="range" min="0" max="100" value="50" class="w-full mt-3 accent-blue-600" />
                        <div class="text-xs text-gray-400 mt-2">提示：仅示意，不改变系统音量</div>
                    </div>
                    <!-- Wi‑Fi -->
                    <div class="p-4 rounded-xl border bg-white">
                        <div class="flex items-center justify-between">
                            <div class="font-semibold">Wi‑Fi</div>
                            <button id="wifiToggleBtn" class="px-3 py-1 text-sm rounded border bg-gray-50 text-gray-700">开启</button>
                        </div>
                        <div id="wifiStatus" class="text-xs text-gray-500 mt-2">未连接</div>
                        <div id="wifiList" class="mt-3 hidden space-y-1"></div>
                    </div>
                    <!-- 蓝牙 -->
                    <div class="p-4 rounded-xl border bg-white">
                        <div class="flex items-center justify-between">
                            <div class="font-semibold">蓝牙</div>
                            <button id="btToggleBtn" class="px-3 py-1 text-sm rounded border bg-gray-50 text-gray-700">开启</button>
                        </div>
                        <div id="btStatus" class="text-xs text-gray-500 mt-2">未开启</div>
                        <div id="btList" class="mt-3 hidden space-y-1"></div>
                    </div>
                </div>
                <!-- 底部固定操作区：收起按钮 -->
                <div class="px-6 pb-5 pt-3 bg-white/95 backdrop-blur border-t">
                    <button id="btnCloseCC" class="w-full px-3 py-3 text-sm border rounded-lg">收起</button>
                </div>
            </div>
        </div>

        <!-- 屏幕亮度遮罩（放在最上层但不遮住控制中心） -->
        <div class="brightness-overlay"></div>

        <!-- Toast -->
        <div id="app-toast" class="hidden absolute left-1/2 -translate-x-1/2 bottom-10 bg-black text-white text-sm px-3 py-2 rounded-lg shadow z-50">提示</div>
        <div id="custom-plan-loading" class="hidden absolute inset-0 z-40 flex items-center justify-center bg-black/30 backdrop-blur-sm">
            <div class="bg-white rounded-3xl px-8 py-6 shadow-2xl text-center space-y-4 max-w-xs">
                <div class="mx-auto w-14 h-14 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center">
                    <svg class="w-7 h-7 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                        <circle cx="12" cy="12" r="9" stroke-opacity="0.2"></circle>
                        <path d="M21 12a9 9 0 00-9-9" stroke-linecap="round"></path>
                    </svg>
                </div>
                <div class="space-y-1">
                    <div class="text-base font-semibold text-gray-900">正在匹配专属计划</div>
                    <div class="text-sm text-gray-500 leading-relaxed">依据训练目标、频次与关注部位分析动作组合，请稍候...</div>
                </div>
            </div>
        </div>
        <!-- 激活成功提示（居中大样式） -->
        <div id="activation-toast" class="hidden absolute inset-0 z-50 flex items-center justify-center">
            <div class="bg-black/80 text-white rounded-2xl px-8 py-6 flex items-center gap-4">
                <svg class="w-10 h-10 text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 13l4 4L19 7"/></svg>
                <div>
                    <div class="text-2xl font-bold">激活成功</div>
                    <div id="activation-toast-timer" class="text-sm text-white/70 mt-2">将在 5 秒后关闭</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 'page-welcome';
        let currentLoginTab = 'phone';
        let currentRegisterTab = 'phone';
        // 激活流程状态
        let firstTimeActivation = true; // 演示为 true
        let activationRegion = null; // 'CN' | 'US' | ...
        let activationFlow = false;
        let activationWifiConnected = false;

        const myStats = {
            totalDays: 128,
            last7Sessions: 5,
            last7Duration: '6小时20分',
            last7Calories: '3150 kcal',
            last7Volume: '12.6 吨'
        };

        let qrModalOverlay = null;

        const profileSelections = {
            level: '进阶',
            goals: new Set(['增肌塑形', '普拉提']),
            focus: new Set(['肩背', '腰腹']),
            injury: '无'
        };

        const scheduleState = {
            currentMonth: new Date(new Date().getFullYear(), new Date().getMonth(), 1),
            selectedDate: new Date()
        };

        const scheduleMockData = {
            '2025-11-05': {
                plans: [{ name: '核心力量进阶', note: '第1周 第2天 · 07:30', coach: 'Dora 教练' }],
                courses: [{ name: '普拉提呼吸控制', duration: '30min', tag: '普拉提' }]
            },
            '2025-11-07': {
                plans: [{ name: '力量增肌挑战', note: '第2周 第1天 · 09:00', coach: 'Leo 教练' }],
                courses: [{ name: '硬拉基础强化', duration: '45min', tag: '力量训练' }]
            },
            '2025-11-08': {
                plans: [],
                courses: [{ name: '有氧间歇燃脂', duration: '35min', tag: '有氧混合' }]
            },
            '2025-11-12': {
                plans: [{ name: '柔韧恢复计划', note: '第1周 第3天 · 19:30', coach: 'May 教练' }],
                courses: [{ name: '肩背拉伸释放', duration: '25min', tag: '拉伸恢复' }]
            },
            '2025-11-15': {
                plans: [{ name: '核心稳定巩固', note: '第3周 第1天 · 08:00', coach: 'Dora 教练' }],
                courses: [{ name: '上肢力量循环', duration: '40min', tag: '力量训练' }]
            }
        };

        const defaultAvatar = 'https://i.pravatar.cc/120?img=36';
        let lastLoginProfile = {
            nickname: '李雪',
            account: 'lixue@example.com',
            avatar: defaultAvatar,
            lastLoginAt: new Date('2025-11-01T19:40:00')
        };

        const accessoryOptions = ['健身凳', '折叠凳', '别腿凳', '手柄', '负重带', '杠铃', '核心床板', '双头弹簧', '双头绳', '引体向上杆', '红铃'];

        const settingsState = {
            preference: {
                indicator: '单击',
                release: '手动卸力',
                infinite: '开启',
                oneRM: '左右分别记录1RM'
            },
            standby: '10分钟',
            standbyOptions: ['10分钟', '30分钟', '60分钟', '90分钟', '永不'],
            accessories: new Set(['健身凳', '折叠凳', '手柄', '负重带', '双头绳'])
        };

        const trainingRecords = [
            { id: 't1', date: '2025-09-30', weekday: '周二', time: '07:30', title: '自由训练 · 核心燃脂', duration: '40 min', calories: '128 kcal', volume: '12.4 t', tags: ['自由训练', '核心'], mood: '状态良好' },
            { id: 't2', date: '2025-09-29', weekday: '周一', time: '18:40', title: '力量增肌 · 上肢循环', duration: '1 h 20 min', calories: '400 kcal', volume: '18.7 t', tags: ['力量训练', '上肢'], mood: '完成高质量整组' },
            { id: 't3', date: '2025-09-27', weekday: '周六', time: '10:15', title: '普拉提控感 · 呼吸训练', duration: '35 min', calories: '96 kcal', volume: '—', tags: ['普拉提', '柔韧'], mood: '肩颈释放明显' }
        ];

        const trainingDetailData = {
            t1: {
                title: '自由训练 · 核心燃脂',
                date: '2025-09-30 周二 07:30',
                device: 'Motion Station Pro · 蓝牙助力开启',
                duration: '00:40:00',
                volume: '12,460 kg',
                calories: '128 kcal',
                power: '210 W',
                highlights: ['核心区域发力稳定，ROM 左/右 92% / 95%', '节奏维持在 45 次/分，爆发力较上周提升 8%'],
                segments: [
                    { name: '热身激活', detail: '动态拉伸 + 低阻力划船 10 min' },
                    { name: '主训练', detail: '核心力量循环 4 组，每组 10 次，助力关闭' },
                    { name: '收操放松', detail: '滚轴放松 + 呼吸控制 8 min' }
                ],
                share: {
                    title: '自由训练 · 核心燃脂',
                    subtitle: '2025/09/30 07:30 | Motion Station Pro',
                    duration: '40 min',
                    calories: '128 kcal',
                    volume: '12.4 t',
                    highlight: '爆发力提升 8%，核心稳定性优秀'
                }
            },
            t2: {
                title: '力量增肌 · 上肢循环',
                date: '2025-09-29 周一 18:40',
                device: 'Motion Station Elite · 离心模式',
                duration: '01:20:00',
                volume: '18,720 kg',
                calories: '400 kcal',
                power: '232 W',
                highlights: ['全程维持中高强度，爆发能力稳定', '核心控制优异，ROM 均衡'],
                segments: [
                    { name: '力量循环', detail: '推胸 / 划船 / 推肩 / 下拉 4 轮' },
                    { name: '燃脂冲刺', detail: '高强度间歇 3 轮，间隔 45 秒' }
                ],
                share: {
                    title: '力量增肌 · 上肢循环',
                    subtitle: '2025/09/29 18:40 | Motion Station Elite',
                    duration: '1 h 20 min',
                    calories: '400 kcal',
                    volume: '18.7 t',
                    highlight: '力量与心肺同步提升，完成双倍训练量'
                }
            },
            t3: {
                title: '普拉提控感 · 呼吸训练',
                date: '2025-09-27 周六 10:15',
                device: 'Motion Station Lite · 普拉提模式',
                duration: '00:35:00',
                volume: '—',
                calories: '96 kcal',
                power: '—',
                highlights: ['呼吸节奏稳定，肩颈压迫明显缓解', '左右核心激活度差异 <5%'],
                segments: [
                    { name: '弹簧组合', detail: '黄 + 蓝弹簧，专注控制' },
                    { name: '控制延伸', detail: 'Pilates Roll Up / Mermaid / Saw' }
                ],
                share: {
                    title: '普拉提控感 · 呼吸训练',
                    subtitle: '2025/09/27 10:15 | Motion Station Lite',
                    duration: '35 min',
                    calories: '96 kcal',
                    volume: '轻阻力',
                    highlight: '柔韧提升 12%，肩颈压力显著缓解'
                }
            }
        };

        const planThemes = {
            strength: { hero: 'bg-gradient-to-r from-blue-400 via-indigo-500 to-blue-700', card: 'from-blue-200 to-indigo-300', accent: 'text-blue-600' },
            mobility: { hero: 'bg-gradient-to-r from-emerald-300 via-emerald-500 to-teal-600', card: 'from-emerald-200 to-emerald-300', accent: 'text-emerald-600' },
            power: { hero: 'bg-gradient-to-r from-purple-400 via-indigo-500 to-purple-700', card: 'from-purple-200 to-indigo-300', accent: 'text-purple-600' },
            recovery: { hero: 'bg-gradient-to-r from-amber-300 via-orange-400 to-amber-600', card: 'from-amber-200 to-orange-300', accent: 'text-amber-600' },
            cardio: { hero: 'bg-gradient-to-r from-sky-400 via-blue-500 to-indigo-600', card: 'from-sky-200 to-blue-300', accent: 'text-sky-600' },
            custom: { hero: 'bg-gradient-to-r from-sky-500 via-blue-600 to-indigo-700', card: 'from-sky-200 to-blue-400', accent: 'text-sky-600' }
        };

        const planLibraryData = {
            regular: [
                {
                    id: 'p1',
                    name: '三周核心进阶',
                    category: '核心进阶',
                    type: '力量训练',
                    theme: 'strength',
                    level: '中级',
                    weeks: 3,
                    frequency: 3,
                    focus: ['核心', '下肢'],
                    summary: '围绕核心稳定与下肢力量展开，循序渐进提升支撑能力与对称爆发力，周末安排主动恢复避免疲劳积累。',
                    highlights: ['核心稳定器激活', '动作节奏提示', '周末动态恢复'],
                    durationTip: '建议每次 45~55 分钟',
                    schedule: [
                        { day: '周一', status: '训练', items: [
                            { name: '热身 · 动态拉伸', tag: '热身', duration: '8 min', focus: '肩髋关节' },
                            { name: '力量循环 · 平板支撑 + 反向卷腹', tag: '主训练', duration: '28 min', focus: '核心/下肢' },
                            { name: '辅助 · 单腿臀推', tag: '辅助', duration: '10 min', focus: '臀腿' },
                            { name: '拉伸 · 髂腰肌', tag: '恢复', duration: '6 min' }
                        ]},
                        { day: '周二', status: '恢复', items: [
                            { name: '主动恢复 · 瑜伽呼吸', tag: '恢复', duration: '15 min', focus: '呼吸控制' },
                            { name: '筋膜放松 · 泡沫轴', tag: '恢复', duration: '10 min', focus: '背部/臀腿' }
                        ]},
                        { day: '周三', status: '训练', items: [
                            { name: '热身 · 核心激活', tag: '热身', duration: '6 min', focus: '腹横肌' },
                            { name: '主训练 · 负重深蹲 + 硬拉组合', tag: '主训练', duration: '32 min', focus: '下肢力量' },
                            { name: '辅助 · 侧支撑交替', tag: '辅助', duration: '8 min', focus: '侧核心' }
                        ]},
                        { day: '周四', status: '体能', items: [
                            { name: '低冲击有氧 · 椭圆机', tag: '体能', duration: '25 min', focus: '心肺' },
                            { name: '拉伸 · 胸椎旋转', tag: '恢复', duration: '8 min', focus: '脊柱' }
                        ]},
                        { day: '周五', status: '训练', items: [
                            { name: '热身 · 踝膝稳定', tag: '热身', duration: '7 min', focus: '下肢' },
                            { name: '主训练 · 壶铃摆动 + 弓步推举', tag: '主训练', duration: '30 min', focus: '爆发力' },
                            { name: '辅助 · 核心呼吸训练', tag: '辅助', duration: '6 min', focus: '横膈膜' },
                            { name: '拉伸 · 鸽子式', tag: '恢复', duration: '6 min', focus: '髋部' }
                        ]},
                        { day: '周六', status: '休息', items: [
                            { name: '休息 · 充足睡眠与营养补给', tag: '休息', tip: '建议进行 15 分钟轻松散步' }
                        ]},
                        { day: '周日', status: '恢复', items: [
                            { name: '恢复拉伸 · 全身放松', tag: '恢复', duration: '20 min', focus: '柔韧' }
                        ]}
                    ],
                    notes: ['双侧负重请保持重量差异 <5%。', '若核心疲劳，可将周五壶铃摆动替换为垫上普拉提动作。']
                },
                {
                    id: 'p2',
                    name: '五周拉伸恢复',
                    category: '柔韧恢复',
                    type: '拉伸',
                    theme: 'mobility',
                    level: '初级',
                    weeks: 5,
                    frequency: 2,
                    focus: ['柔韧', '肩颈'],
                    summary: '适合久坐人群的分阶段拉伸恢复计划，以低强度训练改善肩颈与髋部紧张，搭配居家可执行动作。',
                    highlights: ['低冲击', '筋膜放松', '动作提示卡'],
                    durationTip: '每次 30~40 分钟',
                    schedule: [
                        { day: '周一', status: '恢复', items: [
                            { name: '肩颈舒缓拉伸', tag: '恢复', duration: '18 min', focus: '肩颈' },
                            { name: '呼吸放松', tag: '恢复', duration: '8 min', focus: '呼吸节奏' }
                        ]},
                        { day: '周二', status: '休息', items: [
                            { name: '休息 · 轻松步行', tag: '休息', tip: '建议保持 5000 步以上' }
                        ]},
                        { day: '周三', status: '训练', items: [
                            { name: '热身 · 关节唤醒', tag: '热身', duration: '6 min', focus: '肩髋关节' },
                            { name: '普拉提拉伸序列', tag: '主训练', duration: '26 min', focus: '脊柱/髋部' },
                            { name: '筋膜滚轴放松', tag: '恢复', duration: '8 min', focus: '背部/大腿' }
                        ]},
                        { day: '周四', status: '休息', items: [
                            { name: '补水与睡眠管理', tag: '休息', tip: '记录睡眠时长 ≥7 小时' }
                        ]},
                        { day: '周五', status: '训练', items: [
                            { name: '热身 · 手臂环绕', tag: '热身', duration: '5 min', focus: '肩部' },
                            { name: '弹力带肩背牵拉', tag: '辅助', duration: '12 min', focus: '上背' },
                            { name: '瑜伽猫牛式', tag: '恢复', duration: '6 min', focus: '脊柱' }
                        ]},
                        { day: '周六', status: '体能', items: [
                            { name: '低强度快走', tag: '体能', duration: '25 min', focus: '心肺' }
                        ]},
                        { day: '周日', status: '恢复', items: [
                            { name: '全身舒展 · 体态调整', tag: '恢复', duration: '20 min', focus: '体态' }
                        ]}
                    ],
                    notes: ['如遇肩颈不适，可将普拉提序列替换为静态拉伸。']
                },
                {
                    id: 'p3',
                    name: '力量增肌挑战',
                    category: '力量提升',
                    type: '力量训练',
                    theme: 'power',
                    level: '高级',
                    weeks: 4,
                    frequency: 4,
                    focus: ['上肢', '核心'],
                    summary: '面向进阶训练者的力量增肌计划，以大重量复合动作为核心，辅以体能冲刺与恢复拉伸，强化爆发力与肌肉量。',
                    highlights: ['线性加重建议', '爆发力冲刺', '每周检测'],
                    durationTip: '每次 55~70 分钟',
                    schedule: [
                        { day: '周一', status: '训练', items: [
                            { name: '热身 · 神经激活', tag: '热身', duration: '8 min', focus: '上肢' },
                            { name: '主训练 · 杠铃卧推 + 杠铃划船', tag: '主训练', duration: '36 min', focus: '胸背' },
                            { name: '辅助 · 哑铃飞鸟', tag: '辅助', duration: '10 min', focus: '胸' }
                        ]},
                        { day: '周二', status: '训练', items: [
                            { name: '热身 · 动态臀桥', tag: '热身', duration: '7 min', focus: '下肢' },
                            { name: '主训练 · 深蹲 + 罗马尼亚硬拉', tag: '主训练', duration: '34 min', focus: '下肢' },
                            { name: '冲刺 · 战绳 Tabata', tag: '体能', duration: '6 min', focus: '爆发力' }
                        ]},
                        { day: '周三', status: '恢复', items: [
                            { name: '呼吸练习', tag: '恢复', duration: '10 min', focus: '神经系统' },
                            { name: '泡沫轴放松', tag: '恢复', duration: '12 min', focus: '全身' }
                        ]},
                        { day: '周四', status: '训练', items: [
                            { name: '热身 · 肩袖稳定', tag: '热身', duration: '6 min', focus: '肩部' },
                            { name: '主训练 · 推举 + 引体向上', tag: '主训练', duration: '32 min', focus: '肩背' },
                            { name: '辅助 · 侧平举巨型组', tag: '辅助', duration: '8 min', focus: '肩部' }
                        ]},
                        { day: '周五', status: '训练', items: [
                            { name: '热身 · 核心激活', tag: '热身', duration: '6 min', focus: '核心' },
                            { name: '主训练 · 壶铃复合动作', tag: '主训练', duration: '30 min', focus: '全身力量' },
                            { name: '体能 · 风阻车冲刺', tag: '体能', duration: '8 min', focus: '心肺' }
                        ]},
                        { day: '周六', status: '恢复', items: [
                            { name: '深度拉伸', tag: '恢复', duration: '20 min', focus: '柔韧' }
                        ]},
                        { day: '周日', status: '休息', items: [
                            { name: '休息 · 完整恢复', tag: '休息', tip: '建议记录肌肉酸痛度，准备下周加重' }
                        ]}
                    ],
                    notes: ['保持蛋白摄入 1.6g/kg 以上。', '周五冲刺若心率超 90%HRmax，请降低阻力。']
                },
                {
                    id: 'p4',
                    name: '四周有氧燃脂',
                    category: '燃脂塑形',
                    type: '有氧混合',
                    theme: 'cardio',
                    level: '中级',
                    weeks: 4,
                    frequency: 4,
                    focus: ['心肺', '下肢'],
                    summary: '结合间歇有氧与力量耐力训练，帮助在 4 周内提升心肺耐力并降低体脂，适合希望塑形的训练者。',
                    highlights: ['心率区间提示', '间歇跑模板', '力量耐力循环'],
                    durationTip: '每次 40~60 分钟',
                    schedule: [
                        { day: '周一', status: '训练', items: [
                            { name: '有氧间歇 · 跑步机 30/30', tag: '体能', duration: '24 min', focus: '心肺' },
                            { name: '辅助 · 弓步走', tag: '辅助', duration: '10 min', focus: '下肢耐力' }
                        ]},
                        { day: '周二', status: '训练', items: [
                            { name: '力量循环 · 自重 + 壶铃', tag: '主训练', duration: '28 min', focus: '全身' },
                            { name: '恢复 · 拉伸', tag: '恢复', duration: '8 min', focus: '下肢' }
                        ]},
                        { day: '周三', status: '休息', items: [
                            { name: '休息 · 低强度活动', tag: '休息', tip: '建议快走或骑行 20 分钟' }
                        ]},
                        { day: '周四', status: '训练', items: [
                            { name: '高强度间歇 · 划船器', tag: '体能', duration: '22 min', focus: '爆发心肺' },
                            { name: '核心强化', tag: '辅助', duration: '10 min', focus: '核心' }
                        ]},
                        { day: '周五', status: '恢复', items: [
                            { name: '瑜伽基础流', tag: '恢复', duration: '25 min', focus: '柔韧' }
                        ]},
                        { day: '周六', status: '训练', items: [
                            { name: '长距离慢跑', tag: '体能', duration: '35 min', focus: '耐力' }
                        ]},
                        { day: '周日', status: '恢复', items: [
                            { name: '呼吸冥想', tag: '恢复', duration: '12 min', focus: '放松' }
                        ]}
                    ],
                    notes: ['心率请控制在 65%~85% HRmax 之间。']
                }
            ]
        };

        let customPlanProfile = {
            name: 'AA',
            gender: '女',
            height: 165,
            weight: 50,
            level: '进阶',
            goal: '增肌塑形',
            frequency: 3,
            timeSlot: '工作日晚间',
            focus: ['腰腹', '臀腿'],
            injury: '无',
            note: ''
        };

        let customFocusSelection = new Set(customPlanProfile.focus);
        let customPlans = [];
        let currentPlanDetail = null;

        const favoritesData = {
            course: [
                { title: '燃脂普拉提', level: '中级', meta: '33 min · 217 kcal', tags: ['普拉提', '控制'], note: '适合晨间唤醒' },
                { title: '力量训练 · 核心', level: '高级', meta: '45 min · 320 kcal', tags: ['力量', '核心'], note: '计划推荐 · 第 2 周' }
            ],
            action: [
                { title: '俯身划船', level: '初级', meta: '器械：手柄', tags: ['背部', '力量'], note: '动作控制稳定' },
                { title: '推肩', level: '中级', meta: '器械：红铃', tags: ['肩部', '增肌'], note: '建议重量：8.5kg' }
            ],
            plan: [
                { title: '三周核心进阶', level: '中级', meta: '每周 3 次 · 3 周', tags: ['核心', '力量'], note: '正在执行' },
                { title: '五周拉伸恢复', level: '初级', meta: '每周 2 次 · 5 周', tags: ['拉伸', '恢复'], note: '收藏 · 待开启' }
            ]
        };

        const planData = {
            active: [
                { title: '核心力量进阶', schedule: '2025-09-30 开始 · 每周 3 次', progress: '已完成 4/9 次', next: '下一次训练：10/02 07:30', tag: '第 1 周 第 2 天' },
                { title: '力量增肌挑战', schedule: '2025-09-25 开始 · 每周 4 次', progress: '已完成 6/12 次', next: '下一次训练：10/01 18:30', tag: '肩背日' }
            ],
            finished: [
                { title: '柔韧恢复 21 天', schedule: '2025-08-01 - 2025-08-21', progress: '已完成', next: '复盘建议：每周维持 2 次', tag: '完成率 100%' }
            ]
        };

        const overviewMock = {
            trend: [60, 72, 55, 90, 86, 78, 95]
        };

        let currentFavoriteTab = 'course';
        let currentPlanTab = 'active';
        let currentTrainingDetailId = null;

        let cacheUsageMB = 512;
        let activationCountdownTimer = null;


        function formatLastLoginLabel(date){
            if (!date) return '上次登录：--';
            const d = new Date(date);
            if (Number.isNaN(d.getTime())) return '上次登录：--';
            const now = new Date();
            const options = { hour: '2-digit', minute: '2-digit', hour12: false };
            const time = d.toLocaleTimeString('zh-CN', options);
            const sameDay = d.toDateString() === now.toDateString();
            if (sameDay) return `上次登录：今日 ${time}`;
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `上次登录：${month}月${day}日 ${time}`;
        }

        function renderLastLoginCard(){
            const card = document.getElementById('auth-last-login');
            const empty = document.getElementById('auth-last-login-empty');
            if (!card || !empty) return;
            if (!lastLoginProfile){
                card.classList.add('hidden');
                card.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }
            const avatar = lastLoginProfile.avatar || defaultAvatar;
            const nickname = lastLoginProfile.nickname || 'Motion 用户';
            const account = lastLoginProfile.account || 'motion@example.com';
            card.classList.remove('hidden');
            card.innerHTML = `
                <div class="flex items-center gap-4">
                    <img src="${avatar}" alt="用户头像" class="w-16 h-16 rounded-full object-cover shadow">
                    <div class="flex-1 min-w-0">
                        <div class="text-base font-semibold text-gray-900 truncate">${nickname}</div>
                        <div class="text-xs text-gray-500 truncate">${account}</div>
                        <div class="text-xs text-blue-500 mt-1">${formatLastLoginLabel(lastLoginProfile.lastLoginAt)}</div>
                    </div>
                    <svg class="w-5 h-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path d="M7.293 4.293a1 1 0 011.414 0L13 8.586a1 1 0 010 1.414l-4.293 4.293a1 1 0 01-1.414-1.414L10.586 10 7.293 6.707a1 1 0 010-1.414z"/></svg>
                </div>`;
            empty.classList.add('hidden');
            card.onclick = loginWithLastProfile;
        }

        function showAuthLanding(){
            showPage('page-auth-landing');
        }

        function openReturningLogin(){
            renderLastLoginCard();
            showPage('page-auth-returning');
        }

        function loginWithLastProfile(){
            if (!lastLoginProfile){
                startEmailLogin();
                return;
            }
            lastLoginProfile.lastLoginAt = new Date();
            renderLastLoginCard();
            showToast(`欢迎回来，${lastLoginProfile.nickname || 'Motion 用户'}`);
            showPage('page-home');
            renderWeeklyCheckins('weekly-checkins-home');
        }

        function updateLastLoginProfileFromInputs(){
            const emailInput = document.getElementById('login-email');
            const phoneInput = document.getElementById('login-phone');
            const email = emailInput?.value?.trim();
            const phone = phoneInput?.value?.trim();
            let nickname = '';
            if (email) {
                nickname = email.split('@')[0];
            } else if (phone) {
                nickname = `用户${phone.slice(-4)}`;
            }
            if (!nickname) nickname = 'Motion 用户';
            const account = email || phone || (lastLoginProfile?.account) || 'motion@example.com';
            lastLoginProfile = {
                nickname,
                account,
                avatar: lastLoginProfile?.avatar || defaultAvatar,
                lastLoginAt: new Date()
            };
            renderLastLoginCard();
        }

        function startEmailLogin(){
            toggleLoginMode('email');
            showPage('page-login');
        }

        function startQrLogin(){
            openQrModal('login');
        }

        function showPage(id) {
            if (currentPage) {
                const oldPage = document.getElementById(currentPage);
                if (oldPage) oldPage.classList.remove('active');
            }
            const next = document.getElementById(id);
            if (next) {
                next.classList.add('active');
                currentPage = id;
                if (id === 'page-register-success') {
                    setTimeout(() => { showPage('page-home'); if (activationFlow) { showActivationSuccess(); activationFlow=false; } }, 1500);
                }
                if (id === 'page-my') {
                    populateMyPage();
                }
                if (id === 'page-user-profile') {
                    highlightAllProfileOptions();
                }
                if (id === 'page-schedule') {
                    renderScheduleView();
                }
                if (id === 'page-settings-preference') {
                    renderPreferenceUI();
                }
                if (id === 'page-settings-standby') {
                    renderStandbyUI();
                }
                if (id === 'page-settings-accessory') {
                    renderAccessoryUI();
                }
                if (id === 'page-my-training') {
                    renderMyTrainingList();
                }
                if (id === 'page-my-favorites') {
                    switchFavoriteTab(currentFavoriteTab);
                }
                if (id === 'page-my-plan') {
                    switchPlanTab(currentPlanTab);
                }
                if (id === 'page-training-data') {
                    renderTrainingDataOverview();
                }
                if (id === 'page-training-share') {
                    populateTrainingShare();
                }
                if (id === 'page-auth-returning') {
                    renderLastLoginCard();
                }
            }
        }

        function startCountdown(button) {
            let s = 60; button.disabled = true; button.textContent = '60s 后重试';
            const t = setInterval(() => { s--; if (s>0) { button.textContent = s+'s 后重试'; } else { clearInterval(t); button.disabled=false; button.textContent='获取验证码'; } }, 1000);
        }

        function toggleLoginMode(mode) {
            if (currentLoginTab === mode) return;
            const on = (id, active) => {
                const el = document.getElementById(id);
                el.classList.toggle('bg-blue-600', active);
                el.classList.toggle('text-white', active);
                el.classList.toggle('bg-gray-50', !active);
                el.classList.toggle('text-gray-600', !active);
            };
            on('tab-btn-phone', mode==='phone');
            on('tab-btn-password', mode==='password');
            on('tab-btn-email', mode==='email');
            document.getElementById('mode-phone').classList.toggle('hidden', mode!=='phone');
            document.getElementById('mode-password').classList.toggle('hidden', mode!=='password');
            document.getElementById('mode-email').classList.toggle('hidden', mode!=='email');
            currentLoginTab = mode;
        }

        function login() {
            updateLastLoginProfileFromInputs();
            lastLoginProfile.lastLoginAt = new Date();
            renderLastLoginCard();
            showToast(`欢迎回来，${lastLoginProfile.nickname || 'Motion 用户'}`);
            showPage('page-home');
            renderWeeklyCheckins('weekly-checkins-home');
            if (activationFlow) { showActivationSuccess(); activationFlow = false; }
        }
        function registerStep1() {
            const agreed = document.getElementById('agree-register').checked;
            if (!agreed) { alert('请先阅读并同意用户协议和隐私政策'); return; }
            showPage('page-register-step2');
        }
        function registerStep2() { showPage('page-register-success'); }
        function resetPassword() { alert('密码重置成功！（演示）'); showPage('page-login'); }

        // 注册页：切换注册模式 (手机/邮箱)
        function toggleRegisterMode(mode) {
            if (currentRegisterTab === mode) return;
            const on = (id, active) => {
                const el = document.getElementById(id);
                el.classList.toggle('bg-blue-600', active);
                el.classList.toggle('text-white', active);
                el.classList.toggle('bg-gray-50', !active);
                el.classList.toggle('text-gray-600', !active);
            };
            on('tab-btn-reg-phone', mode==='phone');
            on('tab-btn-reg-email', mode==='email');
            document.getElementById('reg-mode-phone').classList.toggle('hidden', mode!=='phone');
            document.getElementById('reg-mode-email').classList.toggle('hidden', mode!=='email');
            currentRegisterTab = mode;
        }

        // 本周打卡（示意：今天/过去/未来）
        function renderWeeklyCheckins(targetId) {
            const container = document.getElementById(targetId); if (!container) return; container.innerHTML = '';
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const weekday = (now.getDay() + 6) % 7;
            const monday = new Date(today); monday.setDate(today.getDate() - weekday);
            const dayLabels = ['周一','周二','周三','周四','周五','周六','周日'];
            for (let i=0; i<7; i++) {
                const d = new Date(monday); d.setDate(monday.getDate()+i);
                const wrapper = document.createElement('div');
                wrapper.className = 'flex flex-col items-center gap-2 text-xs text-gray-500';

                const circle = document.createElement('div');
                circle.className = 'w-10 h-10 flex items-center justify-center rounded-full border font-semibold transition';

                const status = document.createElement('span');
                status.className = 'px-2 py-0.5 rounded-full text-[10px] whitespace-nowrap';

                const isToday = d.getTime() === today.getTime();
                const isPast = d.getTime() < today.getTime();

                if (isToday) {
                    circle.classList.add('border-blue-500','bg-blue-50','text-blue-600','shadow');
                    status.classList.add('bg-blue-100','text-blue-700');
                    status.textContent = '今日';
                } else if (isPast) {
                    circle.classList.add('bg-blue-600','border-blue-600','text-white','shadow');
                    status.classList.add('bg-blue-600/10','text-blue-700');
                    status.textContent = '已打卡';
                    circle.innerHTML = '<svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l6.293-6.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>';
                } else {
                    circle.classList.add('border-dashed','border-blue-200','text-blue-300');
                    status.classList.add('bg-gray-100','text-gray-500');
                    status.textContent = '待打卡';
                }

                if (!circle.innerHTML) circle.textContent = d.getDate();
                const label = document.createElement('span');
                label.className = 'text-[11px] text-gray-500';
                label.textContent = dayLabels[i];

                wrapper.appendChild(label);
                wrapper.appendChild(circle);
                wrapper.appendChild(status);
                container.appendChild(wrapper);
            }
        }

        // 日期文本
        function setToday() { const el = document.getElementById('home-date'); if (!el) return; const n=new Date(); el.textContent = `${n.getFullYear()}年${n.getMonth()+1}月${n.getDate()}日`; }

        // 控制中心逻辑
        const cc = document.getElementById('controlCenter');
        const btnOpen = document.getElementById('btnOpenCC');
        const btnClose = document.getElementById('btnCloseCC');
        const gestureArea = document.getElementById('gestureArea');
        let dragging = false; let startY = 0; let startTop = 0;

        const openCC = () => { cc.classList.add('open'); cc.style.top = '0px'; };
        const closeCC = () => { cc.classList.remove('open'); cc.style.top = '-70%'; };
        btnOpen.addEventListener('click', openCC);
        btnClose.addEventListener('click', closeCC);

        // 手势：顶部下拉/上推
        const onStart = (y) => { dragging = true; startY = y; startTop = cc.getBoundingClientRect().top; cc.style.transition = 'none'; };
        const onMove = (y) => {
            if (!dragging) return;
            const delta = y - startY; // 向下正
            let top = Math.min(0, startTop + delta);
            cc.style.top = top + 'px';
        };
        const onEnd = () => {
            if (!dragging) return; dragging = false; cc.style.transition = '';
            // 根据位置决定展开或收起
            const rect = cc.getBoundingClientRect();
            if (rect.top > -rect.height * 0.5) openCC(); else closeCC();
        };
        // 触摸
        gestureArea.addEventListener('touchstart', e => onStart(e.touches[0].clientY), {passive:true});
        gestureArea.addEventListener('touchmove', e => onMove(e.touches[0].clientY), {passive:true});
        gestureArea.addEventListener('touchend', onEnd);
        // 鼠标（方便在电脑上演示）
        gestureArea.addEventListener('mousedown', e => onStart(e.clientY));
        window.addEventListener('mousemove', e => onMove(e.clientY));
        window.addEventListener('mouseup', onEnd);

        // Wi‑Fi/蓝牙/亮度/音量交互
        const wifiToggleBtn = document.getElementById('wifiToggleBtn');
        const wifiStatus = document.getElementById('wifiStatus');
        const wifiList = document.getElementById('wifiList');
        let wifiOn = false; let wifiConnecting = null; let wifiConnected = null;
        const wifiNetworks = [
            { ssid: 'Ebl-Guest', rssi: -40 },
            { ssid: 'Studio-AP', rssi: -55 },
            { ssid: 'Home-2G', rssi: -68 },
            { ssid: 'Cafe-5G', rssi: -72 }
        ];
        function signalBars(rssi){ if (rssi>-50) return '▮▮▮▮'; if (rssi>-60) return '▮▮▮▯'; if (rssi>-70) return '▮▮▯▯'; return '▮▯▯▯'; }
        function renderWifiList(){
            wifiList.innerHTML = '';
            wifiNetworks.forEach(n => {
                const isConn = wifiConnected === n.ssid;
                const isConnecting = wifiConnecting === n.ssid;
                const btn = document.createElement('button');
                btn.className = 'w-full flex items-center justify-between px-3 py-2 rounded hover:bg-gray-50';
                btn.onclick = () => connectWifi(n.ssid);
                btn.innerHTML = `<div class="flex items-center gap-2"><span class="text-gray-800">${n.ssid}</span>${isConn?'<span class=\"text-xs text-green-600\">已连接</span>': isConnecting? '<span class=\"text-xs text-gray-500\">连接中…</span>':''}</div><div class="text-gray-400 text-sm">${signalBars(n.rssi)}</div>`;
                wifiList.appendChild(btn);
            });
        }
        function connectWifi(ssid){ if (!wifiOn) return; wifiConnecting = ssid; wifiStatus.textContent = `正在连接 ${ssid}…`; renderWifiList(); setTimeout(()=>{ wifiConnecting=null; wifiConnected=ssid; wifiStatus.textContent = `已连接：${ssid}`; renderWifiList(); showToast('Wi‑Fi 已连接'); }, 1000); }
        wifiToggleBtn.addEventListener('click', () => {
            wifiOn = !wifiOn;
            wifiToggleBtn.textContent = wifiOn ? '关闭' : '开启';
            if (wifiOn) { wifiStatus.textContent = '扫描可用网络…'; wifiList.classList.remove('hidden'); renderWifiList(); }
            else { wifiConnected=null; wifiConnecting=null; wifiStatus.textContent='未连接'; wifiList.classList.add('hidden'); }
        });

        const btToggleBtn = document.getElementById('btToggleBtn');
        const btStatus = document.getElementById('btStatus');
        const btList = document.getElementById('btList');
        let btOn = false;
        function renderBTList(){
            btList.innerHTML = '';
            ['HR-Strap-001', 'Row-Handle-12'].forEach(name => {
                const b = document.createElement('button');
                b.className='w-full text-left px-3 py-2 rounded hover:bg-gray-50';
                b.textContent = name;
                b.onclick = () => connectBT(name);
                btList.appendChild(b);
            });
        }
        function connectBT(name){ btStatus.textContent = `正在连接 ${name}…`; setTimeout(()=>{ btStatus.textContent = `已连接：${name}`; showToast('蓝牙设备已连接'); }, 800); }
        btToggleBtn.addEventListener('click', ()=>{ btOn=!btOn; btToggleBtn.textContent = btOn ? '关闭' : '开启'; if (btOn){ btStatus.textContent='可被发现，正在搜索设备…'; btList.classList.remove('hidden'); renderBTList(); } else { btStatus.textContent='未开启'; btList.classList.add('hidden'); } });

        // 亮度/音量
        const brightness = document.getElementById('brightness');
        const brightnessVal = document.getElementById('brightnessVal');
        const volume = document.getElementById('volume');
        const volumeVal = document.getElementById('volumeVal');
        const deviceEl = document.getElementById('device');
        const setBrightness = (v) => { const f = Math.max(0.1, v/100); deviceEl.style.setProperty('--device-brightness', String(f)); brightnessVal.textContent = Math.round(v)+'%'; };
        brightness.addEventListener('input', e => setBrightness(e.target.value));
        volume.addEventListener('input', e => volumeVal.textContent = Math.round(e.target.value)+'%');

        // Toast
        function showToast(text){ const el = document.getElementById('app-toast'); el.textContent=text; el.classList.remove('hidden'); el.style.opacity='1'; setTimeout(()=>{ el.style.opacity='0'; setTimeout(()=>el.classList.add('hidden'), 200); }, 1200); }

        // 首页入口：课程库
        function goToCourses(){ showPage('page-course'); }

        function planThemeOf(plan){
            if (!plan) return planThemes.strength;
            return planThemes[plan.theme] || planThemes.strength;
        }

        function planBadgeList(plan){
            const badges = [];
            if (plan.weeks) badges.push(`${plan.weeks}周`);
            if (plan.frequency) badges.push(`每周${plan.frequency}次`);
            if (plan.level) badges.push(plan.level);
            if (plan.type) badges.push(plan.type);
            return badges;
        }

        function planTagClass(tag){
            const map = {
                '热身': 'bg-amber-100 text-amber-700',
                '主训练': 'bg-blue-100 text-blue-700',
                '辅助': 'bg-purple-100 text-purple-700',
                '恢复': 'bg-emerald-100 text-emerald-700',
                '体能': 'bg-sky-100 text-sky-700',
                '休息': 'bg-gray-100 text-gray-600'
            };
            return map[tag] || 'bg-gray-100 text-gray-600';
        }

        function formatDateLabel(date){
            if (!date) return '';
            const d = new Date(date);
            if (Number.isNaN(d.getTime())) return '';
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            const hour = String(d.getHours()).padStart(2, '0');
            const minute = String(d.getMinutes()).padStart(2, '0');
            return `生成于 ${month}月${day}日 ${hour}:${minute}`;
        }

        function planCardTemplate(plan, isCustom){
            const theme = planThemeOf(plan);
            const badges = planBadgeList(plan);
            const statusClass = isCustom ? 'bg-emerald-100 text-emerald-700' : 'bg-blue-100 text-blue-700';
            const footer = isCustom ? '<span class="text-emerald-600">查看专属安排 ›</span>' : '<span class="text-blue-600">查看安排 ›</span>';
            const subline = isCustom ? (plan.progressLabel || plan.durationTip || '') : (plan.durationTip || '');
            const generated = isCustom ? (plan.generatedLabel || formatDateLabel(plan.generatedAt)) : '';
            return `
                <button class="w-full text-left bg-white rounded-2xl border border-gray-100 shadow-sm hover:border-blue-400 transition overflow-hidden" onclick="openPlanDetail('${plan.id}')">
                    <div class="flex gap-4 p-4 md:p-5">
                        <div class="w-24 h-24 md:w-28 md:h-24 rounded-2xl bg-gradient-to-br ${theme.card} flex items-center justify-center text-white text-sm font-semibold">${plan.type || '训练'}</div>
                        <div class="flex-1 flex flex-col gap-2 min-w-0">
                            <div class="flex items-start justify-between gap-3">
                                <div class="min-w-0">
                                    <div class="text-xs font-semibold ${theme.accent} uppercase tracking-wide">${plan.category || (isCustom ? '定制计划' : '精选计划')}</div>
                                    <div class="mt-1 text-base md:text-lg font-bold text-gray-900 truncate">${plan.name}</div>
                                </div>
                                <span class="px-2 py-0.5 rounded-full text-xs ${statusClass}">${isCustom ? '定制' : '推荐'}</span>
                            </div>
                            <div class="flex flex-wrap gap-2 text-[12px] text-gray-500">
                                ${badges.map(b => `<span class="px-2 py-0.5 rounded-full bg-gray-100">${b}</span>`).join('')}
                            </div>
                            <p class="text-xs md:text-sm text-gray-500 leading-relaxed">${plan.summary || ''}</p>
                            <div class="flex items-center justify-between text-[12px] text-gray-400">
                                <span>${generated || subline}</span>
                                ${footer}
                            </div>
                        </div>
                    </div>
                </button>`;
        }

        function renderPlanLibrary(){
            const container = document.getElementById('plan-library');
            if (!container) return;
            let html = '';
            if (!customPlans.length){
                html += `<section class="bg-white border border-dashed border-blue-200 rounded-2xl p-6 md:p-8 text-sm text-gray-600 shadow-sm">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div>
                            <div class="text-sm font-semibold text-gray-900">定制我的专属计划</div>
                            <div class="mt-2 text-xs text-gray-500 leading-relaxed">首次填报基础信息后，系统将自动生成周期化训练安排，并支持后续再调优。</div>
                        </div>
                        <button class="px-5 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition" onclick="openCustomPlanIntro()">立即制定</button>
                    </div>
                </section>`;
            } else {
                html += `<section class="space-y-3">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-semibold text-gray-900">我的定制计划</h3>
                        <span class="text-xs text-gray-400">共 ${customPlans.length} 个方案</span>
                    </div>
                    ${customPlans.map(plan => planCardTemplate(plan, true)).join('')}
                </section>`;
            }
            html += `<section class="space-y-3">
                <div class="flex items-center justify-between">
                    <h3 class="text-sm font-semibold text-gray-900">推荐训练计划</h3>
                    <span class="text-xs text-gray-400">行业教练精选</span>
                </div>
                ${planLibraryData.regular.map(plan => planCardTemplate(plan, false)).join('')}
            </section>`;
            container.innerHTML = html;
        }

        // 课程库分类
        function switchCourseLib(cat){
            const ids=['course','action','plan','fav'];
            ids.forEach(id=>{
                const b=document.getElementById('lib-tab-'+id); if (!b) return;
                if (id===cat){ b.classList.remove('bg-gray-50','text-gray-700'); b.classList.add('bg-blue-600','text-white'); }
                else { b.classList.add('bg-gray-50','text-gray-700'); b.classList.remove('bg-blue-600','text-white'); }
            });
            document.getElementById('lib-list-course').classList.toggle('hidden', cat!=='course');
            document.getElementById('lib-list-action').classList.toggle('hidden', cat!=='action');
            const planList = document.getElementById('lib-list-plan');
            if (planList) planList.classList.toggle('hidden', cat!=='plan');
            const favList=document.getElementById('lib-list-fav'); if (favList) favList.classList.toggle('hidden', cat!=='fav');
            const banner=document.getElementById('plan-banner'); if (banner) banner.classList.toggle('hidden', cat!=='plan');
            if (cat === 'plan') renderPlanLibrary();
            renderLibFilter(cat);
            // 切换类型时默认收起筛选器
            document.getElementById('lib-filter').classList.add('hidden');
        }

        // 课程详情
        function openCourseDetail(id){ showPage('page-course-detail'); }
        function openActionDetail(id){ showPage('page-action-detail'); }

        function getPlanById(id){
            return planLibraryData.regular.find(plan => plan.id === id) || customPlans.find(plan => plan.id === id) || null;
        }

        function openPlanDetail(id){
            const plan = getPlanById(id);
            if (!plan){
                showPage('page-plan-detail');
                return;
            }
            currentPlanDetail = plan;
            renderPlanDetail(plan);
            showPage('page-plan-detail');
        }

        // 日程：加入日程
        function openScheduleOverlay(){
            buildCalendar();
            document.getElementById('btn-add-schedule').disabled = true;
            document.getElementById('schedule-date-text').textContent = '未选择';
            const overlay = document.getElementById('overlay-schedule');
            const sheet = document.getElementById('overlay-schedule-sheet');
            overlay.classList.remove('hidden');
            requestAnimationFrame(()=> sheet.classList.remove('translate-y-full'));
        }
        function closeScheduleOverlay(){
            const overlay = document.getElementById('overlay-schedule');
            const sheet = document.getElementById('overlay-schedule-sheet');
            sheet.classList.add('translate-y-full');
            setTimeout(()=> overlay.classList.add('hidden'), 200);
        }
        function buildCalendar(){
            const calendar=document.getElementById('calendar'); if (!calendar) return; calendar.innerHTML='';
            const now=new Date(); const y=now.getFullYear(); const m=now.getMonth(); const first=new Date(y,m,1); const start=first.getDay(); const days=new Date(y,m+1,0).getDate();
            for(let i=0;i<start;i++){ const b=document.createElement('div'); calendar.appendChild(b); }
            for(let d=1; d<=days; d++){ const btn=document.createElement('button'); btn.textContent=String(d); btn.className='py-2 rounded hover:bg-gray-100'; btn.onclick=()=>selectScheduleDate(y,m+1,d,btn); calendar.appendChild(btn); }
        }
        function selectScheduleDate(y,m,d,el){ document.querySelectorAll('#calendar button').forEach(b=>b.classList.remove('bg-blue-600','text-white')); el.classList.add('bg-blue-600','text-white'); const t=`${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`; document.getElementById('schedule-date-text').textContent=t; document.getElementById('btn-add-schedule').disabled=false; }
        function confirmAddToSchedule(){ closeScheduleOverlay(); showToast('已加入日程'); }

        // 计划设置
        function openPlanSetupOverlay(){ const overlay=document.getElementById('overlay-plan-setup'); const sheet=document.getElementById('overlay-plan-sheet'); overlay.classList.remove('hidden'); requestAnimationFrame(()=> sheet.classList.remove('translate-y-full')); document.querySelectorAll('#plan-days button').forEach(b=>{ b.onclick=()=>{ b.classList.toggle('bg-blue-600'); b.classList.toggle('text-white'); }; }); }
        function closePlanSetupOverlay(){ const overlay=document.getElementById('overlay-plan-setup'); const sheet=document.getElementById('overlay-plan-sheet'); sheet.classList.add('translate-y-full'); setTimeout(()=> overlay.classList.add('hidden'), 200); }
        function selectPlanStart(v, el){ document.querySelectorAll('#overlay-plan-setup [onclick^="selectPlanStart"]').forEach(b=>b.classList.remove('bg-blue-600','text-white')); el.classList.add('bg-blue-600','text-white'); }
        function confirmEnterPlan(){ closePlanSetupOverlay(); showToast('已进入计划'); }

        // 训练播放（模拟）
        let trainingTimer=null; let trainingDuration=600; let trainingCurrent=0; let trainingPlaying=true; let trainingWeight=7.0; let trainingMode='标准'; let assistOn=true;
        function startTraining(){ showPage('page-training'); trainingDuration=600; trainingCurrent=0; trainingPlaying=true; document.getElementById('btnPlayPause').textContent='暂停'; updateProgressUI(); updateAssistBtn(); spawnBars(); runTrainingTimer(); }
        function startTrainingFree(){ startTraining(); showToast('已进入自由训练'); }
        function runTrainingTimer(){ if (trainingTimer) clearInterval(trainingTimer); trainingTimer=setInterval(()=>{ if (!trainingPlaying) return; trainingCurrent=Math.min(trainingDuration, trainingCurrent+1); updateProgressUI(); randomizeSensors(); if (trainingCurrent>=trainingDuration) { trainingPlaying=false; trainingEnd(); } }, 1000); }
        function updateProgressUI(){ const pct = trainingDuration? (trainingCurrent/trainingDuration*100):0; document.getElementById('progressBar').style.width=pct+'%'; document.getElementById('timeText').textContent = fmtTime(trainingCurrent)+' / '+fmtTime(trainingDuration); document.getElementById('weightVal').textContent = trainingWeight.toFixed(1)+'kg'; }
        function fmtTime(s){ const m=Math.floor(s/60); const ss=String(s%60).padStart(2,'0'); return `${String(m).padStart(2,'0')}:${ss}`; }
        function trainingPlayPause(){ trainingPlaying=!trainingPlaying; document.getElementById('btnPlayPause').textContent = trainingPlaying? '暂停':'播放'; }
        function trainingRewind(){ trainingCurrent=Math.max(0, trainingCurrent-10); updateProgressUI(); }
        function trainingForward(){ trainingCurrent=Math.min(trainingDuration, trainingCurrent+10); updateProgressUI(); }
        function trainingReset(){ trainingCurrent=0; trainingPlaying=true; updateProgressUI(); }
        function trainingEnd(){ if (trainingTimer) clearInterval(trainingTimer); // mock report
            const dur=trainingCurrent;
            // 生成组别数据
            const setCount = 10;
            let totalReps = 0; let totalVolume = 0; let powerAvg = 0; let powerPeak = 0;
            const table = document.getElementById('repSetTable'); table.innerHTML='';
            for (let i=1;i<=setCount;i++){
                const reps = 8 + Math.floor(Math.random()*5); // 8~12
                const w = Math.max(1, Math.round((trainingWeight + (Math.random()-0.5))*2)/2);
                const p = 60 + Math.floor(Math.random()*80);
                const rpe = 6 + Math.floor(Math.random()*4);
                totalReps += reps; totalVolume += (w*reps); powerAvg += p; powerPeak = Math.max(powerPeak, p + Math.floor(Math.random()*40));
                const row = document.createElement('div'); row.className='grid grid-cols-5 px-2 py-2 text-sm';
                row.innerHTML = `<div>${i}</div><div>${reps}</div><div>${w.toFixed(1)}</div><div>${p}</div><div>${rpe}</div>`;
                table.appendChild(row);
            }
            powerAvg = Math.round(powerAvg / setCount);
            const cal = Math.round(dur * 0.16); // 估算
            // 区间分布
            const zones = [0,0,0,0,0];
            for (let i=0;i<setCount;i++){ const z = Math.floor(Math.random()*5); zones[z]+=1; }
            const zonePct = zones.map(z=> Math.round(z/setCount*100));
            const repZones = document.getElementById('repZones'); repZones.innerHTML='';
            const colors = ['#d1fae5','#a7f3d0','#6ee7b7','#34d399','#059669'];
            zonePct.forEach((pct,idx)=>{ const seg=document.createElement('div'); seg.style.width=pct+'%'; seg.style.backgroundColor=colors[idx]; repZones.appendChild(seg); });
            document.getElementById('repZoneLabel').textContent = `Z1 ${zonePct[0]}% · Z2 ${zonePct[1]}% · Z3 ${zonePct[2]}% · Z4 ${zonePct[3]}% · Z5 ${zonePct[4]}%`;
            // 曲线占位（简单条形）
            renderCurve('repPowerCurve'); renderCurve('repHeartCurve');
            // 概览赋值
            document.getElementById('repDur').textContent = fmtTime(dur);
            document.getElementById('repVol').textContent = Math.round(totalVolume).toString();
            document.getElementById('repCal').textContent = cal.toString();
            document.getElementById('repReps').textContent = totalReps.toString();
            document.getElementById('repPowerAvg').textContent = powerAvg.toString();
            document.getElementById('repPowerPeak').textContent = powerPeak.toString();
            document.getElementById('repCadence').textContent = (totalReps / (dur/60)).toFixed(0);
            document.getElementById('repROM').textContent = `${(60+Math.random()*30).toFixed(0)} / ${(60+Math.random()*30).toFixed(0)}`;
            showPage('page-report'); }
        function adjustWeight(delta){ trainingWeight = Math.max(0, Math.round((trainingWeight+delta)*2)/2); updateProgressUI(); }

        // 传感器占位条
        function spawnBars(){ const p=document.getElementById('powerBars'); const l=document.getElementById('ampBarsL'); const r=document.getElementById('ampBarsR'); [p,l,r].forEach(c=>c.innerHTML=''); for(let i=0;i<24;i++){ const b=document.createElement('div'); b.style.width='4px'; b.style.height='10px'; b.className='bg-blue-300 rounded'; p.appendChild(b); } for(let i=0;i<12;i++){ const bl=document.createElement('div'); bl.style.width='6px'; bl.style.height='10px'; bl.className='bg-green-300 rounded'; l.appendChild(bl); const br=document.createElement('div'); br.style.width='6px'; br.style.height='10px'; br.className='bg-purple-300 rounded'; r.appendChild(br); } }
        function randomizeSensors(){ const p=document.getElementById('powerBars').children; for(let i=0;i<p.length;i++){ p[i].style.height = (6 + Math.random()*70)+'px'; } const l=document.getElementById('ampBarsL').children; const r=document.getElementById('ampBarsR').children; for(let i=0;i<l.length;i++){ l[i].style.height=(6+Math.random()*70)+'px'; r[i].style.height=(6+Math.random()*70)+'px'; } }

        function renderCurve(id){ const el=document.getElementById(id); el.innerHTML=''; const wrap=document.createElement('div'); wrap.className='h-full flex items-end gap-1 p-2'; for(let i=0;i<40;i++){ const b=document.createElement('div'); b.style.width='4px'; b.style.height=(10+Math.random()*80)+'px'; b.className='bg-blue-300 rounded'; wrap.appendChild(b); } el.appendChild(wrap); }

        // 自由训练：选择弹层
        function openFreeSelectOverlay(){ const o=document.getElementById('overlay-free-select'); o.classList.remove('hidden'); }
        function closeFreeSelectOverlay(){ const o=document.getElementById('overlay-free-select'); o.classList.add('hidden'); }

        // 自由训练：通用状态
        let freeType='strength'; let freeTimer=null; let freePlaying=false; let freeTime=0; let freeBaseWeight=6.5; let freeOffset=0; let freeVolume=0; let freeAssist=false; let freeHold=false; let freeAvg=0; let freeEnergy=0; let freeFlip=false; let strengthWeightMode='标准'; let strengthAccessory='非杠铃';
        function startFreeTraining(type){ freeType=type; closeFreeSelectOverlay(); resetFreeState(); if (type==='strength'){ showPage('page-free-strength'); spawnFreeBars(); freePlaying=true; runFreeTimer(); updateFreeUI(); } else { showPage('page-free-pilates'); freePlaying=true; runFreeTimer(); updateFreeUI(); } }
        function resetFreeState(){ freePlaying=false; freeTime=0; freeVolume=0; freeEnergy=0; freeBaseWeight= typeDefaultWeight(); freeOffset=0; freeAssist=false; freeHold=false; freeAvg=0; freeFlip=false; freeSpringSelectedButtons=[]; clearInterval(freeTimer); freeTimer=null; }
        function typeDefaultWeight(){ return freeType==='strength' ? 6.5 : 0.0; }
        function currentWeight(){ return Math.max(0, Math.round((freeBaseWeight + freeOffset)*2)/2); }
        function updateFreeUI(){ const w=currentWeight(); if (freeType==='strength'){ document.getElementById('freeDur').textContent=fmtTime(freeTime); document.getElementById('freeVol').textContent=Math.round(freeVolume).toString(); document.getElementById('freeEnergy').textContent=Math.round(freeEnergy).toString(); document.getElementById('freeCal').textContent=Math.round(freeTime*0.14).toString(); const wv=document.getElementById('freeWeightVal'); if (wv) wv.textContent=w.toFixed(1)+'kg'; } else { document.getElementById('pilDur').textContent=fmtTime(freeTime); document.getElementById('pilRes').textContent=w.toFixed(1); document.getElementById('pilCal').textContent=Math.round(freeTime*0.10).toString(); document.getElementById('pilEnergy').textContent=Math.round(freeEnergy).toString(); const pv=document.getElementById('pilWeightVal'); if (pv) pv.textContent=w.toFixed(1)+'kg'; } }
        function freeTick(){ const w=currentWeight(); freeTime+=1; freeVolume += w * 0.8; freeEnergy += w * 0.5; freeAvg = freeType==='strength' ? (40+Math.random()*60) : (12+Math.random()*8); if (freeType==='strength') randomizeFreeSensors(); updateFreeUI(); }
        function runFreeTimer(){ clearInterval(freeTimer); freeTimer=setInterval(()=>{ if (!freePlaying) return; freeTick(); },1000); }
        function freeEnd(){ clearInterval(freeTimer); document.getElementById('frDur').textContent=fmtTime(freeTime); document.getElementById('frVol').textContent=Math.round(freeVolume).toString(); document.getElementById('frCal').textContent = freeType==='strength'? Math.round(freeTime*0.14).toString(): Math.round(freeTime*0.10).toString(); document.getElementById('frAvg').textContent = freeType==='strength'? (Math.round(freeAvg)+' W') : (Math.round(freeAvg)+' 次/分'); // settings
            document.getElementById('frMode').textContent = freeType==='strength'? strengthWeightMode : '—';
            document.getElementById('frAccessory').textContent = freeType==='strength'? strengthAccessory : '—';
            document.getElementById('frAssist').textContent = freeAssist? '开' : '关';
            document.getElementById('frFlip').textContent = freeFlip? '翻转' : '不翻转';
            // springs summary
            const wrap=document.getElementById('frSpringWrap'); const springs=document.getElementById('frSprings'); if (freeType==='pilates'){ wrap.style.display='block'; springs.textContent = getSpringSelectionSummary(); } else { wrap.style.display='none'; }
            // zones + sets + curve
            renderReportDistributions(); renderReportSets(); renderReportCurve();
            showPage('page-free-report'); }
        function setStrengthWeightMode(m){ strengthWeightMode=m; ['标准','离心','等速','弹簧'].forEach(k=>{ const b=document.getElementById('wm-'+k); if (!b) return; b.classList.toggle('bg-blue-600', k===m); b.classList.toggle('text-white', k===m); }); showToast('重量模式：'+m); }
        function setStrengthAccessory(m){ strengthAccessory=m; ['非杠铃','杠铃'].forEach(k=>{ const b=document.getElementById('acc-'+k); if (!b) return; b.classList.toggle('bg-blue-600', k===m); b.classList.toggle('text-white', k===m); }); }
        function toggleStrengthFlip(v){ freeFlip=v; const a=document.getElementById('flip-不翻转'); const b=document.getElementById('flip-翻转'); a.classList.toggle('bg-blue-600', !v); a.classList.toggle('text-white', !v); b.classList.toggle('bg-blue-600', v); b.classList.toggle('text-white', v); }
        function toggleStrengthAssist(v){ freeAssist=v; const a=document.getElementById('assist-关'); const b=document.getElementById('assist-开'); a.classList.toggle('bg-blue-600', !v); a.classList.toggle('text-white', !v); b.classList.toggle('bg-blue-600', v); b.classList.toggle('text-white', v); }
        // 传感器条（自由力量）
        function spawnFreeBars(){ const p=document.getElementById('freePowerBars'); const l=document.getElementById('freeAmpBarsL'); const r=document.getElementById('freeAmpBarsR'); if (!p||!l||!r) return; [p,l,r].forEach(c=>c.innerHTML=''); for(let i=0;i<24;i++){ const b=document.createElement('div'); b.style.width='4px'; b.style.height='10px'; b.className='bg-blue-300 rounded'; p.appendChild(b); } for(let i=0;i<12;i++){ const bl=document.createElement('div'); bl.style.width='6px'; bl.style.height='10px'; bl.className='bg-green-300 rounded'; l.appendChild(bl); const br=document.createElement('div'); br.style.width='6px'; br.style.height='10px'; br.className='bg-purple-300 rounded'; r.appendChild(br); } }
        function randomizeFreeSensors(){ const p=document.getElementById('freePowerBars')?.children||[]; for(let i=0;i<p.length;i++){ p[i].style.height=(6+Math.random()*70)+'px'; } const l=document.getElementById('freeAmpBarsL')?.children||[]; const r=document.getElementById('freeAmpBarsR')?.children||[]; for(let i=0;i<l.length;i++){ l[i].style.height=(6+Math.random()*70)+'px'; r[i].style.height=(6+Math.random()*70)+'px'; } }

        // 普拉提快捷函数复用同一状态
        function setPilMode(m){ showToast('普拉提模式：'+m); }
        function togglePilAssist(v){ freeAssist=v; const a=document.getElementById('pil-assist-关'); const b=document.getElementById('pil-assist-开'); a.classList.toggle('bg-blue-600', !v); a.classList.toggle('text-white', !v); b.classList.toggle('bg-blue-600', v); b.classList.toggle('text-white', v); updateFreeUI(); }
        function togglePilFlip(v){ freeFlip=v; const a=document.getElementById('pil-flip-不翻转'); const b=document.getElementById('pil-flip-翻转'); a.classList.toggle('bg-blue-600', !v); a.classList.toggle('text-white', !v); b.classList.toggle('bg-blue-600', v); b.classList.toggle('text-white', v); }
        let freeSpringSelectedButtons=[];
        function toggleSpring(el){ el.classList.toggle('bg-blue-600'); el.classList.toggle('text-white'); // 允许重复重量的多选
            const chips = document.querySelectorAll('#pilSpringChips button'); let sum=0; chips.forEach(c=>{ if (c.classList.contains('bg-blue-600')) sum += parseFloat(c.getAttribute('data-w')); }); freeBaseWeight = sum; updateFreeUI(); }

        // 统计弹簧组合摘要
        function getSpringSelectionSummary(){
            const chips = document.querySelectorAll('#pilSpringChips button');
            const map = new Map();
            let total = 0;
            chips.forEach(c => {
                if (c.classList.contains('bg-blue-600')) {
                    const w = parseFloat(c.getAttribute('data-w'));
                    total += w;
                    map.set(w, (map.get(w) || 0) + 1);
                }
            });
            if (map.size === 0) return '未选择';
            const parts = Array.from(map.entries()).sort((a,b)=>a[0]-b[0]).map(([w,n]) => `${w}kg x${n}`);
            return parts.join('，') + `（合计 ${total.toFixed(1)}kg）`;
        }

        // 微调按钮（±0.5kg）
        function freeAdjustWeight(delta){ freeOffset = Math.round((freeOffset + delta)*2)/2; updateFreeUI(); }
        function pilAdjustWeight(delta){ freeAdjustWeight(delta); }

        // 普拉提：结束训练（包装到通用结束）
        function pilEnd(){ freeEnd(); }
        // 保障内联 onclick 可访问
        window.pilEnd = pilEnd;

        // 报告：分布/组次/曲线
        function renderReportDistributions(){ const zones=[0,0,0,0,0]; const sets=8; for(let i=0;i<sets;i++){ zones[Math.floor(Math.random()*5)]++; } const pct=zones.map(z=>Math.round(z/sets*100)); const colors=['#d1fae5','#a7f3d0','#6ee7b7','#34d399','#059669']; const bar=document.getElementById('frZones'); bar.innerHTML=''; pct.forEach((p,i)=>{ const seg=document.createElement('div'); seg.style.width=p+'%'; seg.style.backgroundColor=colors[i]; bar.appendChild(seg); }); document.getElementById('frZonesLabel').textContent = `Z1 ${pct[0]}% · Z2 ${pct[1]}% · Z3 ${pct[2]}% · Z4 ${pct[3]}% · Z5 ${pct[4]}%`; }
        function renderReportSets(){ const table=document.getElementById('frSetTable'); table.innerHTML=''; const estSets=Math.max(5, Math.floor(freeTime/60)); for(let i=1;i<=estSets;i++){ const reps=8+Math.floor(Math.random()*5); const w=currentWeight(); const p= freeType==='strength'? 60+Math.floor(Math.random()*80) : 10+Math.floor(Math.random()*10); const rpe=6+Math.floor(Math.random()*4); const row=document.createElement('div'); row.className='grid grid-cols-5 px-2 py-2 text-sm'; row.innerHTML=`<div>${i}</div><div>${reps}</div><div>${w.toFixed(1)}</div><div>${p}</div><div>${rpe}</div>`; table.appendChild(row); } }
        function renderReportCurve(){ const el=document.getElementById('frCurve'); el.innerHTML=''; const wrap=document.createElement('div'); wrap.className='h-full flex items-end gap-1 p-2'; for(let i=0;i<60;i++){ const b=document.createElement('div'); b.style.width='3px'; b.style.height=(8+Math.random()*80)+'px'; b.className='bg-blue-300 rounded'; wrap.appendChild(b); } el.appendChild(wrap); }
        function pilEnd(){ freeEnd(); }
        // Tab关联筛选
        function chip(label){ return `<button class=\"px-3 py-2 rounded border text-gray-700 bg-white\" onclick=\"this.classList.toggle('ring-2');this.classList.toggle('ring-blue-500');\">${label}</button>`; }
        function group(title, chips){ return `<div class=\"mt-3\"><div class=\"text-sm font-medium text-gray-700\">${title}</div><div class=\"mt-2 grid grid-cols-4 gap-2\">${chips.map(c=>chip(c)).join('')}<\/div><\/div>`; }
        function renderLibFilter(cat){ const c=document.getElementById('lib-filter'); if (!c) return; let html=''; if (cat==='course'){ html+=group('类型',['力量训练','普拉提','有氧混合','拉伸恢复']); html+=group('难度',['初级','中级','高级']); html+=group('配件',['健身凳','手柄','阻力带','杠铃/铃']); } else if (cat==='action'){ html+=group('训练部位',['胸部','肩部','背部','臀部','腿部','手臂','腹部','全身']); html+=group('肌群',['肱二头肌','胸大肌','腹肌','三角肌前束','肱三头肌','竖脊肌','背阔肌']); html+=group('难度',['初级','中级','高级']); html+=group('配件',['健身凳','折叠凳','划船类','手柄','杠铃/铃','双头绳','负重带']); } else if (cat==='plan'){ html+=group('类型',['力量训练','普拉提','有氧混合','拉伸恢复']); html+=group('难度',['初级','中级','高级']); html+=group('计划时长',['3周','4周','5周']); html+=group('每周频次',['2次','3次','4次']); } else if (cat==='fav'){ html+=group('内容类型',['课程','动作','计划']); html+=group('标签',['核心','拉伸','燃脂','上肢','下肢']); }
            html += `<div class=\"mt-4 flex gap-3 justify-end\"><button class=\"px-3 py-2 border rounded\" onclick=\"resetLibFilter()\">重置</button><button class=\"px-3 py-2 bg-blue-600 text-white rounded\" onclick=\"applyLibFilter()\">确定</button></div>`;
            c.innerHTML = html; }

        function toggleLibFilter(open){ const p=document.getElementById('lib-filter'); if (!p) return; if (open){ p.classList.remove('hidden'); } else { p.classList.add('hidden'); } }
        function resetLibFilter(){ document.querySelectorAll('#lib-filter .ring-2').forEach(b=>{ b.classList.remove('ring-2','ring-blue-500'); }); }
        function applyLibFilter(){ toggleLibFilter(false); showToast('筛选已应用'); }

        function ensureQrModal(){
            if (qrModalOverlay) return;
            qrModalOverlay = document.createElement('div');
            qrModalOverlay.id = 'qr-modal-overlay';
            qrModalOverlay.className = 'hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 px-4';
            qrModalOverlay.innerHTML = `
                <div class="relative bg-white rounded-3xl shadow-2xl w-[360px] max-w-full p-6 text-center">
                    <button id="qr-close-btn" class="absolute top-3 right-3 px-2 py-1 text-sm text-gray-500 hover:text-gray-800" aria-label="关闭">×</button>
                    <div id="qr-modal-title" class="text-lg font-bold text-gray-900"></div>
                    <img id="qr-modal-img" src="https://placehold.co/232x232?text=QR" class="mx-auto my-5 w-52 h-52 object-contain rounded" alt="Motion Station 二维码" />
                    <div id="qr-modal-desc" class="text-sm text-gray-600"></div>
                    <div class="mt-5">
                        <button class="w-full border border-gray-200 text-gray-700 font-medium py-2 rounded-lg hover:bg-gray-50" id="qr-close-button">关闭</button>
                    </div>
                </div>`;
            document.body.appendChild(qrModalOverlay);
            const close = () => closeQrModal();
            qrModalOverlay.addEventListener('click', e => { if (e.target === qrModalOverlay) close(); });
            qrModalOverlay.querySelector('#qr-close-btn').addEventListener('click', close);
            qrModalOverlay.querySelector('#qr-close-button').addEventListener('click', close);
        }

        function openQrModal(type){
            ensureQrModal();
            if (!qrModalOverlay) return;
            const title = qrModalOverlay.querySelector('#qr-modal-title');
            const desc = qrModalOverlay.querySelector('#qr-modal-desc');
            if (type === 'login'){
                title.textContent = '扫码登录';
                desc.textContent = '请您在手机打开 Motion Station APP，然后扫上方二维码登录。';
            } else {
                title.textContent = '下载 Motion Station APP';
                desc.textContent = '请在手机端使用相机、浏览器或在应用中心扫码后下载 Motion Station APP。';
            }
            qrModalOverlay.classList.remove('hidden');
        }

        function closeQrModal(){ if (qrModalOverlay) qrModalOverlay.classList.add('hidden'); }

        function renderPlanDetail(plan){
            const theme = planThemeOf(plan);
            const header = document.getElementById('plan-detail-header');
            if (header) header.textContent = plan.custom ? '专属计划详情' : '计划详情';
            const hero = document.getElementById('plan-detail-hero');
            if (hero) hero.className = `relative overflow-hidden rounded-2xl h-48 text-white shadow ${theme.hero}`;
            const category = document.getElementById('plan-detail-category');
            if (category) category.textContent = plan.category || (plan.custom ? '定制计划' : '训练计划');
            const title = document.getElementById('plan-detail-title');
            if (title) title.textContent = plan.name || '计划详情';
            const tags = document.getElementById('plan-detail-tags');
            if (tags) tags.innerHTML = planBadgeList(plan).map(b => `<span class="px-3 py-1 rounded-full bg-white/20 backdrop-blur text-xs">${b}</span>`).join('');
            const weeks = document.getElementById('plan-detail-weeks');
            if (weeks) weeks.textContent = plan.weeks ? `${plan.weeks} 周` : '--';
            const freq = document.getElementById('plan-detail-frequency');
            if (freq) freq.textContent = plan.frequency ? `每周 ${plan.frequency} 次` : '—';
            const level = document.getElementById('plan-detail-level');
            if (level) level.textContent = plan.level || '—';
            const focus = document.getElementById('plan-detail-focus');
            if (focus) focus.textContent = plan.focus?.length ? plan.focus.join(' / ') : '—';
            const desc = document.getElementById('plan-detail-desc');
            if (desc) desc.textContent = plan.summary || '—';
            const highlights = document.getElementById('plan-detail-highlights');
            if (highlights){
                if (plan.highlights?.length){
                    highlights.innerHTML = plan.highlights.map(h => `<span class="px-3 py-1 rounded-full bg-blue-50 text-blue-600">${h}</span>`).join('');
                } else {
                    highlights.innerHTML = '';
                }
            }
            const durationTip = document.getElementById('plan-detail-duration-tip');
            if (durationTip) durationTip.textContent = plan.durationTip || '';
            const notesWrap = document.getElementById('plan-detail-notes-wrap');
            const notesList = document.getElementById('plan-detail-notes');
            if (notesWrap && notesList){
                if (plan.notes?.length){
                    notesWrap.classList.remove('hidden');
                    notesList.innerHTML = plan.notes.map(note => `<li>${note}</li>`).join('');
                } else {
                    notesWrap.classList.add('hidden');
                    notesList.innerHTML = '';
                }
            }
            const joinBtn = document.getElementById('plan-detail-join-btn');
            if (joinBtn) joinBtn.textContent = plan.custom ? '加入我的日程' : '加入日程';
            const startBtn = document.getElementById('plan-detail-start-btn');
            if (startBtn) startBtn.textContent = plan.custom ? '开始第一节训练' : '开始训练';
            renderPlanSchedule(plan);
        }

        function renderPlanSchedule(plan){
            const daysContainer = document.getElementById('planDays');
            const listContainer = document.getElementById('planDayCourses');
            if (!daysContainer || !listContainer) return;
            daysContainer.innerHTML = '';
            listContainer.innerHTML = '';
            const schedule = plan.schedule && plan.schedule.length ? plan.schedule : [];
            if (!schedule.length){
                listContainer.innerHTML = '<div class="bg-white border rounded-xl p-4 text-sm text-gray-500">暂未提供详细安排。</div>';
                return;
            }
            schedule.forEach((day, index) => {
                const btn = document.createElement('button');
                btn.className = 'border rounded-lg px-2 py-2 text-xs text-gray-600 hover:border-blue-400 transition flex flex-col gap-0.5';
                btn.innerHTML = `<span>${day.day || `第${index+1}天`}</span><span class="text-[11px] text-gray-400">${day.status || ''}</span>`;
                btn.onclick = () => {
                    daysContainer.querySelectorAll('button').forEach(b => b.classList.remove('bg-blue-600','text-white','border-blue-600','shadow'));
                    btn.classList.add('bg-blue-600','text-white','border-blue-600','shadow');
                    renderPlanDayItems(day);
                };
                daysContainer.appendChild(btn);
                if (index === 0) requestAnimationFrame(() => btn.click());
            });
        }

        function renderPlanDayItems(day){
            const container = document.getElementById('planDayCourses');
            if (!container) return;
            container.innerHTML = '';
            if (!day.items || !day.items.length){
                container.innerHTML = '<div class="bg-white border border-dashed rounded-xl p-4 text-sm text-gray-500">休息日 · 建议进行轻松步行或拉伸放松。</div>';
                return;
            }
            day.items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-white border rounded-xl p-4 flex items-start justify-between gap-3';
                const detail = [item.duration, item.focus].filter(Boolean).join(' · ');
                const tip = item.tip ? `<div class="text-xs text-blue-500 mt-1">${item.tip}</div>` : '';
                card.innerHTML = `
                    <div class="flex-1 min-w-0">
                        <div class="text-sm font-medium text-gray-900">${item.name}</div>
                        ${detail ? `<div class="text-xs text-gray-500 mt-1">${detail}</div>` : ''}
                        ${tip}
                    </div>
                    <span class="px-2 py-0.5 rounded-full text-xs ${planTagClass(item.tag)}">${item.tag || '训练'}</span>
                `;
                container.appendChild(card);
            });
        }

        function openCustomPlanIntro(){
            showPage('page-custom-plan-intro');
        }

        function startCustomPlanForm(){
            const name = document.getElementById('custom-name');
            if (name) name.value = customPlanProfile.name || '';
            const gender = document.getElementById('custom-gender');
            if (gender) gender.value = customPlanProfile.gender || '女';
            const height = document.getElementById('custom-height');
            if (height) height.value = customPlanProfile.height || '';
            const weight = document.getElementById('custom-weight');
            if (weight) weight.value = customPlanProfile.weight || '';
            const level = document.getElementById('custom-level');
            if (level) level.value = customPlanProfile.level || '进阶';
            const goal = document.getElementById('custom-goal');
            if (goal) goal.value = customPlanProfile.goal || '增肌塑形';
            const frequency = document.getElementById('custom-frequency');
            if (frequency) frequency.value = String(customPlanProfile.frequency || 3);
            const timeSlot = document.getElementById('custom-time-slot');
            if (timeSlot) timeSlot.value = customPlanProfile.timeSlot || '工作日晚间';
            const injury = document.getElementById('custom-injury');
            if (injury) injury.value = customPlanProfile.injury || '无';
            const note = document.getElementById('custom-note');
            if (note) note.value = customPlanProfile.note || '';

            customFocusSelection = new Set(customPlanProfile.focus || []);
            document.querySelectorAll('#custom-focus-group button').forEach(btn => {
                const value = btn.getAttribute('data-value');
                const active = customFocusSelection.has(value);
                btn.classList.toggle('bg-blue-600', active);
                btn.classList.toggle('text-white', active);
                btn.classList.toggle('border-blue-600', active);
            });
            showPage('page-custom-plan-form');
        }

        function toggleFocusChip(btn){
            const value = btn.getAttribute('data-value');
            if (!value) return;
            if (customFocusSelection.has(value)){
                customFocusSelection.delete(value);
                btn.classList.remove('bg-blue-600','text-white','border-blue-600');
            } else {
                customFocusSelection.add(value);
                btn.classList.add('bg-blue-600','text-white','border-blue-600');
            }
        }

        function submitCustomPlanForm(){
            const name = (document.getElementById('custom-name').value.trim()) || customPlanProfile.name || '训练者';
            const gender = document.getElementById('custom-gender').value;
            const heightValue = Number(document.getElementById('custom-height').value);
            const weightValue = Number(document.getElementById('custom-weight').value);
            const level = document.getElementById('custom-level').value;
            const goal = document.getElementById('custom-goal').value;
            const frequencyValue = Number(document.getElementById('custom-frequency').value);
            const timeSlot = document.getElementById('custom-time-slot').value;
            const injury = document.getElementById('custom-injury').value;
            const note = document.getElementById('custom-note').value.trim();
            if (!customFocusSelection.size){
                showToast('请选择至少一个重点关注部位');
                return;
            }
            customPlanProfile = {
                name,
                gender,
                height: Number.isFinite(heightValue) && heightValue > 0 ? heightValue : customPlanProfile.height,
                weight: Number.isFinite(weightValue) && weightValue > 0 ? weightValue : customPlanProfile.weight,
                level,
                goal,
                frequency: Number.isFinite(frequencyValue) && frequencyValue > 0 ? frequencyValue : customPlanProfile.frequency,
                timeSlot,
                focus: Array.from(customFocusSelection),
                injury,
                note
            };
            showCustomPlanLoading();
            setTimeout(() => {
                const plan = generateCustomPlan(customPlanProfile);
                customPlans.unshift(plan);
                if (customPlans.length > 3) customPlans = customPlans.slice(0, 3);
                hideCustomPlanLoading();
                renderPlanLibrary();
                openPlanDetail(plan.id);
                showToast('专属计划已生成');
            }, 900);
        }

        function showCustomPlanLoading(){
            const overlay = document.getElementById('custom-plan-loading');
            if (overlay) overlay.classList.remove('hidden');
        }

        function hideCustomPlanLoading(){
            const overlay = document.getElementById('custom-plan-loading');
            if (overlay) overlay.classList.add('hidden');
        }

        function buildTrainingItems(goal, level, focusPrimary, focusSecondary){
            const warmupDuration = level === '初学' ? '5 min' : '7 min';
            const mainDuration = level === '初学' ? '24 min' : level === '进阶' ? '30 min' : '34 min';
            const auxDuration = level === '初学' ? '8 min' : '10 min';
            const warmupName = focusPrimary === '心肺' ? '热身 · 动感步频' : '热身 · 动态激活';
            const mainNameMap = {
                '腰腹': '主训练 · 核心稳定与抗旋',
                '臀腿': '主训练 · 臀腿力量循环',
                '肩背': '主训练 · 上背力量与灵活',
                '柔韧恢复': '主训练 · 普拉提柔韧序列',
                '全身心肺': '主训练 · 有氧间歇组合'
            };
            const mainName = mainNameMap[focusPrimary] || '主训练 · 综合动作组合';
            const auxName = focusSecondary === focusPrimary ? '辅助 · 平衡强化' : `辅助 · ${focusSecondary}激活`;
            const mainTag = goal.includes('减脂') ? '体能' : '主训练';
            return [
                { name: warmupName, tag: '热身', duration: warmupDuration, focus: '全身关节' },
                { name: mainName, tag: mainTag, duration: mainDuration, focus: focusPrimary },
                { name: auxName, tag: '辅助', duration: auxDuration, focus: focusSecondary },
                { name: '恢复 · 静态拉伸', tag: '恢复', duration: '6 min', focus: focusSecondary }
            ];
        }

        function buildCustomSchedule(profile, focusPrimary, focusSecondary){
            const days = ['周一','周二','周三','周四','周五','周六','周日'];
            const patternMap = {
                2: [1,4],
                3: [1,3,5],
                4: [1,2,4,6],
                5: [1,2,4,5,6]
            };
            const pattern = patternMap[profile.frequency] || [1,3,5];
            return days.map((label, index) => {
                const dayIndex = index + 1;
                if (pattern.includes(dayIndex)){
                    return {
                        day: label,
                        status: '训练',
                        items: buildTrainingItems(profile.goal, profile.level, focusPrimary, focusSecondary)
                    };
                }
                if (dayIndex === 7){
                    return {
                        day: label,
                        status: '恢复',
                        items: [
                            { name: '恢复拉伸 · 全身舒展', tag: '恢复', duration: '18 min', focus: focusSecondary },
                            { name: '呼吸冥想', tag: '恢复', duration: '10 min', focus: '呼吸节奏' }
                        ]
                    };
                }
                return {
                    day: label,
                    status: '休息',
                    items: [
                        { name: '休息 · 轻松活动', tag: '休息', tip: '建议 10~15 分钟轻松步行或泡沫轴放松。' }
                    ]
                };
            });
        }

        function generateCustomPlan(profile){
            const id = `custom-${Date.now()}`;
            const theme = 'custom';
            const intensity = profile.level === '初学' ? '轻度' : profile.level === '进阶' ? '中等' : '中高';
            const duration = profile.level === '初学' ? '35~45' : profile.level === '进阶' ? '45~55' : '55~65';
            const goal = profile.goal || '';
            let type = '综合训练';
            if (goal.includes('增肌') || goal.includes('力量')) type = '力量训练';
            else if (goal.includes('减脂')) type = '有氧混合';
            else if (goal.includes('康复') || goal.includes('体态')) type = '拉伸';
            const focusPrimary = profile.focus[0] || '全身心肺';
            const focusSecondary = profile.focus[1] || focusPrimary;
            const schedule = buildCustomSchedule(profile, focusPrimary, focusSecondary);
            const generatedAt = new Date();
            return {
                id,
                name: `${goal}专属计划`,
                category: '定制计划',
                type,
                theme,
                level: profile.level,
                weeks: profile.level === '初学' ? 3 : profile.level === '进阶' ? 4 : 6,
                frequency: profile.frequency,
                focus: profile.focus,
                summary: `根据您的 ${goal} 目标与 ${profile.focus.join('、')} 关注部位定制，推荐在 ${profile.timeSlot} 执行，训练强度 ${intensity}。`,
                highlights: [
                    `重点部位：${profile.focus.join(' / ')}`,
                    `训练频次：每周 ${profile.frequency} 次`,
                    profile.injury === '无' ? '当前无明显伤病风险' : `伤病防护：避免高冲击，留意 ${profile.injury}`
                ],
                durationTip: `单次训练约 ${duration} 分钟`,
                notes: [
                    `建议按照 ${profile.timeSlot} 固定时段完成训练。`,
                    profile.note ? profile.note : '训练期间保持 7 小时以上睡眠与足量补水。'
                ],
                schedule,
                custom: true,
                generatedAt,
                generatedLabel: formatDateLabel(generatedAt),
                progressLabel: '第 1 周 · 待开始'
            };
        }

        // 模式 & 助力
        function openModeOverlay(){ document.getElementById('overlay-mode').classList.remove('hidden'); }
        function closeModeOverlay(){ document.getElementById('overlay-mode').classList.add('hidden'); }
        function setTrainingMode(m){ trainingMode=m; showToast('已切换模式：'+m); closeModeOverlay(); }
        function toggleAssistDirect(){ assistOn=!assistOn; updateAssistBtn(); showToast('助力已'+(assistOn?'开启':'关闭')); }
        function updateAssistBtn(){ const b=document.getElementById('assistSwitchBtn'); if (b) b.textContent = '助力：'+(assistOn?'开':'关'); }

        function populateMyPage(){
            const totalDaysEl = document.getElementById('my-total-days');
            const sessionsEl = document.getElementById('my-last7-sessions');
            const durationEl = document.getElementById('my-last7-duration');
            const caloriesEl = document.getElementById('my-last7-calories');
            const volumeEl = document.getElementById('my-last7-volume');
            if (totalDaysEl) totalDaysEl.textContent = `${myStats.totalDays} 天`;
            if (sessionsEl) sessionsEl.textContent = `${myStats.last7Sessions} 次`;
            if (durationEl) durationEl.textContent = myStats.last7Duration;
            if (caloriesEl) caloriesEl.textContent = myStats.last7Calories;
            if (volumeEl) volumeEl.textContent = myStats.last7Volume;
        }

        function highlightProfileOptions(group){
            const nodes = document.querySelectorAll(`[data-profile-group="${group}"]`);
            nodes.forEach(btn => {
                const value = btn.getAttribute('data-value');
                let active = false;
                if (profileSelections[group] instanceof Set){
                    active = profileSelections[group].has(value);
                } else {
                    active = profileSelections[group] === value;
                }
                btn.classList.toggle('bg-blue-600', active);
                btn.classList.toggle('text-white', active);
                btn.classList.toggle('border-blue-600', active);
                btn.classList.toggle('border-gray-300', !active);
                btn.classList.toggle('text-gray-600', !active);
                btn.classList.toggle('shadow', active);
            });
        }

        function highlightAllProfileOptions(){ ['level','goals','focus','injury'].forEach(group => highlightProfileOptions(group)); }

        function setProfileOption(group, value){ profileSelections[group] = value; highlightProfileOptions(group); }

        function toggleProfileMulti(group, value){
            if (!(profileSelections[group] instanceof Set)) profileSelections[group] = new Set();
            const set = profileSelections[group];
            if (set.has(value)) set.delete(value); else set.add(value);
            highlightProfileOptions(group);
        }

        function saveUserProfile(){ showToast('资料已保存（示意）'); showPage('page-my'); }

        function openSettings(){ showPage('page-settings'); }

        function scheduleKeyFromDate(date){
            return `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
        }

        function normalizeScheduleSelection(){
            const current = scheduleState.currentMonth;
            const selected = scheduleState.selectedDate;
            if (selected && selected.getFullYear() === current.getFullYear() && selected.getMonth() === current.getMonth()) return;
            const today = new Date();
            if (today.getFullYear() === current.getFullYear() && today.getMonth() === current.getMonth()) {
                scheduleState.selectedDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                return;
            }
            const matches = Object.keys(scheduleMockData).filter(key => {
                const d = new Date(key);
                return d.getFullYear() === current.getFullYear() && d.getMonth() === current.getMonth();
            }).sort();
            if (matches.length){
                scheduleState.selectedDate = new Date(matches[0]);
            } else {
                scheduleState.selectedDate = new Date(current.getFullYear(), current.getMonth(), 1);
            }
        }

        function renderScheduleView(){
            const grid = document.getElementById('schedule-calendar-grid');
            if (!grid) return;
            normalizeScheduleSelection();
            renderScheduleCalendar();
            renderScheduleDetails();
            renderScheduleUpcoming();
        }

        function renderScheduleCalendar(){
            const grid = document.getElementById('schedule-calendar-grid'); if (!grid) return;
            grid.innerHTML = '';
            const current = scheduleState.currentMonth;
            const year = current.getFullYear();
            const month = current.getMonth();
            const header = document.getElementById('schedule-month');
            if (header) header.textContent = `${year}年${month+1}月`;
            const firstDay = new Date(year, month, 1);
            const startOffset = (firstDay.getDay() + 6) % 7;
            for (let i=0;i<startOffset;i++){ const placeholder=document.createElement('div'); grid.appendChild(placeholder); }
            const daysInMonth = new Date(year, month+1, 0).getDate();
            const today = new Date();
            const todayKey = scheduleKeyFromDate(today);
            const selectedKey = scheduleKeyFromDate(scheduleState.selectedDate);
            for (let day=1; day<=daysInMonth; day++){
                const dateKey = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                const record = scheduleMockData[dateKey];
                const hasPlans = record?.plans?.length > 0;
                const hasCourses = record?.courses?.length > 0;
                const btn = document.createElement('button');
                btn.className = 'h-16 rounded-xl border flex flex-col items-center justify-center gap-1 text-sm transition text-gray-600';
                if (dateKey === selectedKey){
                    btn.classList.add('bg-blue-600','text-white','border-blue-500','shadow-lg');
                } else if (dateKey === todayKey){
                    btn.classList.add('border-blue-500','text-blue-600','bg-blue-50');
                } else {
                    btn.classList.add('border-gray-200','hover:border-blue-300','hover:bg-blue-50');
                }
                const dayLabel = document.createElement('span');
                dayLabel.textContent = day;
                dayLabel.className = 'text-base font-semibold';
                btn.appendChild(dayLabel);
                if (hasPlans || hasCourses){
                    const indicator = document.createElement('span');
                    indicator.className = 'px-2 py-0.5 rounded-full text-[10px] font-medium';
                    if (hasPlans && hasCourses){ indicator.classList.add('bg-amber-100','text-amber-600'); indicator.textContent='双项'; }
                    else if (hasPlans){ indicator.classList.add('bg-blue-100','text-blue-600'); indicator.textContent='计划'; }
                    else { indicator.classList.add('bg-emerald-100','text-emerald-600'); indicator.textContent='课程'; }
                    btn.appendChild(indicator);
                }
                btn.onclick = () => selectScheduleDate(dateKey);
                grid.appendChild(btn);
            }
        }

        function renderScheduleDetails(){
            const container = document.getElementById('schedule-detail-list'); if (!container) return;
            const selected = scheduleState.selectedDate;
            const header = document.getElementById('schedule-selected-date');
            if (header) header.textContent = `${selected.getMonth()+1}月${selected.getDate()}日 · ${formatWeekday(selected)}`;
            const key = scheduleKeyFromDate(selected);
            const record = scheduleMockData[key];
            if (!record || ((!record.plans || !record.plans.length) && (!record.courses || !record.courses.length))){
                container.innerHTML = '<div class="text-sm text-gray-500">当天暂无安排，您可以在课程或计划详情页加入日程。</div>';
                return;
            }
            let html = '';
            if (record.plans?.length){
                html += '<div class="mb-4"><div class="text-sm font-semibold text-gray-900 mb-2">关联计划</div><div class="space-y-2">';
                record.plans.forEach(plan => {
                    html += `<div class="border border-blue-100 bg-blue-50 text-blue-700 rounded-lg px-4 py-3">
                        <div class="text-sm font-semibold">${plan.name}</div>
                        <div class="text-xs opacity-80 mt-1">${plan.note || ''}</div>
                        <div class="text-xs opacity-80">教练：${plan.coach || '系统推荐'}</div>
                    </div>`;
                });
                html += '</div></div>';
            }
            if (record.courses?.length){
                html += '<div><div class="text-sm font-semibold text-gray-900 mb-2">关联课程</div><div class="space-y-2">';
                record.courses.forEach(course => {
                    html += `<div class="border border-gray-200 rounded-lg px-4 py-3 bg-white shadow-sm">
                        <div class="flex items-center justify-between">
                            <div class="text-sm font-semibold text-gray-900">${course.name}</div>
                            <span class="text-xs text-gray-400">${course.duration || '--'}</span>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">标签：${course.tag || '课程'}</div>
                    </div>`;
                });
                html += '</div></div>';
            }
            container.innerHTML = html;
        }

        function renderScheduleUpcoming(){
            const container = document.getElementById('schedule-upcoming-list'); if (!container) return;
            const today = new Date();
            const upcoming = [];
            for (let i=0; i<14; i++){
                const d = new Date(today.getFullYear(), today.getMonth(), today.getDate()+i);
                const key = scheduleKeyFromDate(d);
                const record = scheduleMockData[key];
                if (record && ((record.plans && record.plans.length) || (record.courses && record.courses.length))){
                    upcoming.push({ date: d, record });
                }
                if (upcoming.length >= 5) break;
            }
            if (!upcoming.length){
                container.innerHTML = '<div class="text-sm text-gray-500">暂无即将到来的安排。</div>';
                return;
            }
            const html = upcoming.map(item => {
                const date = item.date;
                const plans = item.record.plans?.length || 0;
                const courses = item.record.courses?.length || 0;
                const summary = [
                    plans ? `计划 ×${plans}` : '',
                    courses ? `课程 ×${courses}` : ''
                ].filter(Boolean).join(' · ');
                const highlight = plans ? item.record.plans[0].name : (item.record.courses[0]?.name || '自由安排');
                return `<div class="border border-gray-200 rounded-xl px-4 py-3 bg-white shadow-sm">
                    <div class="flex items-center justify-between">
                        <div class="text-sm font-semibold text-gray-900">${date.getMonth()+1}月${date.getDate()}日 · ${formatWeekday(date)}</div>
                        <span class="text-xs text-gray-400">${summary}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1">重点推荐：${highlight}</div>
                </div>`;
            }).join('');
            container.innerHTML = html;
        }

        function renderMyTrainingList(){
            const list = document.getElementById('my-training-list'); if (!list) return;
            list.innerHTML = trainingRecords.map(record => `
                <div class="border border-gray-200 rounded-xl px-4 py-4 bg-white shadow-sm flex items-center gap-4">
                    <div class="flex flex-col items-center text-xs text-gray-400 w-16">
                        <span class="text-sm font-semibold text-gray-700">${record.date.split('-')[1]}/${record.date.split('-')[2]}</span>
                        <span>${record.weekday}</span>
                        <span class="mt-1 text-[10px] px-2 py-0.5 rounded-full bg-blue-50 text-blue-600">${record.time}</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between">
                            <div class="text-sm font-semibold text-gray-900">${record.title}</div>
                            <button class="text-xs text-blue-600 hover:underline" onclick="openTrainingDetail('${record.id}')">查看详情</button>
                        </div>
                        <div class="mt-1 text-xs text-gray-500">时长 ${record.duration} · 消耗 ${record.calories} · 训练量 ${record.volume}</div>
                        <div class="mt-2 flex items-center justify-between">
                            <div class="flex flex-wrap gap-2 text-[11px] text-blue-600">
                                ${record.tags.map(tag => `<span class="px-2 py-0.5 rounded-full bg-blue-50">${tag}</span>`).join('')}
                            </div>
                            <div class="text-xs text-emerald-500">${record.mood}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openTrainingDetail(id){
            const detail = trainingDetailData[id];
            if (!detail) { showToast('未找到训练详情'); return; }
            currentTrainingDetailId = id;
            const setText = (sel, text) => { const el = document.getElementById(sel); if (el) el.textContent = text; };
            setText('training-detail-title', detail.title);
            setText('training-detail-date', detail.date);
            setText('training-detail-device', detail.device);
            setText('training-detail-duration', detail.duration);
            setText('training-detail-volume', detail.volume);
            setText('training-detail-calories', detail.calories);
            setText('training-detail-power', detail.power);
            const highlights = document.getElementById('training-detail-highlights');
            if (highlights) highlights.innerHTML = detail.highlights.map(t => `<div class="flex items-start gap-2"><span class="mt-1 w-1.5 h-1.5 rounded-full bg-blue-500"></span><span>${t}</span></div>`).join('');
            const segments = document.getElementById('training-detail-segments');
            if (segments) segments.innerHTML = detail.segments.map(seg => `<div class="border border-gray-200 rounded-lg px-4 py-3"><div class="text-sm font-semibold text-gray-900">${seg.name}</div><div class="text-xs text-gray-500 mt-1">${seg.detail}</div></div>`).join('');
            showPage('page-training-detail');
        }

        function populateTrainingShare(){
            if (!currentTrainingDetailId) return;
            const detail = trainingDetailData[currentTrainingDetailId];
            if (!detail) return;
            const share = detail.share;
            const setText = (id, text) => { const el = document.getElementById(id); if (el) el.textContent = text; };
            setText('share-title', share.title);
            setText('share-subtitle', share.subtitle);
            setText('share-duration', share.duration);
            setText('share-calories', share.calories);
            setText('share-volume', share.volume);
            setText('share-highlight', share.highlight);
        }

        function openTrainingShare(){
            if (!currentTrainingDetailId) { showToast('请先选择训练记录'); return; }
            populateTrainingShare();
            showPage('page-training-share');
        }

        function switchFavoriteTab(tab){ currentFavoriteTab = tab; renderFavoriteList(); ['course','action','plan'].forEach(key => { const btn=document.getElementById(`fav-tab-${key}`); if (btn){ btn.classList.toggle('bg-blue-600', key===tab); btn.classList.toggle('text-white', key===tab); btn.classList.toggle('text-gray-600', key!==tab); } }); }

        function renderFavoriteList(){
            const list = document.getElementById('favorite-list'); if (!list) return;
            const data = favoritesData[currentFavoriteTab] || [];
            if (!data.length){ list.innerHTML = '<div class="text-sm text-gray-500">暂未收藏相关内容。</div>'; return; }
            list.innerHTML = data.map(item => `
                <div class="border border-gray-200 rounded-xl px-4 py-4 bg-white shadow-sm">
                    <div class="flex items-center justify-between">
                        <div class="text-sm font-semibold text-gray-900">${item.title}</div>
                        <span class="text-xs text-blue-500">${item.level}</span>
                    </div>
                    <div class="mt-1 text-xs text-gray-500">${item.meta}</div>
                    <div class="mt-2 flex flex-wrap gap-2 text-[11px] text-blue-600">
                        ${item.tags.map(tag => `<span class="px-2 py-0.5 rounded-full bg-blue-50">${tag}</span>`).join('')}
                    </div>
                    <div class="mt-2 text-xs text-gray-500">${item.note}</div>
                </div>
            `).join('');
        }

        function switchPlanTab(tab){ currentPlanTab = tab; renderPlanList(); const activeBtn=document.getElementById('plan-tab-active'); const finishedBtn=document.getElementById('plan-tab-finished'); if (activeBtn && finishedBtn){ const isActive = tab==='active'; activeBtn.classList.toggle('bg-blue-600', isActive); activeBtn.classList.toggle('text-white', isActive); activeBtn.classList.toggle('text-gray-600', !isActive); finishedBtn.classList.toggle('bg-blue-600', !isActive); finishedBtn.classList.toggle('text-white', !isActive); finishedBtn.classList.toggle('text-gray-600', isActive); }}

        function renderPlanList(){
            const list = document.getElementById('plan-list'); if (!list) return;
            const data = planData[currentPlanTab] || [];
            if (!data.length){ list.innerHTML = '<div class="text-sm text-gray-500">暂无相关计划。</div>'; return; }
            list.innerHTML = data.map(plan => `
                <div class="border border-gray-200 rounded-xl px-4 py-4 bg-white shadow-sm">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm font-semibold text-gray-900">${plan.title}</div>
                            <div class="text-xs text-gray-500 mt-1">${plan.schedule}</div>
                        </div>
                        <button class="px-3 py-1 text-xs rounded-lg border border-blue-400 text-blue-600" onclick="showToast('计划详情开发中（示意）')">查看</button>
                    </div>
                    <div class="mt-2 text-xs text-emerald-500">${plan.progress}</div>
                    <div class="mt-1 text-xs text-gray-500">${plan.next}</div>
                    <div class="mt-2 text-[11px] inline-flex px-2 py-0.5 rounded-full bg-blue-50 text-blue-600">${plan.tag}</div>
                </div>
            `).join('');
        }

        function renderTrainingDataOverview(){
            const setText = (id, text) => { const el=document.getElementById(id); if (el) el.textContent = text; };
            setText('overview-duration', '14 小时 06 分');
            setText('overview-calories', '8,620 kcal');
            setText('overview-heart', '132 bpm');
            const chart = document.getElementById('overview-chart');
            if (chart){
                chart.innerHTML = '';
                overviewMock.trend.forEach(value => {
                    const bar = document.createElement('div');
                    bar.className = 'flex-1 rounded-t-lg bg-blue-500/80';
                    bar.style.height = `${Math.max(12, value)}px`;
                    chart.appendChild(bar);
                });
            }
        }

        function selectScheduleDate(key){ scheduleState.selectedDate = new Date(key); renderScheduleView(); }

        function schedulePrevMonth(){ const current = scheduleState.currentMonth; scheduleState.currentMonth = new Date(current.getFullYear(), current.getMonth()-1, 1); renderScheduleView(); }

        function scheduleNextMonth(){ const current = scheduleState.currentMonth; scheduleState.currentMonth = new Date(current.getFullYear(), current.getMonth()+1, 1); renderScheduleView(); }

        function formatWeekday(date){ const labels=['周日','周一','周二','周三','周四','周五','周六']; return labels[date.getDay()]; }

        function renderPreferenceUI(){
            ['indicator','release','infinite','oneRM'].forEach(group => {
                document.querySelectorAll(`[data-pref-group="${group}"]`).forEach(btn => {
                    const value = btn.getAttribute('data-value');
                    const active = settingsState.preference[group] === value;
                    btn.classList.toggle('bg-blue-600', active);
                    btn.classList.toggle('text-white', active);
                    btn.classList.toggle('border-blue-600', active);
                    btn.classList.toggle('border-gray-300', !active);
                    btn.classList.toggle('text-gray-600', !active);
                    btn.classList.toggle('shadow', active);
                });
            });
        }

        function setPreferenceOption(group, value){ settingsState.preference[group] = value; renderPreferenceUI(); }

        function savePreferenceSettings(){ showToast('偏好设置已保存'); }

        function renderStandbyUI(){
            const container = document.getElementById('standby-options'); if (!container) return;
            container.innerHTML = '';
            settingsState.standbyOptions.forEach(option => {
                const active = settingsState.standby === option;
                const btn = document.createElement('button');
                btn.className = 'w-full px-4 py-3 rounded-lg border text-left text-sm transition';
                if (active){ btn.classList.add('bg-blue-600','text-white','border-blue-500','shadow'); }
                else { btn.classList.add('border-gray-300','text-gray-600','hover:border-blue-400','hover:bg-blue-50'); }
                btn.textContent = option;
                btn.onclick = () => { settingsState.standby = option; renderStandbyUI(); };
                container.appendChild(btn);
            });
        }

        function saveStandbySettings(){ showToast('待机设置已保存'); }

        function toggleAccessory(value){
            if (value === '全部'){
                const allSelected = accessoryOptions.every(opt => settingsState.accessories.has(opt));
                settingsState.accessories = allSelected ? new Set() : new Set(accessoryOptions);
            } else {
                if (settingsState.accessories.has(value)) settingsState.accessories.delete(value); else settingsState.accessories.add(value);
            }
            renderAccessoryUI();
        }

        function renderAccessoryUI(){
            const container = document.getElementById('accessory-options'); if (!container) return;
            container.innerHTML = '';
            const allSelected = accessoryOptions.every(opt => settingsState.accessories.has(opt));
            const allBtn = document.createElement('button');
            allBtn.className = 'col-span-2 px-4 py-3 border rounded-lg text-left text-sm transition';
            if (allSelected){ allBtn.classList.add('bg-blue-600','text-white','border-blue-500','shadow'); }
            else { allBtn.classList.add('border-gray-300','text-gray-600','hover:border-blue-400','hover:bg-blue-50'); }
            allBtn.textContent = '全部';
            allBtn.onclick = () => toggleAccessory('全部');
            container.appendChild(allBtn);
            accessoryOptions.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'px-4 py-3 border rounded-lg text-left text-sm transition';
                const active = allSelected || settingsState.accessories.has(option);
                if (active){ btn.classList.add('bg-blue-50','border-blue-400','text-blue-700','shadow-inner'); }
                else { btn.classList.add('border-gray-200','text-gray-600','hover:border-blue-400','hover:bg-blue-50'); }
                btn.textContent = option;
                btn.onclick = () => toggleAccessory(option);
                container.appendChild(btn);
            });
        }

        function saveAccessorySettings(){ showToast('配件设置已保存'); }

        function saveLanguageSettings(){ showToast('语言设置已保存（示意）'); showPage('page-settings'); }

        function clearCacheData(){ cacheUsageMB = 0; updateCacheBadge(); showToast('缓存已清理'); }

        function updateCacheBadge(){ const badge = document.querySelector('[data-cache-badge]'); if (badge) badge.textContent = cacheUsageMB > 0 ? `${cacheUsageMB}MB` : '0MB'; }

        function requestFactoryReset(){ showToast('请确保备份数据后再执行（示意）'); }

        function logout(){ showAuthLanding(); showToast('已退出登录'); }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 默认只显示欢迎页
            document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
            if (firstTimeActivation) {
                showPage('page-activate-region');
            } else {
                document.getElementById('page-welcome').classList.add('active');
            }
            const agreeLoginEl = document.getElementById('agree-login'); if (agreeLoginEl) agreeLoginEl.checked = true;
            const agreeRegEl = document.getElementById('agree-register'); if (agreeRegEl) agreeRegEl.checked = true;
            // 勾选框视觉同步
            document.querySelectorAll('.hidden-input[type="checkbox"]').forEach(input=>{
                const icon = input.nextElementSibling?.querySelector('svg'); if (!icon) return; icon.classList.toggle('hidden', !input.checked);
                input.addEventListener('change', e=> icon.classList.toggle('hidden', !e.target.checked));
            });
            setToday();
            populateMyPage();
            highlightAllProfileOptions();
            renderScheduleView();
            renderPreferenceUI();
            renderStandbyUI();
            renderAccessoryUI();
            renderPlanLibrary();
            renderLastLoginCard();
            updateCacheBadge();
        });

        // ==========================
        // 激活：地区选择
        // ==========================
        function openRegionPicker(){
            const overlay=document.getElementById('overlay-region');
            const sheet=document.getElementById('overlay-region-sheet');
            overlay.classList.remove('hidden');
            // 渲染列表
            const list=document.getElementById('region-list');
            const countries=[
                {code:'CN',name:'中国'},
                {code:'US',name:'美国'},
                {code:'UK',name:'英国'},
                {code:'FR',name:'法国'},
                {code:'JP',name:'日本'},
                {code:'DE',name:'德国'}
            ];
            list.innerHTML = '';
            countries.forEach(c=>{
                const row=document.createElement('label');
                row.className='flex items-center justify-between px-3 py-3 border rounded';
                row.innerHTML = `<span>${c.name}</span><input type=\"radio\" name=\"region\" value=\"${c.code}\">`;
                list.appendChild(row);
            });
            list.addEventListener('change', onRegionChanged, { once:true });
            requestAnimationFrame(()=> sheet.classList.remove('translate-y-full'));
        }
        function onRegionChanged(){ document.getElementById('btn-confirm-region').disabled=false; }
        function closeRegionPicker(){ const overlay=document.getElementById('overlay-region'); const sheet=document.getElementById('overlay-region-sheet'); sheet.classList.add('translate-y-full'); setTimeout(()=> overlay.classList.add('hidden'), 200); }
        function confirmRegion(){
            const checked=document.querySelector('#region-list input[name="region"]:checked');
            if (!checked) return;
            activationRegion = checked.value;
            document.getElementById('activation-region-text').textContent = `已选择：${regionName(activationRegion)}`;
            document.getElementById('btn-activate-next1').disabled = false;
            closeRegionPicker();
        }
        function regionName(code){ const map={CN:'中国',US:'美国',UK:'英国',FR:'法国',JP:'日本',DE:'德国'}; return map[code]||code; }

        function goToActivationWifi(){
            showPage('page-activate-wifi');
            document.getElementById('wifi-region-text').textContent = regionName(activationRegion);
            renderActivationWifi();
        }
        function renderActivationWifi(){
            const list=document.getElementById('activation-wifi-list'); list.innerHTML='';
            const title=document.createElement('div'); title.className='text-lg font-bold text-gray-900 mb-2'; title.textContent='请连接网络'; list.appendChild(title);
            ['Ebl-Guest','Studio-AP','Home-2G','Cafe-5G'].forEach(ssid=>{
                const btn=document.createElement('button');
                btn.className='w-full text-left px-4 py-3 border rounded hover:bg-gray-50 flex items-center justify-between';
                btn.innerHTML = `<span>${ssid}</span><span class=\"text-xs text-gray-500\" id=\"status-${ssid}\">点击连接</span>`;
                btn.onclick=()=> connectActivationWifi(ssid);
                list.appendChild(btn);
            });
        }
        function connectActivationWifi(ssid){
            const st = document.getElementById(`status-${ssid}`);
            if (st) { st.textContent = '连接中…'; st.classList.remove('text-green-600'); st.classList.add('text-gray-500'); }
            setTimeout(()=>{
                activationWifiConnected = true;
                document.querySelectorAll('[id^="status-"]').forEach(e=> { e.textContent='点击连接'; e.classList.remove('text-green-600'); e.classList.add('text-gray-500'); });
                if (st) { st.textContent = '已连接'; st.classList.remove('text-gray-500'); st.classList.add('text-green-600'); }
                document.getElementById('btn-activate-next2').disabled=false;
            }, 800);
        }
        function proceedToAuth(){ activationFlow = true; showPage('page-login'); applyAuthRegionRules(); }
        function applyAuthRegionRules(){
            if (!activationRegion) return;
            // 登录页
            const bar=document.getElementById('login-tab-bar'); if (bar) bar.classList.add('hidden');
            if (activationRegion === 'CN') {
                // 手机号 + 密码
                toggleLoginMode('password');
                document.getElementById('mode-phone').classList.add('hidden');
                document.getElementById('mode-email').classList.add('hidden');
                document.getElementById('mode-password').classList.remove('hidden');
                const pwdUser=document.querySelector('#mode-password input[type="text"]'); if (pwdUser) pwdUser.placeholder='请输入手机号';
            } else {
                // 邮箱 + 密码
                document.getElementById('mode-phone').classList.add('hidden');
                document.getElementById('mode-password').classList.add('hidden');
                document.getElementById('mode-email').classList.remove('hidden');
            }
            // 注册页（切换时也应用）
            const rbar=document.getElementById('register-tab-bar'); if (rbar) rbar.classList.add('hidden');
            if (activationRegion === 'CN') {
                toggleRegisterMode('phone');
                document.getElementById('reg-mode-email').classList.add('hidden');
                document.getElementById('reg-mode-phone').classList.remove('hidden');
            } else {
                toggleRegisterMode('email');
                document.getElementById('reg-mode-phone').classList.add('hidden');
                document.getElementById('reg-mode-email').classList.remove('hidden');
            }
            // 显示“稍后注册”
            const skipBtn = document.getElementById('btn-activation-skip');
            if (skipBtn) skipBtn.classList.remove('hidden');
        }
        function enterHomeAfterActivation(){ activationFlow=true; showPage('page-guest'); showActivationSuccess(); activationFlow=false; }
        function showActivationSuccess(){
            const el=document.getElementById('activation-toast');
            if (!el) return;
            const timerEl = document.getElementById('activation-toast-timer');
            if (activationCountdownTimer) { clearInterval(activationCountdownTimer); activationCountdownTimer = null; }
            let remaining = 5;
            const updateText = () => { if (timerEl) timerEl.textContent = `将在 ${remaining} 秒后关闭`; };
            updateText();
            el.classList.remove('hidden');
            activationCountdownTimer = setInterval(() => {
                remaining -= 1;
                if (remaining <= 0) {
                    clearInterval(activationCountdownTimer);
                    activationCountdownTimer = null;
                    el.classList.add('hidden');
                } else {
                    updateText();
                }
            }, 1000);
        }
    </script>
</body>
</html>
